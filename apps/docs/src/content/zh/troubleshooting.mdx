export const metadata = {
  title: 'æ•…éšœæ’é™¤',
  description:
    'ä½¿ç”¨ pnpm-catalog-updates æ—¶çš„å¸¸è§é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆã€‚é”™è¯¯æ¶ˆæ¯ã€è°ƒè¯•æŠ€å·§å’Œæ•…éšœæ’é™¤æŒ‡å—ã€‚',
};

# æ•…éšœæ’é™¤

å¸¸è§é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆï¼Œå¸®åŠ©æ‚¨è§£å†³ PCU çš„é—®é¢˜ã€‚æŸ¥æ‰¾å¸¸è§é”™è¯¯çš„ç­”æ¡ˆå’Œè°ƒè¯•æŠ€å·§ã€‚{{ className: 'lead' }}

## å¸¸è§é”™è¯¯

### æœªæ‰¾åˆ°å·¥ä½œç©ºé—´

**é”™è¯¯æ¶ˆæ¯ï¼š**

```
Error: No pnpm workspace found in the current directory
```

**åŸå› ï¼š** PCU æ— æ³•æ‰¾åˆ° `pnpm-workspace.yaml` æ–‡ä»¶æˆ–æ£€æµ‹åˆ°æœ‰æ•ˆçš„ pnpm å·¥ä½œç©ºé—´ç»“æ„ã€‚

**è§£å†³æ–¹æ¡ˆï¼š**

<CodeGroup>

```bash {{ title: 'åˆå§‹åŒ–å·¥ä½œç©ºé—´' }}
# åˆ›å»ºæ–°çš„ pnpm å·¥ä½œç©ºé—´
pcu init

# æˆ–æ‰‹åŠ¨åˆ›å»º pnpm-workspace.yaml
echo "packages:
  - 'packages/*'" > pnpm-workspace.yaml
```

```bash {{ title: 'æŒ‡å®šå·¥ä½œç©ºé—´è·¯å¾„' }}
# ä»å·¥ä½œç©ºé—´æ ¹ç›®å½•è¿è¡Œ PCU
cd /path/to/workspace/root
pcu -c

# æˆ–æŒ‡å®šå·¥ä½œç©ºé—´ç›®å½•
pcu -c --workspace /path/to/workspace
```

</CodeGroup>

---

### æ— ç›®å½•ä¾èµ–

**é”™è¯¯æ¶ˆæ¯ï¼š**

```
No catalog dependencies found in workspace
```

**åŸå› ï¼š** æ‚¨çš„å·¥ä½œç©ºé—´æœªä½¿ç”¨ pnpm ç›®å½•ä¾èµ–ã€‚

**è§£å†³æ–¹æ¡ˆï¼š**

<CodeGroup>

```yaml {{ title: 'å‘ pnpm-workspace.yaml æ·»åŠ ç›®å½•' }}
packages:
  - 'packages/*'

catalog:
  react: ^18.2.0
  typescript: ^5.0.0
  lodash: ^4.17.21
```

```json {{ title: 'åœ¨ package.json ä¸­ä½¿ç”¨ç›®å½•' }}
{
  "name": "my-package",
  "dependencies": {
    "react": "catalog:",
    "typescript": "catalog:",
    "lodash": "catalog:"
  }
}
```

</CodeGroup>

---

### æ³¨å†Œè¡¨è®¿é—®é—®é¢˜

**é”™è¯¯æ¶ˆæ¯ï¼š**

```
Error: getaddrinfo ENOTFOUND registry.npmjs.org
```

**åŸå› ï¼š** ç½‘ç»œè¿æ¥é—®é¢˜æˆ–æ³¨å†Œè¡¨è®¿é—®é—®é¢˜ã€‚

**è§£å†³æ–¹æ¡ˆï¼š**

<CodeGroup>

```bash {{ title: 'ç½‘ç»œæ•…éšœæ’é™¤' }}
# æ£€æŸ¥ç½‘ç»œè¿æ¥
ping registry.npmjs.org

# ä½¿ç”¨å¢åŠ çš„è¶…æ—¶æµ‹è¯•
pcu -c --timeout 60000

# å‡å°‘å¹¶å‘è¯·æ±‚
pcu -c --concurrency 2
```

```ini {{ title: 'é…ç½®æ³¨å†Œè¡¨ (.npmrc)' }}
# ä½¿ç”¨ä¸åŒæ³¨å†Œè¡¨
registry=https://registry.npmjs.org/

# ä¼ä¸šç½‘ç»œ
registry=https://your-corporate-registry.com/
strict-ssl=false
```

</CodeGroup>

---

### èº«ä»½éªŒè¯é”™è¯¯

**é”™è¯¯æ¶ˆæ¯ï¼š**

```
Error: 401 Unauthorized - authentication required
```

**åŸå› ï¼š** ç§æœ‰æ³¨å†Œè¡¨ç¼ºå°‘æˆ–æ— æ•ˆçš„èº«ä»½éªŒè¯ä»¤ç‰Œã€‚

**è§£å†³æ–¹æ¡ˆï¼š**

<CodeGroup>

```ini {{ title: 'é…ç½®èº«ä»½éªŒè¯ (.npmrc)' }}
@myorg:registry=https://npm.private-registry.com/
//npm.private-registry.com/:_authToken=${NPM_TOKEN}

# æˆ–ä½¿ç”¨ä¼ ç»Ÿèº«ä»½éªŒè¯
//npm.private-registry.com/:username=myuser
//npm.private-registry.com/:_password=base64password
//npm.private-registry.com/:email=my.email@example.com
```

```bash {{ title: 'è®¾ç½®ç¯å¢ƒå˜é‡' }}
export NPM_TOKEN=your_token_here
pcu -c
```

</CodeGroup>

---

### é…ç½®æ–‡ä»¶é”™è¯¯

**é”™è¯¯æ¶ˆæ¯ï¼š**

```
Error: Invalid configuration in .pcurc.json
```

**åŸå› ï¼š** JSON æ ¼å¼é”™è¯¯æˆ–æ— æ•ˆé…ç½®é€‰é¡¹ã€‚

**è§£å†³æ–¹æ¡ˆï¼š**

<CodeGroup>

```bash {{ title: 'éªŒè¯é…ç½®' }}
# æ£€æŸ¥ JSON è¯­æ³•
node -e "console.log(JSON.parse(require('fs').readFileSync('.pcurc.json', 'utf8')))"

# é‡æ–°ç”Ÿæˆé…ç½®
mv .pcurc.json .pcurc.json.backup
pcu init --force
```

```json {{ title: 'æœ€å°æœ‰æ•ˆé…ç½®' }}
{
  "defaults": {
    "target": "latest"
  },
  "output": {
    "format": "table"
  }
}
```

</CodeGroup>

## è°ƒè¯•

### å¯ç”¨è¯¦ç»†æ—¥å¿—

<CodeGroup>

```bash {{ title: 'è¯¦ç»†è¾“å‡º' }}
# å¯ç”¨è¯¦ç»†æ—¥å¿—
pcu -c --verbose

# ä½¿ç”¨ç¯å¢ƒå˜é‡è°ƒè¯•æ¨¡å¼
DEBUG=pcu:* pcu -c

# ç‰¹å®šè°ƒè¯•æ¨¡å—
DEBUG=pcu:core,pcu:registry pcu -c
```

```bash {{ title: 'è¾“å‡ºåˆ°æ–‡ä»¶' }}
# ä¿å­˜è°ƒè¯•è¾“å‡º
pcu -c --verbose > debug.log 2>&1

# æ£€æŸ¥æ—¥å¿—æ–‡ä»¶
cat debug.log | grep -i error
```

</CodeGroup>

### å·¥ä½œç©ºé—´éªŒè¯

<CodeGroup>

```bash {{ title: 'éªŒè¯å·¥ä½œç©ºé—´' }}
# æ£€æŸ¥å·¥ä½œç©ºé—´é…ç½®
pcu -s --validate

# è·å–è¯¦ç»†å·¥ä½œç©ºé—´ä¿¡æ¯
pcu -s --stats --verbose
```

```bash {{ title: 'æ‰‹åŠ¨éªŒè¯' }}
# æ£€æŸ¥ pnpm-workspace.yaml æ˜¯å¦å­˜åœ¨
ls -la pnpm-workspace.yaml

# éªŒè¯ç›®å½•è¯­æ³•
pnpm exec -- pnpm list --depth=0
```

</CodeGroup>

## æ€§èƒ½é—®é¢˜

### ç½‘ç»œè¯·æ±‚ç¼“æ…¢

**ç—‡çŠ¶ï¼š** PCU æ£€æŸ¥æ›´æ–°éœ€è¦å¾ˆé•¿æ—¶é—´

**è§£å†³æ–¹æ¡ˆï¼š**

<CodeGroup>

```json {{ title: 'ä¼˜åŒ–é…ç½®' }}
{
  "advanced": {
    "concurrency": 3,
    "timeout": 30000,
    "retries": 2,
    "cacheValidityMinutes": 120
  }
}
```

```bash {{ title: 'ç¼“å­˜ç®¡ç†' }}
# å¦‚æœç¼“å­˜è¿‡æ—¶åˆ™æ¸…é™¤
rm -rf ~/.pcu/cache

# ç¦ç”¨ç¼“å­˜ç”¨äºè°ƒè¯•
pcu -c --no-cache
```

</CodeGroup>

### é«˜å†…å­˜ä½¿ç”¨

**ç—‡çŠ¶ï¼š** PCU åœ¨å¤§å‹å·¥ä½œç©ºé—´ä¸­æ¶ˆè€—è¿‡å¤šå†…å­˜

**è§£å†³æ–¹æ¡ˆï¼š**

<CodeGroup>

```json {{ title: 'å†…å­˜ä¼˜åŒ–' }}
{
  "advanced": {
    "concurrency": 2,
    "batchSize": 10
  }
}
```

```bash {{ title: 'è¿›ç¨‹ç®¡ç†' }}
# ç›‘æ§å†…å­˜ä½¿ç”¨
top -p $(pgrep node)

# ä½¿ç”¨ Node.js å†…å­˜æ ‡å¿—
node --max-old-space-size=4096 $(which pcu) -c
```

</CodeGroup>

## ç¯å¢ƒé—®é¢˜

### Node.js ç‰ˆæœ¬å…¼å®¹æ€§

**é”™è¯¯æ¶ˆæ¯ï¼š**

```
Error: Unsupported Node.js version
```

**è§£å†³æ–¹æ¡ˆï¼š**

<CodeGroup>

```bash {{ title: 'æ£€æŸ¥ç‰ˆæœ¬' }}
node --version  # åº”è¯¥æ˜¯ >= 18.0.0

# å®‰è£…å…¼å®¹ç‰ˆæœ¬
nvm install 20
nvm use 20
```

```bash {{ title: 'æ›´æ–° Node.js' }}
# ä½¿ç”¨ nvm
nvm install --lts
nvm use --lts

# éªŒè¯å®‰è£…
node --version
npm --version
```

</CodeGroup>

### pnpm ç‰ˆæœ¬é—®é¢˜

**é”™è¯¯æ¶ˆæ¯ï¼š**

```
Error: pnpm command not found
```

**è§£å†³æ–¹æ¡ˆï¼š**

<CodeGroup>

```bash {{ title: 'å®‰è£… pnpm' }}
# å®‰è£…æœ€æ–° pnpm
npm install -g pnpm@latest

# éªŒè¯å®‰è£…
pnpm --version  # åº”è¯¥æ˜¯ >= 8.0.0
```

```bash {{ title: 'æ›¿ä»£å®‰è£…' }}
# ä½¿ç”¨ Corepackï¼ˆæ¨èï¼‰
corepack enable
corepack prepare pnpm@latest --activate

# ç›´æ¥ä¸‹è½½
curl -fsSL https://get.pnpm.io/install.sh | sh -
```

</CodeGroup>

## Windows ç‰¹å®šé—®é¢˜

### è·¯å¾„åˆ†éš”ç¬¦é—®é¢˜

**é”™è¯¯æ¶ˆæ¯ï¼š**

```
Error: Cannot resolve workspace path
```

**è§£å†³æ–¹æ¡ˆï¼š**

<CodeGroup>

```bash {{ title: 'ä½¿ç”¨æ­£æ–œæ ' }}
# åœ¨è·¯å¾„ä¸­ä½¿ç”¨æ­£æ–œæ 
pcu -c --workspace ./my/workspace

# æˆ–ä½¿ç”¨ PowerShell
pwsh -c "pcu -c"
```

```json {{ title: 'Windows é…ç½®' }}
{
  "workspace": {
    "pathSeparator": "/"
  }
}
```

</CodeGroup>

### æƒé™é”™è¯¯

**é”™è¯¯æ¶ˆæ¯ï¼š**

```
Error: EPERM: operation not permitted
```

**è§£å†³æ–¹æ¡ˆï¼š**

<CodeGroup>

```cmd {{ title: 'ä»¥ç®¡ç†å‘˜èº«ä»½è¿è¡Œ' }}
# ä»¥ç®¡ç†å‘˜èº«ä»½è¿è¡Œå‘½ä»¤æç¤ºç¬¦
runas /user:Administrator cmd

# æˆ–ä»¥ç®¡ç†å‘˜èº«ä»½ä½¿ç”¨ PowerShell
Start-Process powershell -Verb RunAs
```

```bash {{ title: 'ä¿®å¤æƒé™' }}
# ä¿®å¤ npm æƒé™
npm config set cache ~/.npm-cache
npm config set prefix ~/npm-global
```

</CodeGroup>

## è·å–å¸®åŠ©

### è¯Šæ–­ä¿¡æ¯

æŠ¥å‘Šé—®é¢˜æ—¶ï¼Œè¯·åŒ…å«æ­¤è¯Šæ–­ä¿¡æ¯ï¼š

<CodeGroup>

```bash {{ title: 'ç³»ç»Ÿä¿¡æ¯' }}
# PCU ç‰ˆæœ¬
pcu --version

# Node.js å’Œ pnpm ç‰ˆæœ¬
node --version
pnpm --version

# æ“ä½œç³»ç»Ÿ
uname -a  # Linux/macOS
systeminfo  # Windows
```

```bash {{ title: 'é…ç½®ä¿¡æ¯' }}
# æ˜¾ç¤ºå½“å‰é…ç½®
cat .pcurc.json

# å·¥ä½œç©ºé—´éªŒè¯
pcu -s --validate --verbose

# è°ƒè¯•è¾“å‡º
DEBUG=pcu:* pcu -c --verbose
```

</CodeGroup>

### æ”¯æŒæ¸ é“

- ğŸ› **é”™è¯¯æŠ¥å‘Š**ï¼š[GitHub Issues](https://github.com/houko/pnpm-catalog-updates/issues)
- ğŸ’¬ **é—®é¢˜**ï¼š[GitHub Discussions](https://github.com/houko/pnpm-catalog-updates/discussions)
- ğŸ“– **æ–‡æ¡£**ï¼šæŸ¥çœ‹æ­¤æ–‡æ¡£è·å–è¯¦ç»†æŒ‡å—
- ğŸ”§ **åŠŸèƒ½è¯·æ±‚**ï¼šä½¿ç”¨å¸¦å¢å¼ºæ ‡ç­¾çš„ GitHub Issues

### é—®é¢˜æ¨¡æ¿

æŠ¥å‘Šé”™è¯¯æ—¶ï¼Œè¯·åŒ…å«ï¼š

1. **PCU ç‰ˆæœ¬**å’Œ**ä½¿ç”¨çš„å‘½ä»¤**
2. **é”™è¯¯æ¶ˆæ¯**ï¼ˆå¸¦ `--verbose` çš„å®Œæ•´è¾“å‡ºï¼‰
3. **ç¯å¢ƒ**ï¼ˆæ“ä½œç³»ç»Ÿã€Node.jsã€pnpm ç‰ˆæœ¬ï¼‰
4. **å·¥ä½œç©ºé—´ç»“æ„**ï¼ˆpnpm-workspace.yamlã€package.jsonï¼‰
5. **é…ç½®**ï¼ˆ.pcurc.jsonã€.npmrc å¦‚æœç›¸å…³ï¼‰
6. **é‡ç°é—®é¢˜çš„æ­¥éª¤**
7. **é¢„æœŸä¸å®é™…è¡Œä¸º**

---

## é«˜çº§æ•…éšœæ’é™¤

### å¤æ‚ä¾èµ–å†²çª

**é”™è¯¯åœºæ™¯ï¼š**

```
Error: Cannot resolve peer dependencies
â””â”€ react@18.2.0
â”œâ”€ react-dom@17.0.2 (peer dependency conflict)
â””â”€ @types/react@17.0.62 (version mismatch)
```

**ç—‡çŠ¶ï¼š** æ›´æ–°åå‡ºç°ç‰ˆæœ¬å†²çªï¼Œåº”ç”¨æ— æ³•å¯åŠ¨

**å®Œæ•´è¯Šæ–­è¿‡ç¨‹ï¼š**

<CodeGroup>

```bash {{ title: 'æ­¥éª¤1ï¼šåˆ†æå†²çª' }}
# æ£€æŸ¥å½“å‰ä¾èµ–æ ‘
pnpm ls --depth=2 | grep -E "(react|@types)"

# åˆ†æç‰¹å®šåŒ…çš„å½±å“
pcu analyze default react 18.3.0

# æŸ¥çœ‹å“ªäº›åŒ…ä¾èµ–æœ‰é—®é¢˜çš„ç‰ˆæœ¬
pnpm why react-dom@17.0.2
```

```bash {{ title: 'æ­¥éª¤2ï¼šæŸ¥æ‰¾æ ¹å› ' }}
# æ£€æŸ¥æ‰€æœ‰package.jsonä¸­çš„Reactç›¸å…³ä¾èµ–
find . -name "package.json" -exec grep -l "react" {} \;

# æ˜¾ç¤ºè¯¦ç»†å†²çªä¿¡æ¯
pnpm install --dry-run --verbose
```

```bash {{ title: 'æ­¥éª¤3ï¼šä¿®å¤å†²çª' }}
# åˆ›å»ºå¤‡ä»½
cp pnpm-workspace.yaml pnpm-workspace.yaml.backup

# ç»Ÿä¸€æ›´æ–°Reactç”Ÿæ€ç³»ç»Ÿ
pcu update --include "react*,@types/react*" --target minor --interactive

# éªŒè¯ä¿®å¤
pnpm install
pnpm list --depth=1 | grep react
```

</CodeGroup>

### CI/CD ç¯å¢ƒæ•…éšœ

**é”™è¯¯åœºæ™¯ï¼š**

```
Error: EACCES permission denied, open '/home/runner/.pcu/cache'
Exit code: 126 in GitHub Actions
```

**ç—‡çŠ¶ï¼š** CI/CDä¸­PCUè¿è¡Œå¤±è´¥ï¼Œæœ¬åœ°å·¥ä½œæ­£å¸¸

**è§£å†³æ–¹æ¡ˆï¼š**

<CodeGroup>

```yaml {{ title: 'GitHub Actionsä¿®å¤' }}
- name: è®¾ç½®PCUæƒé™
  run: |
    # ç¡®ä¿ç¼“å­˜ç›®å½•æƒé™æ­£ç¡®
    mkdir -p ~/.pcu/cache
    chmod 755 ~/.pcu/cache

    # è®¾ç½®CIç¯å¢ƒå˜é‡
    export PCU_NO_COLOR=true
    export PCU_CACHE_ENABLED=false  # ç¦ç”¨ç¼“å­˜é¿å…æƒé™é—®é¢˜

    # è¿è¡ŒPCU
    pcu check --verbose
```

```bash {{ title: 'è¯Šæ–­CIç¯å¢ƒ' }}
# æ£€æŸ¥ç¯å¢ƒä¿¡æ¯
echo "Node: $(node --version)"
echo "PNPM: $(pnpm --version)"
echo "PCU: $(pcu --version)"
echo "Workspace: $(pwd)"
echo "User: $(whoami)"
echo "Permissions: $(ls -la ~/.pcu/ 2>/dev/null || echo 'Cache dir not found')"

# æµ‹è¯•åŸºæœ¬åŠŸèƒ½
pcu workspace --validate --verbose
```

</CodeGroup>

### å¤§å‹monorepoæ€§èƒ½é—®é¢˜

**é”™è¯¯åœºæ™¯ï¼š**

```
Error: JavaScript heap out of memory
FATAL ERROR: Reached heap limit Allocation failed
```

**ç—‡çŠ¶ï¼š** åœ¨åŒ…å«100+åŒ…çš„monorepoä¸­PCUå´©æºƒ

**ä¼˜åŒ–æ–¹æ¡ˆï¼š**

<CodeGroup>

```json {{ title: 'æ€§èƒ½é…ç½®ä¼˜åŒ–' }}
{
  "advanced": {
    "concurrency": 2,
    "batchSize": 5,
    "timeout": 120000,
    "retries": 1,
    "maxMemory": "4GB"
  },
  "cache": {
    "enabled": true,
    "ttl": 3600000,
    "maxSize": 104857600,
    "maxEntries": 1000
  }
}
```

```bash {{ title: 'å†…å­˜ç®¡ç†ç­–ç•¥' }}
# å¢åŠ Node.jså†…å­˜é™åˆ¶
export NODE_OPTIONS="--max-old-space-size=8192"

# åˆ†æ‰¹å¤„ç†å¤§å‹å·¥ä½œç©ºé—´
pcu check --catalog default --include "@company/*"
pcu check --catalog default --include "@other/*"

# ç›‘æ§å†…å­˜ä½¿ç”¨
while true; do
  ps aux | grep pcu | grep -v grep
  sleep 2
done &

pcu check --verbose
```

</CodeGroup>

### ç§æœ‰æ³¨å†Œè¡¨è®¤è¯é—®é¢˜

**é”™è¯¯åœºæ™¯ï¼š**

```
Error: 403 Forbidden - access denied to package @company/private-lib
HTTP 403: You must be logged in to access this package
```

**ç—‡çŠ¶ï¼š** æ— æ³•è®¿é—®ç§æœ‰åŒ…ï¼Œå…¬å…±åŒ…å·¥ä½œæ­£å¸¸

**å®Œæ•´è§£å†³æµç¨‹ï¼š**

<CodeGroup>

```bash {{ title: 'è¯Šæ–­è®¤è¯çŠ¶æ€' }}
# æ£€æŸ¥å½“å‰è®¤è¯çŠ¶æ€
npm whoami --registry https://npm.company.com

# æµ‹è¯•æ³¨å†Œè¡¨è¿æ¥
curl -I https://npm.company.com/-/whoami \
  -H "Authorization: Bearer $NPM_TOKEN"

# éªŒè¯.npmrcé…ç½®
cat .npmrc | grep -E "(registry|authToken)"
```

```ini {{ title: 'ä¿®å¤è®¤è¯é…ç½®' }}
# .npmrcæ­£ç¡®é…ç½®æ ¼å¼
@company:registry=https://npm.company.com/
//npm.company.com/:_authToken=${NPM_TOKEN}

# å…¬å…±åŒ…ä»ä½¿ç”¨é»˜è®¤æ³¨å†Œè¡¨
registry=https://registry.npmjs.org/

# ç¡®ä¿ç¯å¢ƒå˜é‡è®¾ç½®
# export NPM_TOKEN=your_actual_token_here
```

```bash {{ title: 'éªŒè¯å’Œæµ‹è¯•' }}
# é‡æ–°ç™»å½•ç§æœ‰æ³¨å†Œè¡¨
npm login --registry https://npm.company.com --auth-type web

# æµ‹è¯•ç§æœ‰åŒ…è®¿é—®
npm view @company/private-lib --registry https://npm.company.com

# ç¡®è®¤PCUå¯ä»¥è®¿é—®
pcu check --include "@company/*" --verbose
```

</CodeGroup>

### å®‰å…¨æ‰«æè¯¯æŠ¥å¤„ç†

**é”™è¯¯åœºæ™¯ï¼š**

```
ğŸš¨ å‘ç°ä¸¥é‡å®‰å…¨æ¼æ´ in lodash@4.17.20
CVE-2021-23337: Command Injection
å®é™…ä¸Šï¼šé¡¹ç›®ä¸ä½¿ç”¨å—å½±å“çš„æ¨¡æ¿åŠŸèƒ½
```

**ç—‡çŠ¶ï¼š** å®‰å…¨æ‰«ææŠ¥å‘Šæ¼æ´ï¼Œä½†å®é™…ä¸å½±å“é¡¹ç›®

**å¤„ç†ç­–ç•¥ï¼š**

<CodeGroup>

```json {{ title: 'é…ç½®å®‰å…¨å®¡è®¡ä¾‹å¤–' }}
{
  "security": {
    "ignoredVulnerabilities": ["CVE-2021-23337"],
    "ignoredPackages": ["lodash@4.17.20"],
    "customAuditConfig": {
      "low": "ignore",
      "moderate": "warn",
      "high": "error",
      "critical": "error"
    }
  }
}
```

```bash {{ title: 'è¯¦ç»†æ¼æ´åˆ†æ' }}
# è·å–è¯¦ç»†æ¼æ´ä¿¡æ¯
pcu security --severity all --format json > security-full.json

# åˆ†æå…·ä½“æ¼æ´å½±å“
npm audit --audit-level=none --json | jq '.vulnerabilities'

# æŸ¥çœ‹åŒ…çš„å®é™…ä½¿ç”¨æƒ…å†µ
pnpm why lodash
find . -name "*.js" -o -name "*.ts" | xargs grep -l "lodash" | head -10
```

</CodeGroup>

### ç½‘ç»œç¯å¢ƒæ•…éšœæ’é™¤

**é”™è¯¯åœºæ™¯ï¼š**

```
Error: connect ETIMEDOUT 104.16.21.35:443
Error: socket hang up
Error: Request timeout after 30000ms
```

**ç—‡çŠ¶ï¼š** ä¼ä¸šç½‘ç»œç¯å¢ƒä¸‹é¢‘ç¹è¶…æ—¶ï¼Œä»£ç†é—®é¢˜

**è§£å†³æ–¹æ¡ˆï¼š**

<CodeGroup>

```bash {{ title: 'ç½‘ç»œè¯Šæ–­' }}
# æµ‹è¯•æ³¨å†Œè¡¨è¿æ¥
curl -I https://registry.npmjs.org --connect-timeout 10

# æ£€æŸ¥ä»£ç†è®¾ç½®
echo "HTTP_PROXY: $HTTP_PROXY"
echo "HTTPS_PROXY: $HTTPS_PROXY"
echo "NO_PROXY: $NO_PROXY"

# æµ‹è¯•DNSè§£æ
nslookup registry.npmjs.org
dig registry.npmjs.org A +short
```

```ini {{ title: 'ä»£ç†é…ç½®' }}
# .npmrc ä»£ç†é…ç½®
proxy=http://proxy.company.com:8080
https-proxy=http://proxy.company.com:8080
strict-ssl=false

# ä¼ä¸šCAè¯ä¹¦
cafile=/etc/ssl/certs/company-ca.pem
```

```json {{ title: 'PCUç½‘ç»œä¼˜åŒ–' }}
{
  "advanced": {
    "timeout": 120000,
    "retries": 5,
    "concurrency": 1,
    "userAgent": "pcu/company-internal"
  },
  "proxy": {
    "enabled": true,
    "url": "http://proxy.company.com:8080",
    "auth": {
      "username": "${PROXY_USER}",
      "password": "${PROXY_PASS}"
    }
  }
}
```

</CodeGroup>

### ç‰ˆæœ¬çº¦æŸå†²çª

**é”™è¯¯åœºæ™¯ï¼š**

```
Cannot resolve version constraints:
- Package A requires react@^17.0.0
- Package B requires react@^18.0.0
- Catalog specifies react@^18.2.0
```

**ç—‡çŠ¶ï¼š** å·¥ä½œç©ºé—´ä¸­åŒ…çš„ç‰ˆæœ¬è¦æ±‚å†²çª

**è§£å†³ç­–ç•¥ï¼š**

<CodeGroup>

```bash {{ title: 'å†²çªåˆ†æ' }}
# æ‰¾å‡ºæ‰€æœ‰ç‰ˆæœ¬çº¦æŸ
find . -name "package.json" -exec jq -r '.dependencies.react // empty' {} \; | sort | uniq -c

# åˆ†ææ¯ä¸ªåŒ…çš„è¦æ±‚
for pkg in packages/*/package.json; do
  echo "=== $pkg ==="
  jq '.dependencies.react // empty' "$pkg"
done
```

```yaml {{ title: 'å¤šç›®å½•ç­–ç•¥' }}
# pnpm-workspace.yaml
packages:
  - 'packages/*'

catalog:
  # é»˜è®¤æœ€æ–°ç‰ˆæœ¬
  react: ^18.2.0
  react-dom: ^18.2.0

catalogs:
  # å…¼å®¹æ—§ç‰ˆæœ¬çš„åŒ…
  react17:
    react: ^17.0.2
    react-dom: ^17.0.2
```

```bash {{ title: 'æ¸è¿›å¼å‡çº§' }}
# 1. è¯†åˆ«éœ€è¦ä¿æŒæ—§ç‰ˆæœ¬çš„åŒ…
pcu analyze default react 18.2.0

# 2. å°†è¿™äº›åŒ…ç§»åˆ°å…¼å®¹ç›®å½•
# åœ¨package.jsonä¸­ï¼š
# "react": "catalog:react17"

# 3. é€æ­¥å‡çº§
pcu update --catalog react17 --target minor
```

</CodeGroup>

## æ¢å¤ç¨‹åº

### æ›´æ–°å¤±è´¥å›æ»š

å½“æ›´æ–°å¯¼è‡´é—®é¢˜æ—¶çš„å®Œæ•´æ¢å¤æµç¨‹ï¼š

<CodeGroup>

```bash {{ title: 'è‡ªåŠ¨å›æ»š' }}
# å¦‚æœå¯ç”¨äº†å¤‡ä»½ï¼ˆæ¨èï¼‰
if [ -f "pnpm-workspace.yaml.backup" ]; then
  echo "å‘ç°å¤‡ä»½ï¼Œå¼€å§‹å›æ»š..."

  # æ¢å¤å·¥ä½œç©ºé—´é…ç½®
  cp pnpm-workspace.yaml.backup pnpm-workspace.yaml

  # æ¸…ç†å¹¶é‡æ–°å®‰è£…
  rm -rf node_modules packages/*/node_modules
  pnpm install

  # éªŒè¯å›æ»š
  pcu workspace --validate
  echo "âœ… å›æ»šå®Œæˆ"
else
  echo "âŒ æœªæ‰¾åˆ°å¤‡ä»½æ–‡ä»¶"
fi
```

```bash {{ title: 'æ‰‹åŠ¨æ¢å¤' }}
# ä½¿ç”¨Gitæ¢å¤ï¼ˆå¦‚æœåœ¨ç‰ˆæœ¬æ§åˆ¶ä¸­ï¼‰
git status
git restore pnpm-workspace.yaml
git restore packages/*/package.json

# æ¸…ç†é”å®šæ–‡ä»¶
rm pnpm-lock.yaml
pnpm install

# éªŒè¯æ¢å¤
pnpm run test
```

</CodeGroup>

### æŸåç¼“å­˜ä¿®å¤

å½“PCUç¼“å­˜æŸåå¯¼è‡´é—®é¢˜ï¼š

<CodeGroup>

```bash {{ title: 'å®Œå…¨ç¼“å­˜é‡ç½®' }}
# åœæ­¢æ‰€æœ‰PCUè¿›ç¨‹
pkill -f pcu

# æ¸…é™¤æ‰€æœ‰ç¼“å­˜
rm -rf ~/.pcu/cache
rm -rf ~/.npm/_cacache
rm -rf ~/.pnpm-store

# é‡æ–°åˆå§‹åŒ–
pcu workspace --validate
pcu check --verbose
```

```bash {{ title: 'é€‰æ‹©æ€§ç¼“å­˜æ¸…ç†' }}
# ä»…æ¸…é™¤ç‰¹å®šç±»å‹çš„ç¼“å­˜
rm -rf ~/.pcu/cache/registry  # NPMæ³¨å†Œè¡¨ç¼“å­˜
rm -rf ~/.pcu/cache/workspace  # å·¥ä½œç©ºé—´ç¼“å­˜
rm -rf ~/.pcu/cache/security   # å®‰å…¨æ‰«æç¼“å­˜

# å¼ºåˆ¶é‡æ–°æ£€æŸ¥
PCU_CACHE_ENABLED=false pcu check
```

</CodeGroup>

### å·¥ä½œç©ºé—´æŸåä¿®å¤

å½“å·¥ä½œç©ºé—´é…ç½®æŸåï¼š

<CodeGroup>

```bash {{ title: 'é…ç½®éªŒè¯å’Œä¿®å¤' }}
# å¤‡ä»½å½“å‰é…ç½®
cp pnpm-workspace.yaml pnpm-workspace.yaml.broken
cp .pcurc.json .pcurc.json.broken 2>/dev/null || true

# é‡æ–°ç”Ÿæˆé…ç½®
pcu init --force

# æ‰‹åŠ¨åˆå¹¶å¿…è¦çš„è‡ªå®šä¹‰é…ç½®
echo "è¯·æ£€æŸ¥å¹¶åˆå¹¶ä»¥ä¸‹è‡ªå®šä¹‰é…ç½®ï¼š"
echo "=== æ—§çš„å·¥ä½œç©ºé—´é…ç½® ==="
cat pnpm-workspace.yaml.broken
echo "=== æ–°çš„å·¥ä½œç©ºé—´é…ç½® ==="
cat pnpm-workspace.yaml
```

```bash {{ title: 'åŒ…ç»“æ„ä¿®å¤' }}
# éªŒè¯æ‰€æœ‰åŒ…çš„ç»“æ„
for pkg in packages/*/; do
  if [ ! -f "$pkg/package.json" ]; then
    echo "âŒ ç¼ºå°‘ package.json: $pkg"
  else
    echo "âœ… æ£€æŸ¥é€šè¿‡: $pkg"
    # éªŒè¯JSONæ ¼å¼
    node -e "JSON.parse(require('fs').readFileSync('$pkg/package.json'))"
  fi
done

# é‡æ–°é“¾æ¥å·¥ä½œç©ºé—´
pnpm install
```

</CodeGroup>

## æ—¥å¿—åˆ†æå’Œç›‘æ§

### å®æ—¶é—®é¢˜è¯Šæ–­

<CodeGroup>

```bash {{ title: 'å®æ—¶æ—¥å¿—ç›‘æ§' }}
# å¯åŠ¨è¯¦ç»†æ—¥å¿—æ¨¡å¼
DEBUG=pcu:*,pnpm:* pcu check --verbose 2>&1 | tee pcu-debug.log

# åœ¨å¦ä¸€ä¸ªç»ˆç«¯ç›‘æ§æ—¥å¿—
tail -f pcu-debug.log | grep -E "(ERROR|WARN|TIMEOUT)"

# åˆ†æç½‘ç»œè¯·æ±‚
DEBUG=pcu:registry pcu check 2>&1 | grep -E "(request|response)"
```

```bash {{ title: 'æ€§èƒ½ç›‘æ§' }}
# ç›‘æ§PCUè¿›ç¨‹æ€§èƒ½
#!/bin/bash
echo "æ—¶é—´,CPU%,å†…å­˜MB,ç½‘ç»œè¿æ¥" > pcu-monitor.csv

while pgrep -x pcu > /dev/null; do
  PID=$(pgrep -x pcu)
  CPU=$(ps -p $PID -o pcpu --no-headers)
  MEM=$(ps -p $PID -o rss --no-headers)
  MEM_MB=$((MEM / 1024))
  CONN=$(netstat -an | grep :443 | wc -l)

  echo "$(date '+%H:%M:%S'),$CPU,$MEM_MB,$CONN" >> pcu-monitor.csv
  sleep 1
done
```

</CodeGroup>

### é—®é¢˜æ¨¡å¼è¯†åˆ«

<CodeGroup>

```bash {{ title: 'å¸¸è§é”™è¯¯æ¨¡å¼æœç´¢' }}
# åˆ†ææ—¥å¿—ä¸­çš„é”™è¯¯æ¨¡å¼
grep -E "(ENOTFOUND|ETIMEDOUT|ECONNRESET)" pcu-debug.log | wc -l
grep -E "(403|404|500)" pcu-debug.log | sort | uniq -c
grep -E "memory.*exceeded" pcu-debug.log

# ç”Ÿæˆé”™è¯¯ç»Ÿè®¡æŠ¥å‘Š
echo "=== PCU é”™è¯¯ç»Ÿè®¡ ==="
echo "ç½‘ç»œé”™è¯¯: $(grep -c "ENET\|TIMEOUT" pcu-debug.log)"
echo "æƒé™é”™è¯¯: $(grep -c "403\|401\|EACCES" pcu-debug.log)"
echo "å†…å­˜é”™è¯¯: $(grep -c "memory\|heap" pcu-debug.log)"
echo "é…ç½®é”™è¯¯: $(grep -c "Invalid.*config" pcu-debug.log)"
```

</CodeGroup>

è¿™äº›é«˜çº§æ•…éšœæ’é™¤æŒ‡å—åº”è¯¥èƒ½å¸®åŠ©æ‚¨è§£å†³PCUä½¿ç”¨ä¸­é‡åˆ°çš„å¤æ‚é—®é¢˜ã€‚å¦‚æœé—®é¢˜ä»ç„¶å­˜åœ¨ï¼Œè¯·æŒ‰ç…§"è·å–å¸®åŠ©"éƒ¨åˆ†çš„æŒ‡å¯¼æ”¶é›†è¯Šæ–­ä¿¡æ¯å¹¶å¯»æ±‚æ”¯æŒã€‚
