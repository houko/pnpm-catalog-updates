export const metadata = {
  title: 'å¸¸è§é—®é¢˜',
  description: 'å…³äº PCU (pnpm-catalog-updates) çš„å¸¸è§é—®é¢˜ã€‚å¿«é€Ÿæ‰¾åˆ°å¸¸è§é—®é¢˜å’Œç–‘éš¾è§£ç­”ã€‚',
};

# å¸¸è§é—®é¢˜

å…³äº PCU å¸¸è§é—®é¢˜çš„å¿«é€Ÿè§£ç­”ã€‚æ‰¾ä¸åˆ°æ‚¨è¦æ‰¾çš„å†…å®¹ï¼Ÿè¯·æŸ¥çœ‹æˆ‘ä»¬çš„[æ•…éšœæ’é™¤æŒ‡å—](/troubleshooting)æˆ–[æäº¤é—®é¢˜](https://github.com/houko/pnpm-catalog-updates/issues)ã€‚{{ className: 'lead' }}

## å®‰è£…å’Œè®¾ç½®

### å¦‚ä½•å®‰è£… PCUï¼Ÿ

PCU å¯ä»¥é€šè¿‡ npmã€pnpm æˆ– yarn å…¨å±€å®‰è£…ï¼š

<CodeGroup>

```bash {{ title: 'npm' }}
npm install -g pnpm-catalog-updates
```

```bash {{ title: 'pnpm' }}
pnpm add -g pnpm-catalog-updates
```

```bash {{ title: 'yarn' }}
yarn global add pnpm-catalog-updates
```

```bash {{ title: 'npx (æ— éœ€å®‰è£…)' }}
npx pnpm-catalog-updates check
```

</CodeGroup>

### ç³»ç»Ÿè¦æ±‚æ˜¯ä»€ä¹ˆï¼Ÿ

- **Node.js**: >= 18.0.0 (æ¨è LTS ç‰ˆæœ¬)
- **pnpm**: >= 8.0.0
- **æ“ä½œç³»ç»Ÿ**: Windowsã€macOSã€Linux

### æˆ‘éœ€è¦ pnpm å·¥ä½œç©ºé—´æ‰èƒ½ä½¿ç”¨ PCU å—ï¼Ÿ

æ˜¯çš„ï¼ŒPCU ä¸“ä¸ºä½¿ç”¨ç›®å½•ä¾èµ–çš„ pnpm å·¥ä½œç©ºé—´è®¾è®¡ã€‚å¦‚æœæ‚¨è¿˜æ²¡æœ‰å·¥ä½œç©ºé—´ï¼Œè¯·è¿è¡Œ `pcu init` åˆ›å»ºä¸€ä¸ªã€‚

### æˆ‘å¯ä»¥åœ¨ npm æˆ– yarn é¡¹ç›®ä¸­ä½¿ç”¨ PCU å—ï¼Ÿ

ä¸å¯ä»¥ï¼ŒPCU ä¸“ç”¨äºä½¿ç”¨ç›®å½•ä¾èµ–çš„ pnpm å·¥ä½œç©ºé—´ã€‚å¯¹äºå…¶ä»–åŒ…ç®¡ç†å™¨ï¼Œè¯·è€ƒè™‘ä½¿ç”¨ `npm-check-updates` æˆ– `yarn upgrade-interactive` ç­‰å·¥å…·ã€‚

## é…ç½®

### æˆ‘åº”è¯¥å°† `.pcurc.json` é…ç½®æ–‡ä»¶æ”¾åœ¨å“ªé‡Œï¼Ÿ

å°†å…¶æ”¾åœ¨å·¥ä½œç©ºé—´æ ¹ç›®å½•ä¸­ï¼ˆä¸ `pnpm-workspace.yaml` åŒä¸€çº§åˆ«ï¼‰ã€‚PCU è¿˜æ”¯æŒï¼š

- å…¨å±€é…ç½®ï¼š`~/.pcurc.json`
- é¡¹ç›®é…ç½®ï¼š`./.pcurc.json`ï¼ˆæœ€é«˜ä¼˜å…ˆçº§ï¼‰

### å·¥ä½œç©ºé—´çº§åˆ«å’Œå…¨å±€é…ç½®æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ

- **å…¨å±€** (`~/.pcurc.json`)ï¼šåº”ç”¨äºä¸åŒé¡¹ç›®ä¸­çš„æ‰€æœ‰ PCU æ“ä½œ
- **é¡¹ç›®** (`./.pcurc.json`)ï¼šç‰¹å®šäºå½“å‰å·¥ä½œç©ºé—´ï¼Œè¦†ç›–å…¨å±€è®¾ç½®

### æˆ‘å¯ä»¥ä¸ºä¸åŒçš„åŒ…é…ç½®ä¸åŒçš„æ›´æ–°ç­–ç•¥å—ï¼Ÿ

å¯ä»¥ï¼åœ¨é…ç½®ä¸­ä½¿ç”¨åŒ…è§„åˆ™ï¼š

```json
{
  "packageRules": [
    {
      "patterns": ["react", "react-dom"],
      "target": "minor",
      "requireConfirmation": true
    },
    {
      "patterns": ["@types/*"],
      "target": "latest",
      "autoUpdate": true
    }
  ]
}
```

## å‘½ä»¤å’Œä½¿ç”¨

### `pcu check` å’Œ `pcu -c` æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ

å®ƒä»¬å®Œå…¨ç›¸åŒï¼PCU æ”¯æŒå®Œæ•´å‘½ä»¤åç§°å’Œç®€çŸ­åˆ«åï¼š

- `pcu check` = `pcu -c`
- `pcu update` = `pcu -u`
- `pcu interactive` = `pcu -i`

### å¦‚ä½•åªæ›´æ–°ç‰¹å®šç±»å‹çš„åŒ…ï¼Ÿ

ä½¿ç”¨ `--include` å’Œ `--exclude` æ ‡å¿—ï¼š

```bash
# ä»…æ›´æ–° React ç›¸å…³åŒ…
pcu update --include "react*"

# æ›´æ–°é™¤ä¸»è¦æ¡†æ¶å˜æ›´å¤–çš„æ‰€æœ‰å†…å®¹
pcu update --exclude "react*,vue*,angular*"

# ä»…æ›´æ–°ç±»å‹å®šä¹‰
pcu update --include "@types/*"
```

### æ›´æ–°ç›®æ ‡ä¹‹é—´æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ

- **`patch`**ï¼šä»…é”™è¯¯ä¿®å¤ (1.0.0 â†’ 1.0.1)
- **`minor`**ï¼šæ–°åŠŸèƒ½ï¼Œå‘åå…¼å®¹ (1.0.0 â†’ 1.1.0)
- **`latest`**ï¼šæœ€æ–°ç¨³å®šç‰ˆæœ¬ï¼ŒåŒ…æ‹¬ä¸»è¦æ›´æ”¹ (1.0.0 â†’ 2.0.0)
- **`greatest`**ï¼šæœ€æ–°ç‰ˆæœ¬ï¼ŒåŒ…æ‹¬é¢„å‘å¸ƒç‰ˆæœ¬ (1.0.0 â†’ 2.0.0-beta.1)

### åœ¨å®é™…æ›´æ–°ä¹‹å‰å¦‚ä½•æ£€æŸ¥å°†è¦æ›´æ–°çš„å†…å®¹ï¼Ÿ

ä½¿ç”¨ `--dry-run` æ ‡å¿—ï¼š

```bash
pcu update --dry-run --target minor
```

è¿™ä¼šæ˜¾ç¤ºå°†è¦æ›´æ–°çš„ç¡®åˆ‡å†…å®¹ï¼Œè€Œä¸ä¼šè¿›è¡Œä»»ä½•æ›´æ”¹ã€‚

## æ•…éšœæ’é™¤

### ä¸ºä»€ä¹ˆ PCU è¯´"æœªæ‰¾åˆ° pnpm å·¥ä½œç©ºé—´"ï¼Ÿ

è¿™æ„å‘³ç€ PCU åœ¨æ‚¨çš„å½“å‰ç›®å½•ä¸­æ‰¾ä¸åˆ° `pnpm-workspace.yaml` æ–‡ä»¶ã€‚è§£å†³æ–¹æ¡ˆï¼š

1. **åˆ›å»ºå·¥ä½œç©ºé—´**ï¼šè¿è¡Œ `pcu init`
2. **å¯¼èˆªåˆ°å·¥ä½œç©ºé—´æ ¹**ï¼š`cd` åˆ°åŒ…å« `pnpm-workspace.yaml` çš„ç›®å½•
3. **æŒ‡å®šå·¥ä½œç©ºé—´è·¯å¾„**ï¼š`pcu -c --workspace /path/to/workspace`

### ä¸ºä»€ä¹ˆ PCU è¯´"æœªæ‰¾åˆ°ç›®å½•ä¾èµ–"ï¼Ÿ

æ‚¨çš„å·¥ä½œç©ºé—´å°šæœªä½¿ç”¨ç›®å½•ä¾èµ–ã€‚æ‚¨éœ€è¦ï¼š

1. **å·¥ä½œç©ºé—´æ–‡ä»¶ä¸­çš„ç›®å½•**ï¼š

   ```yaml
   # pnpm-workspace.yaml
   packages:
     - 'packages/*'

   catalog:
     react: ^18.2.0
     typescript: ^5.0.0
   ```

2. **åœ¨åŒ…ä¸­ä½¿ç”¨ç›®å½•**ï¼š
   ```json
   {
     "dependencies": {
       "react": "catalog:",
       "typescript": "catalog:"
     }
   }
   ```

### PCU è¿è¡Œéå¸¸ç¼“æ…¢ã€‚å¦‚ä½•æé«˜æ€§èƒ½ï¼Ÿ

å°è¯•è¿™äº›ä¼˜åŒ–ï¼š

1. **å‡å°‘å¹¶å‘æ•°**ï¼š`pcu check --concurrency 2`
2. **å¢åŠ è¶…æ—¶æ—¶é—´**ï¼š`pcu check --timeout 60000`
3. **å¯ç”¨ç¼“å­˜**ï¼šç¡®ä¿ `PCU_CACHE_ENABLED=true`ï¼ˆé»˜è®¤ï¼‰
4. **ä½¿ç”¨è¿‡æ»¤**ï¼š`pcu check --include "react*"` é’ˆå¯¹ç‰¹å®šåŒ…

### å¦‚ä½•ä¿®å¤"ENOTFOUND registry.npmjs.org"é”™è¯¯ï¼Ÿ

è¿™æ˜¯ç½‘ç»œè¿æ¥é—®é¢˜ï¼š

1. **æ£€æŸ¥ç½‘ç»œè¿æ¥**ï¼š`ping registry.npmjs.org`
2. **é…ç½®ä»£ç†**ï¼šè®¾ç½® `HTTP_PROXY` å’Œ `HTTPS_PROXY` ç¯å¢ƒå˜é‡
3. **ä½¿ç”¨ä¼ä¸šæ³¨å†Œè¡¨**ï¼šåœ¨ `.npmrc` ä¸­é…ç½®å…¬å¸æ³¨å†Œè¡¨
4. **å¢åŠ è¶…æ—¶æ—¶é—´**ï¼š`PCU_TIMEOUT=120000 pcu check`

## å®‰å…¨

### PCU å¦‚ä½•å¤„ç†å®‰å…¨æ¼æ´ï¼Ÿ

PCU é›†æˆäº† npm audit å’Œå¯é€‰çš„ Snykï¼š

```bash
# æ£€æŸ¥æ¼æ´
pcu security

# è‡ªåŠ¨ä¿®å¤å®‰å…¨é—®é¢˜
pcu security --fix-vulns

# åŒ…æ‹¬ Snyk æ‰«æ
pcu security --snyk --severity high
```

### æˆ‘åº”è¯¥è‡ªåŠ¨ä¿®å¤æ‰€æœ‰å®‰å…¨æ¼æ´å—ï¼Ÿ

ä½¿ç”¨ `--auto-fix` æ—¶è¦è°¨æ…ï¼š

- âœ… **å®‰å…¨**ï¼šå®‰å…¨ä¿®å¤çš„è¡¥ä¸å’Œå°ç‰ˆæœ¬æ›´æ–°
- âš ï¸ **éœ€å®¡æŸ¥**ï¼šå¯èƒ½ç ´ååº”ç”¨çš„ä¸»ç‰ˆæœ¬æ›´æ–°
- âŒ **é¿å…**ï¼šåœ¨ç”Ÿäº§ç¯å¢ƒä¸­ç›²ç›®è‡ªåŠ¨ä¿®å¤è€Œä¸æµ‹è¯•

### å¦‚ä½•å¤„ç†è¯¯æŠ¥çš„å®‰å…¨è­¦å‘Šï¼Ÿ

åœ¨ `.pcurc.json` ä¸­é…ç½®å¿½ç•¥çš„æ¼æ´ï¼š

```json
{
  "security": {
    "ignoredVulnerabilities": ["CVE-2021-23337"],
    "ignoredPackages": ["lodash@4.17.20"],
    "customAuditConfig": {
      "low": "ignore",
      "moderate": "warn"
    }
  }
}
```

## å·¥ä½œæµå’Œ CI/CD

### æˆ‘å¯ä»¥åœ¨ CI/CD æµæ°´çº¿ä¸­ä½¿ç”¨ PCU å—ï¼Ÿ

å½“ç„¶å¯ä»¥ï¼PCU ä¸“ä¸ºè‡ªåŠ¨åŒ–è€Œè®¾è®¡ï¼š

```bash
# CI å‹å¥½çš„å‘½ä»¤
PCU_NO_COLOR=true pcu check --format json
pcu security --format json --severity critical
```

æŸ¥çœ‹æˆ‘ä»¬çš„ [CI/CD é›†æˆæŒ‡å—](/cicd) äº†è§£å®Œæ•´ç¤ºä¾‹ã€‚

### å¦‚ä½•åˆ›å»ºè‡ªåŠ¨åŒ–ä¾èµ–æ›´æ–° PRï¼Ÿ

å°† PCU ä¸ GitHub Actionsã€GitLab CI æˆ–å…¶ä»–å¹³å°ç»“åˆä½¿ç”¨ï¼š

```yaml
- name: æ›´æ–°ä¾èµ–
  run: |
    pcu update --target minor --create-backup
    # ä½¿ç”¨æ›´æ”¹åˆ›å»º PR
```

æŸ¥çœ‹ [CI/CD é›†æˆæŒ‡å—](/cicd) äº†è§£å®Œæ•´å·¥ä½œæµã€‚

### å›¢é˜Ÿåä½œçš„æœ€ä½³å·¥ä½œæµæ˜¯ä»€ä¹ˆï¼Ÿ

1. **å…±äº«é…ç½®**ï¼šå°† `.pcurc.json` æäº¤åˆ°ç‰ˆæœ¬æ§åˆ¶
2. **å®šæœŸå®¡æŸ¥**ï¼šå®‰æ’æ¯å‘¨ä¾èµ–å®¡æŸ¥ä¼šè®®
3. **å®‰å…¨ä¼˜å…ˆ**ï¼šå§‹ç»ˆä¼˜å…ˆå¤„ç†å®‰å…¨æ›´æ–°
4. **å¢é‡æ›´æ–°**ï¼šåå¥½å°è€Œé¢‘ç¹çš„æ›´æ–°è€Œéå¤§æ‰¹é‡æ›´æ–°
5. **æµ‹è¯•**ï¼šæ›´æ–°åå§‹ç»ˆæµ‹è¯•å†åˆå¹¶

## é«˜çº§ç”¨æ³•

### æˆ‘å¯ä»¥åœ¨ä¸€ä¸ªå·¥ä½œç©ºé—´ä¸­ä½¿ç”¨å¤šä¸ªç›®å½•å—ï¼Ÿ

å¯ä»¥ï¼PNPM æ”¯æŒå¤šä¸ªç›®å½•ï¼š

```yaml
# pnpm-workspace.yaml
packages:
  - 'packages/*'

catalog:
  react: ^18.2.0

catalogs:
  react17:
    react: ^17.0.2
  experimental:
    react: ^19.0.0-beta
```

ç„¶ååœ¨åŒ…ä¸­ä½¿ç”¨å®ƒä»¬ï¼š

```json
{
  "dependencies": {
    "react": "catalog:react17"
  }
}
```

### å¦‚ä½•åˆ†ææ›´æ–°ç‰¹å®šåŒ…çš„å½±å“ï¼Ÿ

ä½¿ç”¨åˆ†æå‘½ä»¤ï¼š

```bash
# åˆ†ææ›´æ–° React çš„å½±å“
pcu analyze default react 18.3.0

# æ£€æŸ¥æ‰€æœ‰ç›®å½•
pcu analyze react17 react 17.0.3
```

### æˆ‘å¯ä»¥æ°¸ä¹…æ’é™¤æŸäº›åŒ…çš„æ›´æ–°å—ï¼Ÿ

å¯ä»¥ï¼Œåœ¨ `.pcurc.json` ä¸­é…ç½®æ’é™¤é¡¹ï¼š

```json
{
  "exclude": ["react", "vue", "@types/node"],
  "packageRules": [
    {
      "patterns": ["critical-*"],
      "exclude": true
    }
  ]
}
```

### å¦‚ä½•å¤„ç†æœ‰ 100+ åŒ…çš„ monorepoï¼Ÿ

å¤§å‹ monorepo çš„æ€§èƒ½æŠ€å·§ï¼š

1. **æ‰¹å¤„ç†**ï¼šåœ¨é«˜çº§è®¾ç½®ä¸­é…ç½® `batchSize: 10`
2. **å‡å°‘å¹¶å‘æ•°**ï¼šè®¾ç½® `concurrency: 2` é¿å…å‹å®æ³¨å†Œè¡¨
3. **ä½¿ç”¨è¿‡æ»¤**ï¼šä½¿ç”¨ `--include` æ¨¡å¼æŒ‰ç»„å¤„ç†åŒ…
4. **å¯ç”¨ç¼“å­˜**ï¼šç¡®ä¿ç¼“å­˜å·²å¯ç”¨å¹¶æ­£ç¡®é…ç½®
5. **å¢åŠ å†…å­˜**ï¼šè®¾ç½® `NODE_OPTIONS="--max-old-space-size=8192"`

## é”™è¯¯æ¶ˆæ¯

### "æ— æ³•è§£æå¯¹ç­‰ä¾èµ–"

å½“åŒ…ç‰ˆæœ¬å†²çªæ—¶ä¼šå‘ç”Ÿè¿™ç§æƒ…å†µã€‚è§£å†³æ–¹æ¡ˆï¼š

1. **ä¸€èµ·æ›´æ–°ç›¸å…³åŒ…**ï¼š`pcu update --include "react*"`
2. **ä½¿ç”¨äº¤äº’æ¨¡å¼**ï¼š`pcu update --interactive` ä»”ç»†é€‰æ‹©ç‰ˆæœ¬
3. **æ£€æŸ¥å¯¹ç­‰ä¾èµ–**ï¼šå®¡æŸ¥æ¯ä¸ªåŒ…çš„è¦æ±‚
4. **ä½¿ç”¨å¤šä¸ªç›®å½•**ï¼šå°†å†²çªç‰ˆæœ¬åˆ†ç¦»åˆ°ä¸åŒç›®å½•

### ".pcurc.json ä¸­çš„é…ç½®æ— æ•ˆ"

æ‚¨çš„é…ç½®æ–‡ä»¶æœ‰ JSON è¯­æ³•é”™è¯¯ï¼š

```bash
# éªŒè¯ JSON è¯­æ³•
node -e "JSON.parse(require('fs').readFileSync('.pcurc.json', 'utf8'))"

# å¦‚éœ€è¦é‡æ–°ç”Ÿæˆé…ç½®
mv .pcurc.json .pcurc.json.backup
pcu init --force
```

### "æ‰¾ä¸åˆ°å‘½ä»¤ï¼špcu"

å®‰è£…æˆ– PATH é—®é¢˜ï¼š

1. **é‡æ–°å…¨å±€å®‰è£…**ï¼š`npm install -g pnpm-catalog-updates`
2. **æ£€æŸ¥ PATH**ï¼šç¡®ä¿ npm å…¨å±€ bin åœ¨æ‚¨çš„ PATH ä¸­
3. **ä½¿ç”¨ npx**ï¼š`npx pnpm-catalog-updates check` ä½œä¸ºæ›¿ä»£
4. **ä½¿ç”¨ pnpm**ï¼š`pnpm add -g pnpm-catalog-updates`ï¼ˆæ¨èï¼‰

## é›†æˆå’Œå·¥å…·

### PCU ä¸ Renovate æˆ– Dependabot å…¼å®¹å—ï¼Ÿ

PCU æ˜¯è¿™äº›å·¥å…·çš„æ›¿ä»£æ–¹æ¡ˆï¼Œä¸æ˜¯è¡¥å……ï¼š

- **PCU**ï¼šæ‰‹åŠ¨æ§åˆ¶ï¼Œpnpm ç‰¹å®šï¼Œä¸“æ³¨ç›®å½•
- **Renovate**ï¼šè‡ªåŠ¨åŒ– PRï¼Œæ”¯æŒå¤šç§åŒ…ç®¡ç†å™¨
- **Dependabot**ï¼šGitHub é›†æˆï¼Œè‡ªåŠ¨å®‰å…¨æ›´æ–°

æ ¹æ®æ‚¨çš„å·¥ä½œæµåå¥½é€‰æ‹©ã€‚æœ‰å…³è¿ç§»ï¼Œè¯·æŸ¥çœ‹æˆ‘ä»¬çš„[è¿ç§»æŒ‡å—](/examples#ä»å…¶ä»–å·¥å…·è¿ç§»)ã€‚

### æˆ‘å¯ä»¥å°† PCU ä¸ IDE é›†æˆå—ï¼Ÿ

è™½ç„¶æ²¡æœ‰å®˜æ–¹ IDE æ‰©å±•ï¼Œä½†æ‚¨å¯ä»¥ï¼š

1. **æ·»åŠ  npm è„šæœ¬**ï¼šåœ¨ `package.json` ä¸­é…ç½®å‘½ä»¤
2. **ä½¿ç”¨ä»»åŠ¡è¿è¡Œå™¨**ï¼šä¸ VS Code ä»»åŠ¡æˆ–ç±»ä¼¼å·¥å…·é›†æˆ
3. **ç»ˆç«¯é›†æˆ**ï¼šå¤§å¤šæ•° IDE æ”¯æŒç»ˆç«¯é›†æˆ

### PCU æ”¯æŒç§æœ‰ npm æ³¨å†Œè¡¨å—ï¼Ÿ

æ”¯æŒï¼PCU è¯»å–æ‚¨çš„ `.npmrc` é…ç½®ï¼š

```ini
# .npmrc
@mycompany:registry=https://npm.company.com/
//npm.company.com/:_authToken=${NPM_TOKEN}
```

PCU ä¼šè‡ªåŠ¨ä¸ºæ¯ä¸ªåŒ…èŒƒå›´ä½¿ç”¨æ­£ç¡®çš„æ³¨å†Œè¡¨ã€‚

---

## ä»æœ‰ç–‘é—®ï¼Ÿ

- ğŸ“– **æ–‡æ¡£**ï¼šæŸ¥çœ‹æˆ‘ä»¬å…¨é¢çš„[å‘½ä»¤å‚è€ƒ](/command-reference)
- ğŸ› ï¸ **æ•…éšœæ’é™¤**ï¼šè®¿é—®æˆ‘ä»¬çš„[æ•…éšœæ’é™¤æŒ‡å—](/troubleshooting)
- ğŸ› **é”™è¯¯æŠ¥å‘Š**ï¼š[åˆ›å»ºé—®é¢˜](https://github.com/houko/pnpm-catalog-updates/issues)
- ğŸ’¬ **è®¨è®º**ï¼š[GitHub è®¨è®º](https://github.com/houko/pnpm-catalog-updates/discussions)
