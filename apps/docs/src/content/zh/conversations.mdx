export const metadata = {
  title: '示例',
  description: 'pnpm-catalog-updates 的真实世界示例和用例。从实际场景和常见工作流中学习。',
};

# 示例

真实世界的示例和用例，帮助您充分利用 PCU。从简单更新到复杂的 monorepo 管理。{{ className: 'lead' }}

## 基本工作流

### 日常依赖检查

作为日常开发例程的一部分检查更新：

<CodeGroup>

```bash {{ title: '快速检查' }}
# 使用简单输出检查更新
pcu -c --format minimal

# 示例输出：
# react           ^18.2.0  →  ^18.3.0
# typescript      ^5.0.0   →  ^5.2.0
# @types/node     ^18.0.0  →  ^20.0.0
```

```bash {{ title: '详细检查' }}
# 使用完整表格格式检查
pcu -c

# 显示彩色表格，包括：
# - 包名称
# - 当前版本
# - 可用版本
# - 更新类型（major/minor/patch）
# - 安全指示器
```

</CodeGroup>

### 带备份的安全更新

使用自动备份安全地更新依赖：

```bash
# 带备份的交互式更新
pcu -i -b

# 或带备份的自动化小版本更新
pcu -u --target minor --create-backup
```

### 目标特定更新

仅更新特定类型的更改：

<CodeGroup>

```bash {{ title: '保守更新' }}
# 仅补丁更新（错误修复）
pcu -u --target patch

# 仅小版本更新（新功能，无破坏性变更）
pcu -u --target minor
```

```bash {{ title: '最新一切' }}
# 更新到最新版本（包括主版本）
pcu -u --target latest

# 包含预发布版本
pcu -u --prerelease
```

</CodeGroup>

## 多目录工作空间

### 遗留支持场景

在一个工作空间中管理多个 React 版本：

<CodeGroup>

```yaml {{ title: 'pnpm-workspace.yaml' }}
packages:
  - "apps/*"
  - "packages/*"

catalog:
  # 默认目录 - 最新版本
  react: ^18.2.0
  react-dom: ^18.2.0
  @types/react: ^18.2.0

catalogs:
  # 遗留支持
  react17:
    react: ^17.0.2
    react-dom: ^17.0.2
    @types/react: ^17.0.62

  # 测试版测试
  react-next:
    react: ^19.0.0-beta
    react-dom: ^19.0.0-beta
```

```bash {{ title: '目录特定更新' }}
# 仅更新默认目录
pcu -u --catalog default

# 更新遗留 React 版本
pcu -u --catalog react17 --target minor

# 检查测试版本
pcu -c --catalog react-next --prerelease
```

</CodeGroup>

### 包使用

```json {{ title: 'package.json' }}
{
  "name": "@myorg/modern-app",
  "dependencies": {
    "react": "catalog:",
    "react-dom": "catalog:"
  }
}
```

```json {{ title: '遗留 package.json' }}
{
  "name": "@myorg/legacy-app",
  "dependencies": {
    "react": "catalog:react17",
    "react-dom": "catalog:react17"
  }
}
```

## 配置示例

### React 生态系统管理

React 和相关包的协调更新：

```json {{ title: '.pcurc.json' }}
{
  "packageRules": [
    {
      "patterns": ["react", "react-dom"],
      "target": "minor",
      "requireConfirmation": true,
      "relatedPackages": [
        "@types/react",
        "@types/react-dom",
        "react-router-dom",
        "@testing-library/react"
      ]
    }
  ],
  "security": {
    "autoFixVulnerabilities": true,
    "allowMajorForSecurity": true
  }
}
```

### TypeScript 项目配置

保守的 TypeScript 更新与自动类型定义：

```json {{ title: '.pcurc.json' }}
{
  "packageRules": [
    {
      "patterns": ["typescript"],
      "target": "minor",
      "requireConfirmation": true
    },
    {
      "patterns": ["@types/*"],
      "target": "latest",
      "autoUpdate": true
    },
    {
      "patterns": ["eslint*", "@typescript-eslint/*"],
      "target": "minor",
      "groupUpdate": true
    }
  ]
}
```

### 企业配置

企业级配置，具有严格控制：

```json {{ title: '.pcurc.json' }}
{
  "defaults": {
    "target": "minor",
    "createBackup": true
  },
  "exclude": ["typescript", "@types/node", "react", "react-dom"],
  "security": {
    "autoFixVulnerabilities": true,
    "allowMajorForSecurity": true,
    "notifyOnSecurityUpdate": true
  },
  "advanced": {
    "concurrency": 3,
    "timeout": 60000,
    "retries": 5
  },
  "ui": {
    "theme": "minimal",
    "animations": false
  }
}
```

## CI/CD 集成

### GitHub Actions

在 CI 流水线中自动化依赖检查：

<CodeGroup>

```yaml {{ title: '.github/workflows/dependencies.yml' }}
name: Check Dependencies

on:
  schedule:
    - cron: '0 9 * * MON'  # 每周一上午 9 点
  workflow_dispatch:

jobs:
  check-deps:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-node@v4
        with:
          node-version: '20'

      - name: Install PCU
        run: npm install -g pnpm-catalog-updates

      - name: Check for updates
        run: pcu -c --format json > updates.json

      - name: Create Issue if Updates Available
        if: success()
        uses: actions/github-script@v7
        with:
          script: |
            const fs = require('fs');
            const updates = JSON.parse(fs.readFileSync('updates.json', 'utf8'));
            if (updates.length > 0) {
              github.rest.issues.create({
                owner: context.repo.owner,
                repo: context.repo.repo,
                title: 'Dependencies Update Available',
                body: `Found ${updates.length} packages that can be updated:

` +
                      updates.map(u => `- ${u.package}: ${u.current} → ${u.available}`).join('
')
              });
            }
```

```bash {{ title: 'Package.json 脚本' }}
# 添加到您的 package.json
{
  "scripts": {
    "deps:check": "pcu -c",
    "deps:update": "pcu -i -b",
    "deps:update-minor": "pcu -u --target minor --create-backup",
    "deps:analyze": "pcu -a default"
  }
}
```

</CodeGroup>

## 错误处理和故障排除

### 网络问题

处理网络问题和注册表访问：

```bash
# 为慢连接增加超时
pcu -c --timeout 60000

# 为不稳定网络减少并发
pcu -u --concurrency 2
```

### 工作空间验证

验证工作空间设置：

```bash
# 检查工作空间配置
pcu -s --validate

# 获取详细工作空间信息
pcu -s --stats --verbose
```

### 私有注册表

PCU 自动读取 `.npmrc` 和 `.pnpmrc` 配置：

<CodeGroup>

```ini {{ title: '.npmrc' }}
@myorg:registry=https://npm.private-registry.com/
//npm.private-registry.com/:_authToken=${NPM_TOKEN}

registry=https://registry.npmjs.org/
```

```bash {{ title: '使用方法' }}
# PCU 将自动使用您的注册表设置
pcu -c

# 检查来自私有注册表的包
pcu -c --include "@myorg/*"
```

</CodeGroup>

## 高级用例

### 影响分析

分析更新特定包的影响：

```bash
# 分析 React 更新影响
pcu -a default react

# 使用特定版本分析
pcu -a default react 18.3.0

# 检查所有目录中的影响
pcu -a react17 react 17.0.3
```

### 选择性更新

仅更新特定包或模式：

```bash
# 仅更新 React 相关包
pcu -u --include "react*"

# 更新除核心框架外的所有内容
pcu -u --exclude "react*,vue*,angular*"

# 仅更新类型定义
pcu -u --include "@types/*" --target latest
```

### 试运行分析

在应用之前预览更改：

```bash
# 查看将被更新的内容
pcu -u --dry-run --verbose

# 预览特定目标
pcu -u --dry-run --target minor --include "@types/*"
```

## 最佳实践

### 日常工作流

1. **晨间检查**：`pcu -c` 查看可用更新
2. **审查影响**：对重要更新使用 `pcu -a`
3. **安全更新**：使用 `pcu -i -b` 进行带备份的交互式更新
4. **测试**：更新后运行测试套件
5. **提交**：单独提交依赖更新

### 团队工作流

1. **共享配置**：将 `.pcurc.json` 提交到版本控制
2. **定期审查**：安排每周依赖审查会议
3. **安全优先**：始终优先处理安全更新
4. **文档记录**：记录主要依赖决策
5. **回滚计划**：保留备份以便轻松回滚

### 发布工作流

1. **预发布检查**：发布前 `pcu -c --target patch`
2. **安全扫描**：在 CI 中启用 `autoFixVulnerabilities`
3. **版本固定**：生产发布使用精确版本
4. **更新计划**：在发布之间规划依赖更新export const metadata = {
   title: '示例',
   description:
   'pnpm-catalog-updates 的真实世界示例和用例。从实际场景和常见工作流中学习。',
   };

# 示例

真实世界的示例和用例，帮助您充分利用 PCU。从简单更新到复杂的 monorepo 管理。{{ className: 'lead' }}

## 基本工作流

### 日常依赖检查

作为日常开发例程的一部分检查更新：

<CodeGroup>

```bash {{ title: '快速检查' }}
# 使用简单输出检查更新
pcu -c --format minimal

# 示例输出：
# react           ^18.2.0  →  ^18.3.0
# typescript      ^5.0.0   →  ^5.2.0
# @types/node     ^18.0.0  →  ^20.0.0
```

```bash {{ title: '详细检查' }}
# 使用完整表格格式检查
pcu -c

# 显示彩色表格，包括：
# - 包名称
# - 当前版本
# - 可用版本
# - 更新类型（major/minor/patch）
# - 安全指示器
```

</CodeGroup>

### 带备份的安全更新

使用自动备份安全地更新依赖：

```bash
# 带备份的交互式更新
pcu -i -b

# 或带备份的自动化小版本更新
pcu -u --target minor --create-backup
```

### 目标特定更新

仅更新特定类型的更改：

<CodeGroup>

```bash {{ title: '保守更新' }}
# 仅补丁更新（错误修复）
pcu -u --target patch

# 仅小版本更新（新功能，无破坏性变更）
pcu -u --target minor
```

```bash {{ title: '最新一切' }}
# 更新到最新版本（包括主版本）
pcu -u --target latest

# 包含预发布版本
pcu -u --prerelease
```

</CodeGroup>

## 多目录工作空间

### 遗留支持场景

在一个工作空间中管理多个 React 版本：

<CodeGroup>

```yaml {{ title: 'pnpm-workspace.yaml' }}
packages:
  - "apps/*"
  - "packages/*"

catalog:
  # 默认目录 - 最新版本
  react: ^18.2.0
  react-dom: ^18.2.0
  @types/react: ^18.2.0

catalogs:
  # 遗留支持
  react17:
    react: ^17.0.2
    react-dom: ^17.0.2
    @types/react: ^17.0.62

  # 测试版测试
  react-next:
    react: ^19.0.0-beta
    react-dom: ^19.0.0-beta
```

```bash {{ title: '目录特定更新' }}
# 仅更新默认目录
pcu -u --catalog default

# 更新遗留 React 版本
pcu -u --catalog react17 --target minor

# 检查测试版本
pcu -c --catalog react-next --prerelease
```

</CodeGroup>

### 包使用

```json {{ title: 'package.json' }}
{
  "name": "@myorg/modern-app",
  "dependencies": {
    "react": "catalog:",
    "react-dom": "catalog:"
  }
}
```

```json {{ title: '遗留 package.json' }}
{
  "name": "@myorg/legacy-app",
  "dependencies": {
    "react": "catalog:react17",
    "react-dom": "catalog:react17"
  }
}
```

## 配置示例

### React 生态系统管理

React 和相关包的协调更新：

```json {{ title: '.pcurc.json' }}
{
  "packageRules": [
    {
      "patterns": ["react", "react-dom"],
      "target": "minor",
      "requireConfirmation": true,
      "relatedPackages": [
        "@types/react",
        "@types/react-dom",
        "react-router-dom",
        "@testing-library/react"
      ]
    }
  ],
  "security": {
    "autoFixVulnerabilities": true,
    "allowMajorForSecurity": true
  }
}
```

### TypeScript 项目配置

保守的 TypeScript 更新与自动类型定义：

```json {{ title: '.pcurc.json' }}
{
  "packageRules": [
    {
      "patterns": ["typescript"],
      "target": "minor",
      "requireConfirmation": true
    },
    {
      "patterns": ["@types/*"],
      "target": "latest",
      "autoUpdate": true
    },
    {
      "patterns": ["eslint*", "@typescript-eslint/*"],
      "target": "minor",
      "groupUpdate": true
    }
  ]
}
```

### 企业配置

企业级配置，具有严格控制：

```json {{ title: '.pcurc.json' }}
{
  "defaults": {
    "target": "minor",
    "createBackup": true
  },
  "exclude": ["typescript", "@types/node", "react", "react-dom"],
  "security": {
    "autoFixVulnerabilities": true,
    "allowMajorForSecurity": true,
    "notifyOnSecurityUpdate": true
  },
  "advanced": {
    "concurrency": 3,
    "timeout": 60000,
    "retries": 5
  },
  "ui": {
    "theme": "minimal",
    "animations": false
  }
}
```

## CI/CD 集成

### GitHub Actions

在 CI 流水线中自动化依赖检查：

<CodeGroup>

```yaml {{ title: '.github/workflows/dependencies.yml' }}
name: Check Dependencies

on:
  schedule:
    - cron: '0 9 * * MON'  # 每周一上午 9 点
  workflow_dispatch:

jobs:
  check-deps:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-node@v4
        with:
          node-version: '20'

      - name: Install PCU
        run: npm install -g pnpm-catalog-updates

      - name: Check for updates
        run: pcu -c --format json > updates.json

      - name: Create Issue if Updates Available
        if: success()
        uses: actions/github-script@v7
        with:
          script: |
            const fs = require('fs');
            const updates = JSON.parse(fs.readFileSync('updates.json', 'utf8'));
            if (updates.length > 0) {
              github.rest.issues.create({
                owner: context.repo.owner,
                repo: context.repo.repo,
                title: 'Dependencies Update Available',
                body: `Found ${updates.length} packages that can be updated:

` +
                      updates.map(u => `- ${u.package}: ${u.current} → ${u.available}`).join('
')
              });
            }
```

```bash {{ title: 'Package.json 脚本' }}
# 添加到您的 package.json
{
  "scripts": {
    "deps:check": "pcu -c",
    "deps:update": "pcu -i -b",
    "deps:update-minor": "pcu -u --target minor --create-backup",
    "deps:analyze": "pcu -a default"
  }
}
```

</CodeGroup>

## 错误处理和故障排除

### 网络问题

处理网络问题和注册表访问：

```bash
# 为慢连接增加超时
pcu -c --timeout 60000

# 为不稳定网络减少并发
pcu -u --concurrency 2
```

### 工作空间验证

验证工作空间设置：

```bash
# 检查工作空间配置
pcu -s --validate

# 获取详细工作空间信息
pcu -s --stats --verbose
```

### 私有注册表

PCU 自动读取 `.npmrc` 和 `.pnpmrc` 配置：

<CodeGroup>

```ini {{ title: '.npmrc' }}
@myorg:registry=https://npm.private-registry.com/
//npm.private-registry.com/:_authToken=${NPM_TOKEN}

registry=https://registry.npmjs.org/
```

```bash {{ title: '使用方法' }}
# PCU 将自动使用您的注册表设置
pcu -c

# 检查来自私有注册表的包
pcu -c --include "@myorg/*"
```

</CodeGroup>

## 高级用例

### 影响分析

分析更新特定包的影响：

```bash
# 分析 React 更新影响
pcu -a default react

# 使用特定版本分析
pcu -a default react 18.3.0

# 检查所有目录中的影响
pcu -a react17 react 17.0.3
```

### 选择性更新

仅更新特定包或模式：

```bash
# 仅更新 React 相关包
pcu -u --include "react*"

# 更新除核心框架外的所有内容
pcu -u --exclude "react*,vue*,angular*"

# 仅更新类型定义
pcu -u --include "@types/*" --target latest
```

### 试运行分析

在应用之前预览更改：

```bash
# 查看将被更新的内容
pcu -u --dry-run --verbose

# 预览特定目标
pcu -u --dry-run --target minor --include "@types/*"
```

## 最佳实践

### 日常工作流

1. **晨间检查**：`pcu -c` 查看可用更新
2. **审查影响**：对重要更新使用 `pcu -a`
3. **安全更新**：使用 `pcu -i -b` 进行带备份的交互式更新
4. **测试**：更新后运行测试套件
5. **提交**：单独提交依赖更新

### 团队工作流

1. **共享配置**：将 `.pcurc.json` 提交到版本控制
2. **定期审查**：安排每周依赖审查会议
3. **安全优先**：始终优先处理安全更新
4. **文档记录**：记录主要依赖决策
5. **回滚计划**：保留备份以便轻松回滚

### 发布工作流

1. **预发布检查**：发布前 `pcu -c --target patch`
2. **安全扫描**：在 CI 中启用 `autoFixVulnerabilities`
3. **版本固定**：生产发布使用精确版本
4. **更新计划**：在发布之间规划依赖更新
