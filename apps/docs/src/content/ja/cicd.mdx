export const metadata = {
  title: 'CI/CDçµ±åˆ',
  description:
    'PCUã‚’ç¶™ç¶šçš„ã‚¤ãƒ³ãƒ†ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãŠã‚ˆã³ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã«çµ±åˆã—ã€è‡ªå‹•åŒ–ã•ã‚ŒãŸä¾å­˜é–¢ä¿‚ç®¡ç†ã‚’å®Ÿç¾ã—ã¾ã™ã€‚',
};

# CI/CDçµ±åˆ

PCUã‚’ç¶™ç¶šçš„ã‚¤ãƒ³ãƒ†ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãŠã‚ˆã³ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã«çµ±åˆã—ã¾ã™ã€‚PCUã¯æ—¢å­˜ã®CI/CDãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã«ã‚·ãƒ¼ãƒ ãƒ¬ã‚¹ã«çµ±åˆã§ãã€GitHub Actionsã€GitLab CIã€Jenkinsã€Azure DevOpsãªã©ã®ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã‚’ã‚µãƒãƒ¼ãƒˆã—ã¾ã™ã€‚{{ className: 'lead' }}

## GitHub Actionsçµ±åˆ

### åŸºæœ¬çš„ãªä¾å­˜é–¢ä¿‚ãƒã‚§ãƒƒã‚¯ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼

<CodeGroup>

```yaml {{ title: 'åŸºæœ¬çš„ãªä¾å­˜é–¢ä¿‚ãƒã‚§ãƒƒã‚¯' }}
name: PCU Dependency Check
on:
  push:
    branches: [main, develop]
  pull_request:
    branches: [main]

jobs:
  check-dependencies:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v4

      - uses: pnpm/action-setup@v2
        with:
          version: latest

      - uses: actions/setup-node@v4
        with:
          node-version: '18'
          cache: 'pnpm'

      - name: ä¾å­˜é–¢ä¿‚ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
        run: pnpm install

      - name: PCUã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
        run: pnpm add -g pnpm-catalog-updates

      - name: æ›´æ–°ã®ãƒã‚§ãƒƒã‚¯
        run: pcu -c --format table

      - name: ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚¹ã‚­ãƒ£ãƒ³
        run: pcu security --severity high
```

```yaml {{ title: 'é«˜åº¦ãªæ›´æ–°ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼' }}
name: PCUé«˜åº¦ãªãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼

on:
  schedule:
    - cron: '0 8 * * MON' # æ¯é€±æœˆæ›œæ—¥åˆå‰8æ™‚
  workflow_dispatch:
    inputs:
      update_target:
        description: 'æ›´æ–°å¯¾è±¡'
        required: false
        default: 'minor'
        type: choice
        options:
          - patch
          - minor
          - latest

jobs:
  update-dependencies:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v4
        with:
          token: ${{ secrets.GITHUB_TOKEN }}

      - uses: pnpm/action-setup@v2
        with:
          version: latest

      - uses: actions/setup-node@v4
        with:
          node-version: '18'
          cache: 'pnpm'

      - name: ä¾å­˜é–¢ä¿‚ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
        run: pnpm install

      - name: PCUã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
        run: pnpm add -g pnpm-catalog-updates

      - name: Gitã®è¨­å®š
        run: |
          git config user.name "PCU Bot"
          git config user.email "pcu-bot@github-actions.com"

      - name: æ›´æ–°ã®ãƒã‚§ãƒƒã‚¯
        id: check-updates
        run: |
          pcu -c --format json > updates.json
          if [ -s updates.json ]; then
            echo "updates-available=true" >> $GITHUB_OUTPUT
          else
            echo "updates-available=false" >> $GITHUB_OUTPUT
          fi

      - name: ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚¹ã‚­ãƒ£ãƒ³
        if: steps.check-updates.outputs.updates-available == 'true'
        run: |
          pcu security --format json --severity critical > security.json
          if [ -s security.json ] && [ "$(cat security.json | jq length)" -gt 0 ]; then
            echo "âŒ é‡å¤§ãªã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è„†å¼±æ€§ã‚’ç™ºè¦‹"
            exit 1
          fi

      - name: ä¾å­˜é–¢ä¿‚ã®æ›´æ–°
        if: steps.check-updates.outputs.updates-available == 'true'
        run: |
          pcu -u --target ${{ github.event.inputs.update_target || 'minor' }} --create-backup

      - name: ãƒ†ã‚¹ãƒˆã®å®Ÿè¡Œ
        if: steps.check-updates.outputs.updates-available == 'true'
        run: pnpm test

      - name: ãƒ—ãƒ«ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®ä½œæˆ
        if: steps.check-updates.outputs.updates-available == 'true'
        uses: peter-evans/create-pull-request@v5
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          commit-message: 'chore: ã‚«ã‚¿ãƒ­ã‚°ä¾å­˜é–¢ä¿‚ã®æ›´æ–°'
          title: "ğŸ”„ é€±æ¬¡ä¾å­˜é–¢ä¿‚æ›´æ–° (${{ github.event.inputs.update_target || 'minor' }})"
          body: |
            ## ğŸ“¦ ä¾å­˜é–¢ä¿‚æ›´æ–°

            ã“ã®PRã¯PCUã«ã‚ˆã£ã¦ç”Ÿæˆã•ã‚ŒãŸã‚«ã‚¿ãƒ­ã‚°ä¾å­˜é–¢ä¿‚ã®æ›´æ–°ã‚’å«ã¿ã¾ã™ã€‚

            ### å¤‰æ›´å†…å®¹
            - å¯¾è±¡ï¼š`${{ github.event.inputs.update_target || 'minor' }}`
            - ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚¹ã‚­ãƒ£ãƒ³ï¼šâœ… é€šé
            - ãƒ†ã‚¹ãƒˆï¼šâœ… é€šé

            ### ãƒ¬ãƒ“ãƒ¥ãƒ¼ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ
            - [ ] ç ´å£Šçš„å¤‰æ›´ã®ç¢ºèª
            - [ ] é‡è¦ãªãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ‘ã‚¹ã®ãƒ†ã‚¹ãƒˆ
            - [ ] å¿…è¦ã«å¿œã˜ã¦ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®æ›´æ–°

            ---
            *PCUãƒœãƒƒãƒˆã«ã‚ˆã£ã¦ç”Ÿæˆ ğŸ¤–*
          branch: pcu/weekly-updates
          labels: |
            dependencies
            automated
```

</CodeGroup>

## GitLab CIçµ±åˆ

PCUä¾å­˜é–¢ä¿‚ç®¡ç†ã®ãŸã‚ã®GitLab CIãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ï¼š

<CodeGroup>

```yaml {{ title: '.gitlab-ci.yml' }}
stages:
  - check
  - security
  - update

variables:
  PNPM_CACHE_FOLDER: .pnpm-store

cache:
  key: ${CI_COMMIT_REF_SLUG}
  paths:
    - .pnpm-store

before_script:
  - corepack enable
  - pnpm config set store-dir $PNPM_CACHE_FOLDER
  - pnpm install
  - pnpm add -g pnpm-catalog-updates

dependency-check:
  stage: check
  script:
    - pcu -c --format table
    - pcu workspace --validate
  artifacts:
    reports:
      junit: dependency-report.xml
  only:
    - merge_requests
    - main

security-scan:
  stage: security
  script:
    - pcu security --format json --severity moderate > security.json
    - |
      if [ -s security.json ] && [ "$(cat security.json | jq length)" -gt 0 ]; then
        echo "ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è„†å¼±æ€§ã‚’ç™ºè¦‹ï¼š"
        cat security.json | jq '.'
        exit 1
      fi
  artifacts:
    reports:
      security: security.json
  only:
    - merge_requests
    - main

weekly-update:
  stage: update
  script:
    - git config user.name "PCU Bot"
    - git config user.email "pcu@gitlab.com"
    - pcu -c --format json > updates.json
    - |
      if [ -s updates.json ]; then
        pcu -u --target minor --create-backup
        git add .
        git commit -m "chore: é€±æ¬¡ä¾å­˜é–¢ä¿‚æ›´æ–°"
        git push origin HEAD:pcu/weekly-updates
      fi
  only:
    - schedules
  variables:
    GIT_STRATEGY: clone
```

</CodeGroup>

## Jenkinsãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³çµ±åˆ

ã‚¨ãƒ³ã‚¿ãƒ¼ãƒ—ãƒ©ã‚¤ã‚ºç´šä¾å­˜é–¢ä¿‚ç®¡ç†ã®ãŸã‚ã®Jenkinsãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ï¼š

<CodeGroup>

```groovy {{ title: 'Jenkinsfile' }}
pipeline {
    agent any

    tools {
        nodejs '18'
    }

    environment {
        PNPM_HOME = "${env.WORKSPACE}/.pnpm"
        PATH = "${env.PNPM_HOME}:${env.PATH}"
    }

    stages {
        stage('ç’°å¢ƒè¨­å®š') {
            steps {
                sh 'corepack enable'
                sh 'pnpm install'
                sh 'pnpm add -g pnpm-catalog-updates'
            }
        }

        stage('ä¾å­˜é–¢ä¿‚ãƒã‚§ãƒƒã‚¯') {
            steps {
                sh 'pcu -c --format json > dependency-check.json'

                script {
                    def updates = readJSON file: 'dependency-check.json'
                    if (updates.size() > 0) {
                        env.HAS_UPDATES = 'true'
                        echo "${updates.size()} å€‹ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã§æ›´æ–°ãŒå¿…è¦"
                    } else {
                        env.HAS_UPDATES = 'false'
                        echo "åˆ©ç”¨å¯èƒ½ãªæ›´æ–°ã¯ã‚ã‚Šã¾ã›ã‚“"
                    }
                }
            }
            post {
                always {
                    archiveArtifacts artifacts: 'dependency-check.json'
                }
            }
        }

        stage('ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚¹ã‚­ãƒ£ãƒ³') {
            when {
                environment name: 'HAS_UPDATES', value: 'true'
            }
            steps {
                sh 'pcu security --format json --severity high > security-report.json'

                script {
                    def securityReport = readJSON file: 'security-report.json'
                    if (securityReport.vulnerabilities && securityReport.vulnerabilities.size() > 0) {
                        error "é‡å¤§ãªã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è„†å¼±æ€§ã‚’ç™ºè¦‹ï¼š${securityReport.vulnerabilities.size()}"
                    }
                }
            }
            post {
                always {
                    publishHTML([
                        allowMissing: false,
                        alwaysLinkToLastBuild: true,
                        keepAll: true,
                        reportDir: '.',
                        reportFiles: 'security-report.json',
                        reportName: 'Security Report'
                    ])
                }
            }
        }

        stage('ä¾å­˜é–¢ä¿‚ã®æ›´æ–°') {
            when {
                allOf {
                    environment name: 'HAS_UPDATES', value: 'true'
                    branch 'main'
                }
            }
            steps {
                sh 'pcu -u --target minor --create-backup'
                sh 'pnpm test'

                script {
                    sh '''
                        git config user.name "Jenkins PCU"
                        git config user.email "jenkins@company.com"
                        git add .
                        git commit -m "chore: è‡ªå‹•ä¾å­˜é–¢ä¿‚æ›´æ–° [skip ci]"
                    '''

                    // ãƒãƒ¼ã‚¸ãƒªã‚¯ã‚¨ã‚¹ãƒˆï¼ˆGitLabï¼‰ã¾ãŸã¯ãƒ—ãƒ«ãƒªã‚¯ã‚¨ã‚¹ãƒˆï¼ˆGitHubï¼‰ã®ä½œæˆ
                    sh '''
                        git push origin HEAD:pcu/automated-updates-${BUILD_NUMBER}
                    '''
                }
            }
        }
    }

    post {
        always {
            cleanWs()
        }

        success {
            echo 'PCUä¾å­˜é–¢ä¿‚ãƒã‚§ãƒƒã‚¯ãŒæ­£å¸¸ã«å®Œäº†ã—ã¾ã—ãŸ'
        }

        failure {
            emailext (
                subject: "PCUä¾å­˜é–¢ä¿‚ãƒã‚§ãƒƒã‚¯å¤±æ•— - ${env.JOB_NAME} - ${env.BUILD_NUMBER}",
                body: "ä¾å­˜é–¢ä¿‚ãƒã‚§ãƒƒã‚¯ãŒå¤±æ•—ã—ã¾ã—ãŸã€‚ã‚³ãƒ³ã‚½ãƒ¼ãƒ«å‡ºåŠ›ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚",
                to: "${env.CHANGE_AUTHOR_EMAIL}"
            )
        }
    }
}
```

</CodeGroup>

## Azure DevOpsãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³

PCUçµ±åˆã®ãŸã‚ã®Azure DevOpsãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ï¼š

<CodeGroup>

```yaml {{ title: 'azure-pipelines.yml' }}
trigger:
  branches:
    include:
      - main
      - develop

schedules:
  - cron: '0 8 * * 1'
    displayName: é€±æ¬¡ä¾å­˜é–¢ä¿‚ãƒã‚§ãƒƒã‚¯
    branches:
      include:
        - main
    always: true

pool:
  vmImage: 'ubuntu-latest'

variables:
  PNPM_CACHE_FOLDER: $(Pipeline.Workspace)/.pnpm-store

stages:
  - stage: DependencyCheck
    displayName: 'ä¾å­˜é–¢ä¿‚ãƒã‚§ãƒƒã‚¯'
    jobs:
      - job: CheckUpdates
        displayName: 'æ›´æ–°ã®ãƒã‚§ãƒƒã‚¯'
        steps:
          - task: Cache@2
            inputs:
              key: 'pnpm | "$(Agent.OS)" | pnpm-lock.yaml'
              restoreKeys: |
                pnpm | "$(Agent.OS)"
              path: $(PNPM_CACHE_FOLDER)
            displayName: pnpmã‚­ãƒ£ãƒƒã‚·ãƒ¥

          - script: |
              corepack enable
              pnpm config set store-dir $(PNPM_CACHE_FOLDER)
              pnpm install
              pnpm add -g pnpm-catalog-updates
            displayName: 'PNPMã¨PCUã®è¨­å®š'

          - script: |
              pcu -c --format json > $(Agent.TempDirectory)/updates.json
              pcu workspace --validate
            displayName: 'ä¾å­˜é–¢ä¿‚ã®ãƒã‚§ãƒƒã‚¯'

          - script: |
              pcu security --format json --severity moderate > $(Agent.TempDirectory)/security.json
            displayName: 'ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚¹ã‚­ãƒ£ãƒ³'

          - task: PublishTestResults@2
            condition: always()
            inputs:
              testResultsFormat: 'JUnit'
              testResultsFiles: '**/*-results.xml'
              failTaskOnFailedTests: true
            displayName: 'ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£çµæœã®å…¬é–‹'

          - task: PublishBuildArtifacts@1
            inputs:
              pathToPublish: '$(Agent.TempDirectory)'
              artifactName: 'dependency-reports'
            displayName: 'ã‚¢ãƒ¼ãƒ†ã‚£ãƒ•ã‚¡ã‚¯ãƒˆã®å…¬é–‹'

  - stage: UpdateDependencies
    displayName: 'ä¾å­˜é–¢ä¿‚ã®æ›´æ–°'
    condition: and(succeeded(), or(eq(variables['Build.Reason'], 'Schedule'), eq(variables['Build.Reason'], 'Manual')))
    jobs:
      - job: UpdateCatalog
        displayName: 'ã‚«ã‚¿ãƒ­ã‚°ä¾å­˜é–¢ä¿‚ã®æ›´æ–°'
        steps:
          - checkout: self
            persistCredentials: true

          - script: |
              corepack enable
              pnpm install
              pnpm add -g pnpm-catalog-updates
            displayName: 'ç’°å¢ƒè¨­å®š'

          - script: |
              pcu -u --target minor --create-backup
              pnpm test
            displayName: 'æ›´æ–°ã¨ãƒ†ã‚¹ãƒˆ'

          - script: |
              git config user.name "Azure DevOps PCU"
              git config user.email "azuredevops@company.com"
              git add .
              git commit -m "chore: Azure DevOpsè‡ªå‹•ä¾å­˜é–¢ä¿‚æ›´æ–°"
              git push origin HEAD:refs/heads/pcu/azure-updates-$(Build.BuildNumber)
            displayName: 'å¤‰æ›´ã®ã‚³ãƒŸãƒƒãƒˆ'
```

</CodeGroup>

## æ±ç”¨CI/CDãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹

### ç’°å¢ƒå¤‰æ•°ã®è¨­å®š

ã™ã¹ã¦ã®CI/CDãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã§PCUã®å‹•ä½œã‚’æœ€é©åŒ–ã™ã‚‹ãŸã‚ã«ã€ã“ã‚Œã‚‰ã®ç’°å¢ƒå¤‰æ•°ã‚’è¨­å®šã—ã¦ãã ã•ã„ï¼š

```bash
# ã‚³ã‚¢è¨­å®š
PCU_NO_COLOR=true              # ã‚«ãƒ©ãƒ¼å‡ºåŠ›ã‚’ç„¡åŠ¹åŒ–
PCU_CHECK_UPDATES=false        # CIã§PCUæ›´æ–°ãƒã‚§ãƒƒã‚¯ã‚’ç„¡åŠ¹åŒ–
PCU_VERBOSE=true               # è©³ç´°ãƒ­ã‚°ã‚’æœ‰åŠ¹åŒ–
PCU_OUTPUT_FORMAT=json         # è§£æã—ã‚„ã™ã„JSONå‡ºåŠ›ã‚’ä½¿ç”¨

# ã‚­ãƒ£ãƒƒã‚·ãƒ¥è¨­å®š
PCU_CACHE_ENABLED=true         # ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹å‘ä¸Šã®ãŸã‚ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’æœ‰åŠ¹åŒ–
PCU_CACHE_TTL=1800000         # 30åˆ†ã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥TTL

# ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¨­å®š
PCU_SECURITY_SEVERITY=high     # é«˜é‡è¦åº¦ã®è„†å¼±æ€§ã‚’ãƒã‚§ãƒƒã‚¯
PCU_AUTO_FIX=false            # CIã§ä¿®æ­£ã‚’æ‰‹å‹•åˆ¶å¾¡

# ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹è¨­å®š
PCU_TIMEOUT=120000            # 2åˆ†ã®ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ
PCU_RETRIES=3                 # ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®ãƒªãƒˆãƒ©ã‚¤å›æ•°
PCU_CONCURRENCY=5             # ä¸¦è¡Œãƒªã‚¯ã‚¨ã‚¹ãƒˆåˆ¶é™
```

### ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è€ƒæ…®äº‹é …

#### ã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³ç®¡ç†

CI/CDç’°å¢ƒã§ã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³ã‚’å®‰å…¨ã«ç®¡ç†ã—ã¦ãã ã•ã„ï¼š

```yaml
# GitHub Actions
- name: Gitã®è¨­å®š
  run: |
    git config user.name "PCU Bot"
    git config user.email "bot@company.com"
  env:
    GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

# GitLab CI
script:
  - git remote set-url origin https://oauth2:${CI_PUSH_TOKEN}@${CI_SERVER_HOST}/${CI_PROJECT_PATH}.git
```

#### ãƒ–ãƒ©ãƒ³ãƒä¿è­·æˆ¦ç•¥

ãƒ¡ã‚¤ãƒ³ãƒ–ãƒ©ãƒ³ãƒã¸ã®ç›´æ¥ãƒ—ãƒƒã‚·ãƒ¥ã‚’é˜²ããŸã‚ã®ãƒ–ãƒ©ãƒ³ãƒä¿è­·è¨­å®šï¼š

- ãƒ—ãƒ«ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ¬ãƒ“ãƒ¥ãƒ¼ã®å¿…é ˆåŒ–
- ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒã‚§ãƒƒã‚¯é€šéã®å¿…é ˆåŒ–
- ä¿è­·ã•ã‚ŒãŸãƒ–ãƒ©ãƒ³ãƒã¸ã®ãƒ—ãƒƒã‚·ãƒ¥åˆ¶é™
- ç½²åæ¸ˆã¿ã‚³ãƒŸãƒƒãƒˆã®å¿…é ˆåŒ–

### ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

#### ä¸€èˆ¬çš„ãªCI/CDã®å•é¡Œ

**æ¨©é™ã‚¨ãƒ©ãƒ¼**

```bash
# npmæ¨©é™å•é¡Œã®ä¿®æ­£
npm config set prefix ~/.npm-global
export PATH=~/.npm-global/bin:$PATH

# ã¾ãŸã¯pnpmã‚’ä½¿ç”¨ï¼ˆæ¨å¥¨ï¼‰
pnpm add -g pnpm-catalog-updates
```

**ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã®å•é¡Œ**

```bash
# CIã‚­ãƒ£ãƒƒã‚·ãƒ¥ã®ã‚¯ãƒªã‚¢
rm -rf node_modules pnpm-lock.yaml
pnpm install

# PCUã‚­ãƒ£ãƒƒã‚·ãƒ¥ã®ã‚¯ãƒªã‚¢
PCU_CACHE_ENABLED=false pcu check
```

**ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ**

```bash
# ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆæ™‚é–“ã®å¢—åŠ 
PCU_TIMEOUT=300000 pcu check

# ä¸¦è¡Œãƒªã‚¯ã‚¨ã‚¹ãƒˆã®å‰Šæ¸›
PCU_CONCURRENCY=2 pcu update
```

### ç›£è¦–ã¨ãƒ¬ãƒãƒ¼ãƒˆ

#### ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã®ä½œæˆ

CI/CDãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã®ãƒã‚¤ãƒ†ã‚£ãƒ–æ©Ÿèƒ½ã‚’ä½¿ç”¨ã—ã¦ä¾å­˜é–¢ä¿‚ç®¡ç†ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã‚’ä½œæˆï¼š

- **GitHub Actions**: Action insightsã¨ä¾å­˜é–¢ä¿‚ã‚°ãƒ©ãƒ•ã‚’ä½¿ç”¨
- **GitLab CI**: Security Dashboardã¨ä¾å­˜é–¢ä¿‚ã‚¹ã‚­ãƒ£ãƒ³ã‚’æ´»ç”¨
- **Jenkins**: HTML Publisherãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚’è¨­å®š
- **Azure DevOps**: Dashboardsã¨Analyticsã‚’ä½¿ç”¨

#### é€šçŸ¥è¨­å®š

ãƒãƒ¼ãƒ ã«æƒ…å ±ã‚’æä¾›ã™ã‚‹ãŸã‚ã®é©åˆ‡ãªé€šçŸ¥ã‚’è¨­å®šï¼š

```yaml
# Slacké€šçŸ¥ã®ä¾‹ï¼ˆGitHub Actionsï¼‰
- name: Slacké€šçŸ¥
  if: failure()
  uses: 8398a7/action-slack@v3
  with:
    status: failure
    text: PCUä¾å­˜é–¢ä¿‚ãƒã‚§ãƒƒã‚¯å¤±æ•—
  env:
    SLACK_WEBHOOK_URL: ${{ secrets.SLACK_WEBHOOK }}
```

## Dockerçµ±åˆ

### ã‚³ãƒ³ãƒ†ãƒŠåŒ–ã•ã‚ŒãŸPCUãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼

<CodeGroup>

```dockerfile {{ title: 'Dockerfile.pcu' }}
FROM node:18-alpine

# pnpmã¨PCUã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
RUN corepack enable
RUN pnpm add -g pnpm-catalog-updates

# ä½œæ¥­ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®è¨­å®š
WORKDIR /workspace

# packageãƒ•ã‚¡ã‚¤ãƒ«ã®ã‚³ãƒ”ãƒ¼
COPY package.json pnpm-lock.yaml ./
COPY pnpm-workspace.yaml .pcurc.json ./

# ä¾å­˜é–¢ä¿‚ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
RUN pnpm install --frozen-lockfile

# ç’°å¢ƒå¤‰æ•°ã®è¨­å®š
ENV PCU_NO_COLOR=true
ENV PCU_VERBOSE=true

# ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚³ãƒãƒ³ãƒ‰
CMD ["pcu", "--help"]
```

```yaml {{ title: 'docker-compose.yml' }}
version: '3.8'

services:
  pcu-check:
    build:
      context: .
      dockerfile: Dockerfile.pcu
    volumes:
      - .:/workspace
      - pnpm-cache:/workspace/.pnpm-store
    environment:
      - PCU_CACHE_ENABLED=true
      - PCU_OUTPUT_FORMAT=json
    command: pcu check --format table

  pcu-security:
    build:
      context: .
      dockerfile: Dockerfile.pcu
    volumes:
      - .:/workspace
    command: pcu security --severity high

volumes:
  pnpm-cache:
```

</CodeGroup>

ã“ã‚Œã‚‰ã®CI/CDçµ±åˆä¾‹ã¯ã€åŒ…æ‹¬çš„ãªè‡ªå‹•åŒ–ã•ã‚ŒãŸä¾å­˜é–¢ä¿‚ç®¡ç†ã‚½ãƒªãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³ã‚’æä¾›ã—ã€ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãŒå¸¸ã«æœ€æ–°ã§å®‰å…¨ãªä¾å­˜é–¢ä¿‚ã‚’ç¶­æŒã™ã‚‹ã“ã¨ã‚’ä¿è¨¼ã—ã¾ã™ã€‚
