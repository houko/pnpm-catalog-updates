export const metadata = {
  title: 'ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°',
  description:
    'pnpm-catalog-updates ä½¿ç”¨æ™‚ã®ä¸€èˆ¬çš„ãªå•é¡Œã¨è§£æ±ºç­–ã€‚ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã€ãƒ‡ãƒãƒƒã‚°ã®ã‚³ãƒ„ã€ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚¬ã‚¤ãƒ‰ã€‚',
};

# ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

PCU ã®å•é¡Œã‚’è§£æ±ºã™ã‚‹ãŸã‚ã®ä¸€èˆ¬çš„ãªå•é¡Œã¨è§£æ±ºç­–ã€‚ã‚ˆãã‚ã‚‹ã‚¨ãƒ©ãƒ¼ã®ç­”ãˆã¨ãƒ‡ãƒãƒƒã‚°ã®ã‚³ãƒ„ã‚’è¦‹ã¤ã‘ã¾ã™ã€‚{{ className: 'lead' }}

## ä¸€èˆ¬çš„ãªã‚¨ãƒ©ãƒ¼

### ãƒ¯ãƒ¼ã‚¯ã‚¹ãƒšãƒ¼ã‚¹ãŒè¦‹ã¤ã‹ã‚‰ãªã„

**ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ï¼š**

```
Error: No pnpm workspace found in the current directory
```

**åŸå› ï¼š** PCU ãŒ `pnpm-workspace.yaml` ãƒ•ã‚¡ã‚¤ãƒ«ã‚’è¦‹ã¤ã‘ã‚‰ã‚Œãªã„ã‹ã€æœ‰åŠ¹ãª pnpm ãƒ¯ãƒ¼ã‚¯ã‚¹ãƒšãƒ¼ã‚¹æ§‹é€ ã‚’æ¤œå‡ºã§ãã¾ã›ã‚“ã€‚

**è§£æ±ºç­–ï¼š**

<CodeGroup>

```bash {{ title: 'ãƒ¯ãƒ¼ã‚¯ã‚¹ãƒšãƒ¼ã‚¹ã®åˆæœŸåŒ–' }}
# æ–°ã—ã„ pnpm ãƒ¯ãƒ¼ã‚¯ã‚¹ãƒšãƒ¼ã‚¹ã‚’ä½œæˆ
pcu init

# ã¾ãŸã¯æ‰‹å‹•ã§ pnpm-workspace.yaml ã‚’ä½œæˆ
echo "packages:
  - 'packages/*'" > pnpm-workspace.yaml
```

```bash {{ title: 'ãƒ¯ãƒ¼ã‚¯ã‚¹ãƒšãƒ¼ã‚¹ãƒ‘ã‚¹ã®æŒ‡å®š' }}
# ãƒ¯ãƒ¼ã‚¯ã‚¹ãƒšãƒ¼ã‚¹ãƒ«ãƒ¼ãƒˆã‹ã‚‰ PCU ã‚’å®Ÿè¡Œ
cd /path/to/workspace/root
pcu -c

# ã¾ãŸã¯ãƒ¯ãƒ¼ã‚¯ã‚¹ãƒšãƒ¼ã‚¹ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’æŒ‡å®š
pcu -c --workspace /path/to/workspace
```

</CodeGroup>

---

### ã‚«ã‚¿ãƒ­ã‚°ä¾å­˜é–¢ä¿‚ãŒãªã„

**ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ï¼š**

```
No catalog dependencies found in workspace
```

**åŸå› ï¼š** ã‚ãªãŸã®ãƒ¯ãƒ¼ã‚¯ã‚¹ãƒšãƒ¼ã‚¹ã§ pnpm ã‚«ã‚¿ãƒ­ã‚°ä¾å­˜é–¢ä¿‚ãŒä½¿ç”¨ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚

**è§£æ±ºç­–ï¼š**

<CodeGroup>

```yaml {{ title: 'pnpm-workspace.yaml ã«ã‚«ã‚¿ãƒ­ã‚°ã‚’è¿½åŠ ' }}
packages:
  - 'packages/*'

catalog:
  react: ^18.2.0
  typescript: ^5.0.0
  lodash: ^4.17.21
```

```json {{ title: 'package.json ã§ã‚«ã‚¿ãƒ­ã‚°ã‚’ä½¿ç”¨' }}
{
  "name": "my-package",
  "dependencies": {
    "react": "catalog:",
    "typescript": "catalog:",
    "lodash": "catalog:"
  }
}
```

</CodeGroup>

---

### ãƒ¬ã‚¸ã‚¹ãƒˆãƒªã‚¢ã‚¯ã‚»ã‚¹å•é¡Œ

**ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ï¼š**

```
Error: getaddrinfo ENOTFOUND registry.npmjs.org
```

**åŸå› ï¼š** ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯æ¥ç¶šå•é¡Œã¾ãŸã¯ãƒ¬ã‚¸ã‚¹ãƒˆãƒªã‚¢ã‚¯ã‚»ã‚¹å•é¡Œã€‚

**è§£æ±ºç­–ï¼š**

<CodeGroup>

```bash {{ title: 'ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°' }}
# ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯æ¥ç¶šã‚’ç¢ºèª
ping registry.npmjs.org

# ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã‚’å¢—ã‚„ã—ã¦ãƒ†ã‚¹ãƒˆ
pcu -c --timeout 60000

# ä¸¦è¡Œãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’æ¸›ã‚‰ã™
pcu -c --concurrency 2
```

```ini {{ title: 'ãƒ¬ã‚¸ã‚¹ãƒˆãƒªè¨­å®š (.npmrc)' }}
# ç•°ãªã‚‹ãƒ¬ã‚¸ã‚¹ãƒˆãƒªã‚’ä½¿ç”¨
registry=https://registry.npmjs.org/

# ä¼æ¥­ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯
registry=https://your-corporate-registry.com/
strict-ssl=false
```

</CodeGroup>

---

### èªè¨¼ã‚¨ãƒ©ãƒ¼

**ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ï¼š**

```
Error: 401 Unauthorized - authentication required
```

**åŸå› ï¼š** ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆãƒ¬ã‚¸ã‚¹ãƒˆãƒªã®èªè¨¼ãƒˆãƒ¼ã‚¯ãƒ³ãŒæ¬ è½ã¾ãŸã¯ç„¡åŠ¹ã§ã™ã€‚

**è§£æ±ºç­–ï¼š**

<CodeGroup>

```ini {{ title: 'èªè¨¼ã®è¨­å®š (.npmrc)' }}
@myorg:registry=https://npm.private-registry.com/
//npm.private-registry.com/:_authToken=${NPM_TOKEN}

# ã¾ãŸã¯ãƒ¬ã‚¬ã‚·ãƒ¼èªè¨¼ã‚’ä½¿ç”¨
//npm.private-registry.com/:username=myuser
//npm.private-registry.com/:_password=base64password
//npm.private-registry.com/:email=my.email@example.com
```

```bash {{ title: 'ç’°å¢ƒå¤‰æ•°ã®è¨­å®š' }}
export NPM_TOKEN=your_token_here
pcu -c
```

</CodeGroup>

---

### è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚¨ãƒ©ãƒ¼

**ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ï¼š**

```
Error: Invalid configuration in .pcurc.json
```

**åŸå› ï¼š** JSON ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã‚¨ãƒ©ãƒ¼ã¾ãŸã¯ç„¡åŠ¹ãªè¨­å®šã‚ªãƒ—ã‚·ãƒ§ãƒ³ã€‚

**è§£æ±ºç­–ï¼š**

<CodeGroup>

```bash {{ title: 'è¨­å®šã®æ¤œè¨¼' }}
# JSON æ§‹æ–‡ã‚’ç¢ºèª
node -e "console.log(JSON.parse(require('fs').readFileSync('.pcurc.json', 'utf8')))"

# è¨­å®šã‚’å†ç”Ÿæˆ
mv .pcurc.json .pcurc.json.backup
pcu init --force
```

```json {{ title: 'æœ€å°æœ‰åŠ¹è¨­å®š' }}
{
  "defaults": {
    "target": "latest"
  },
  "output": {
    "format": "table"
  }
}
```

</CodeGroup>

## ãƒ‡ãƒãƒƒã‚°

### è©³ç´°ãƒ­ã‚°ã®æœ‰åŠ¹åŒ–

<CodeGroup>

```bash {{ title: 'è©³ç´°å‡ºåŠ›' }}
# è©³ç´°ãƒ­ã‚°ã‚’æœ‰åŠ¹ã«ã™ã‚‹
pcu -c --verbose

# ç’°å¢ƒå¤‰æ•°ã§ãƒ‡ãƒãƒƒã‚°ãƒ¢ãƒ¼ãƒ‰ã‚’ä½¿ç”¨
DEBUG=pcu:* pcu -c

# ç‰¹å®šã®ãƒ‡ãƒãƒƒã‚°ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«
DEBUG=pcu:core,pcu:registry pcu -c
```

```bash {{ title: 'ãƒ•ã‚¡ã‚¤ãƒ«ã¸ã®å‡ºåŠ›' }}
# ãƒ‡ãƒãƒƒã‚°å‡ºåŠ›ã‚’ä¿å­˜
pcu -c --verbose > debug.log 2>&1

# ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç¢ºèª
cat debug.log | grep -i error
```

</CodeGroup>

### ãƒ¯ãƒ¼ã‚¯ã‚¹ãƒšãƒ¼ã‚¹ã®æ¤œè¨¼

<CodeGroup>

```bash {{ title: 'ãƒ¯ãƒ¼ã‚¯ã‚¹ãƒšãƒ¼ã‚¹ã®æ¤œè¨¼' }}
# ãƒ¯ãƒ¼ã‚¯ã‚¹ãƒšãƒ¼ã‚¹è¨­å®šã‚’ç¢ºèª
pcu -s --validate

# è©³ç´°ãªãƒ¯ãƒ¼ã‚¯ã‚¹ãƒšãƒ¼ã‚¹æƒ…å ±ã‚’å–å¾—
pcu -s --stats --verbose
```

```bash {{ title: 'æ‰‹å‹•æ¤œè¨¼' }}
# pnpm-workspace.yaml ã®å­˜åœ¨ã‚’ç¢ºèª
ls -la pnpm-workspace.yaml

# ã‚«ã‚¿ãƒ­ã‚°æ§‹æ–‡ã‚’æ¤œè¨¼
pnpm exec -- pnpm list --depth=0
```

</CodeGroup>

## ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹å•é¡Œ

### ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒé…ã„

**ç—‡çŠ¶ï¼š** PCU ã®æ›´æ–°ãƒã‚§ãƒƒã‚¯ã«æ™‚é–“ãŒã‹ã‹ã‚Šã™ãã‚‹

**è§£æ±ºç­–ï¼š**

<CodeGroup>

```json {{ title: 'æœ€é©åŒ–è¨­å®š' }}
{
  "advanced": {
    "concurrency": 3,
    "timeout": 30000,
    "retries": 2,
    "cacheValidityMinutes": 120
  }
}
```

```bash {{ title: 'ã‚­ãƒ£ãƒƒã‚·ãƒ¥ç®¡ç†' }}
# ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãŒå¤ã„å ´åˆã¯ã‚¯ãƒªã‚¢
rm -rf ~/.pcu/cache

# ãƒ‡ãƒãƒƒã‚°ç”¨ã«ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’ç„¡åŠ¹åŒ–
pcu -c --no-cache
```

</CodeGroup>

### ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡ãŒå¤šã„

**ç—‡çŠ¶ï¼š** PCU ãŒå¤§è¦æ¨¡ãƒ¯ãƒ¼ã‚¯ã‚¹ãƒšãƒ¼ã‚¹ã§éåº¦ã«ãƒ¡ãƒ¢ãƒªã‚’æ¶ˆè²»ã™ã‚‹

**è§£æ±ºç­–ï¼š**

<CodeGroup>

```json {{ title: 'ãƒ¡ãƒ¢ãƒªæœ€é©åŒ–' }}
{
  "advanced": {
    "concurrency": 2,
    "batchSize": 10
  }
}
```

```bash {{ title: 'ãƒ—ãƒ­ã‚»ã‚¹ç®¡ç†' }}
# ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡ã‚’ç›£è¦–
top -p $(pgrep node)

# Node.js ãƒ¡ãƒ¢ãƒªãƒ•ãƒ©ã‚°ã‚’ä½¿ç”¨
node --max-old-space-size=4096 $(which pcu) -c
```

</CodeGroup>

## ç’°å¢ƒå•é¡Œ

### Node.js ãƒãƒ¼ã‚¸ãƒ§ãƒ³äº’æ›æ€§

**ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ï¼š**

```
Error: Unsupported Node.js version
```

**è§£æ±ºç­–ï¼š**

<CodeGroup>

```bash {{ title: 'ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç¢ºèª' }}
node --version  # >= 18.0.0 ã§ã‚ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™

# äº’æ›ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
nvm install 20
nvm use 20
```

```bash {{ title: 'Node.js ã®æ›´æ–°' }}
# nvm ã‚’ä½¿ç”¨
nvm install --lts
nvm use --lts

# ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã‚’ç¢ºèª
node --version
npm --version
```

</CodeGroup>

### pnpm ãƒãƒ¼ã‚¸ãƒ§ãƒ³å•é¡Œ

**ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ï¼š**

```
Error: pnpm command not found
```

**è§£æ±ºç­–ï¼š**

<CodeGroup>

```bash {{ title: 'pnpm ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«' }}
# æœ€æ–°ã® pnpm ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
npm install -g pnpm@latest

# ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã‚’ç¢ºèª
pnpm --version  # >= 8.0.0 ã§ã‚ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™
```

```bash {{ title: 'ä»£æ›¿ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«' }}
# Corepack ã‚’ä½¿ç”¨ï¼ˆæ¨å¥¨ï¼‰
corepack enable
corepack prepare pnpm@latest --activate

# ç›´æ¥ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
curl -fsSL https://get.pnpm.io/install.sh | sh -
```

</CodeGroup>

## Windows å›ºæœ‰ã®å•é¡Œ

### ãƒ‘ã‚¹åŒºåˆ‡ã‚Šæ–‡å­—ã®å•é¡Œ

**ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ï¼š**

```
Error: Cannot resolve workspace path
```

**è§£æ±ºç­–ï¼š**

<CodeGroup>

```bash {{ title: 'ãƒ•ã‚©ãƒ¯ãƒ¼ãƒ‰ã‚¹ãƒ©ãƒƒã‚·ãƒ¥ã®ä½¿ç”¨' }}
# ãƒ‘ã‚¹ã§ãƒ•ã‚©ãƒ¯ãƒ¼ãƒ‰ã‚¹ãƒ©ãƒƒã‚·ãƒ¥ã‚’ä½¿ç”¨
pcu -c --workspace ./my/workspace

# ã¾ãŸã¯ PowerShell ã‚’ä½¿ç”¨
pwsh -c "pcu -c"
```

```json {{ title: 'Windows è¨­å®š' }}
{
  "workspace": {
    "pathSeparator": "/"
  }
}
```

</CodeGroup>

### æ¨©é™ã‚¨ãƒ©ãƒ¼

**ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ï¼š**

```
Error: EPERM: operation not permitted
```

**è§£æ±ºç­–ï¼š**

<CodeGroup>

```cmd {{ title: 'ç®¡ç†è€…ã¨ã—ã¦å®Ÿè¡Œ' }}
# ç®¡ç†è€…ã¨ã—ã¦ã‚³ãƒãƒ³ãƒ‰ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’å®Ÿè¡Œ
runas /user:Administrator cmd

# ã¾ãŸã¯ç®¡ç†è€…ã¨ã—ã¦ PowerShell ã‚’ä½¿ç”¨
Start-Process powershell -Verb RunAs
```

```bash {{ title: 'æ¨©é™ã®ä¿®æ­£' }}
# npm æ¨©é™ã‚’ä¿®æ­£
npm config set cache ~/.npm-cache
npm config set prefix ~/npm-global
```

</CodeGroup>

## ãƒ˜ãƒ«ãƒ—ã®å–å¾—

### è¨ºæ–­æƒ…å ±

å•é¡Œã‚’å ±å‘Šã™ã‚‹éš›ã¯ã€ã“ã®è¨ºæ–­æƒ…å ±ã‚’å«ã‚ã¦ãã ã•ã„ï¼š

<CodeGroup>

```bash {{ title: 'ã‚·ã‚¹ãƒ†ãƒ æƒ…å ±' }}
# PCU ãƒãƒ¼ã‚¸ãƒ§ãƒ³
pcu --version

# Node.js ã¨ pnpm ãƒãƒ¼ã‚¸ãƒ§ãƒ³
node --version
pnpm --version

# ã‚ªãƒšãƒ¬ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚·ã‚¹ãƒ†ãƒ 
uname -a  # Linux/macOS
systeminfo  # Windows
```

```bash {{ title: 'è¨­å®šæƒ…å ±' }}
# ç¾åœ¨ã®è¨­å®šã‚’è¡¨ç¤º
cat .pcurc.json

# ãƒ¯ãƒ¼ã‚¯ã‚¹ãƒšãƒ¼ã‚¹æ¤œè¨¼
pcu -s --validate --verbose

# ãƒ‡ãƒãƒƒã‚°å‡ºåŠ›
DEBUG=pcu:* pcu -c --verbose
```

</CodeGroup>

### ã‚µãƒãƒ¼ãƒˆãƒãƒ£ãƒ³ãƒãƒ«

- ğŸ› **ãƒã‚°å ±å‘Š**ï¼š[GitHub Issues](https://github.com/houko/pnpm-catalog-updates/issues)
- ğŸ’¬ **è³ªå•**ï¼š[GitHub Discussions](https://github.com/houko/pnpm-catalog-updates/discussions)
- ğŸ“– **ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ**ï¼šè©³ç´°ãªã‚¬ã‚¤ãƒ‰ã«ã¤ã„ã¦ã¯ã“ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’å‚ç…§
- ğŸ”§ **æ©Ÿèƒ½ãƒªã‚¯ã‚¨ã‚¹ãƒˆ**ï¼šæ‹¡å¼µãƒ©ãƒ™ãƒ«ä»˜ãã® GitHub Issues ã‚’ä½¿ç”¨

### å•é¡Œãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ

ãƒã‚°ã‚’å ±å‘Šã™ã‚‹éš›ã¯ã€ä»¥ä¸‹ã‚’å«ã‚ã¦ãã ã•ã„ï¼š

1. **PCU ãƒãƒ¼ã‚¸ãƒ§ãƒ³**ã¨**ä½¿ç”¨ã—ãŸã‚³ãƒãƒ³ãƒ‰**
2. **ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸**ï¼ˆ`--verbose` ã§ã®å®Œå…¨å‡ºåŠ›ï¼‰
3. **ç’°å¢ƒ**ï¼ˆOSã€Node.jsã€pnpm ãƒãƒ¼ã‚¸ãƒ§ãƒ³ï¼‰
4. **ãƒ¯ãƒ¼ã‚¯ã‚¹ãƒšãƒ¼ã‚¹æ§‹é€ **ï¼ˆpnpm-workspace.yamlã€package.jsonï¼‰
5. **è¨­å®š**ï¼ˆé–¢é€£ã™ã‚‹å ´åˆã¯ .pcurc.jsonã€.npmrcï¼‰
6. **å•é¡Œã‚’å†ç¾ã™ã‚‹æ‰‹é †**
7. **æœŸå¾…ã•ã‚Œã‚‹å‹•ä½œã¨å®Ÿéš›ã®å‹•ä½œ**

---

## é«˜åº¦ãªãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### è¤‡é›‘ãªä¾å­˜é–¢ä¿‚ã®ç«¶åˆ

**ã‚¨ãƒ©ãƒ¼ã‚·ãƒŠãƒªã‚ªï¼š**

```
Error: Cannot resolve peer dependencies
â””â”€ react@18.2.0
â”œâ”€ react-dom@17.0.2 (peer dependency conflict)
â””â”€ @types/react@17.0.62 (version mismatch)
```

**ç—‡çŠ¶ï¼š** æ›´æ–°å¾Œã«ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç«¶åˆãŒç™ºç”Ÿã—ã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãŒèµ·å‹•ã—ãªã„

**å®Œå…¨ãªè¨ºæ–­ãƒ—ãƒ­ã‚»ã‚¹ï¼š**

<CodeGroup>

```bash {{ title: 'ã‚¹ãƒ†ãƒƒãƒ—1ï¼šç«¶åˆã®åˆ†æ' }}
# ç¾åœ¨ã®ä¾å­˜é–¢ä¿‚ãƒ„ãƒªãƒ¼ã‚’ç¢ºèª
pnpm ls --depth=2 | grep -E "(react|@types)"

# ç‰¹å®šãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®å½±éŸ¿ã‚’åˆ†æ
pcu analyze default react 18.3.0

# å•é¡Œã®ã‚ã‚‹ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã«ä¾å­˜ã™ã‚‹ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ç¢ºèª
pnpm why react-dom@17.0.2
```

```bash {{ title: 'ã‚¹ãƒ†ãƒƒãƒ—2ï¼šæ ¹æœ¬åŸå› ã®èª¿æŸ»' }}
# ã™ã¹ã¦ã® package.json ã§ React é–¢é€£ã®ä¾å­˜é–¢ä¿‚ã‚’ç¢ºèª
find . -name "package.json" -exec grep -l "react" {} \;

# è©³ç´°ãªç«¶åˆæƒ…å ±ã‚’è¡¨ç¤º
pnpm install --dry-run --verbose
```

```bash {{ title: 'ã‚¹ãƒ†ãƒƒãƒ—3ï¼šç«¶åˆã®ä¿®æ­£' }}
# ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‚’ä½œæˆ
cp pnpm-workspace.yaml pnpm-workspace.yaml.backup

# React ã‚¨ã‚³ã‚·ã‚¹ãƒ†ãƒ ã‚’çµ±ä¸€ã—ã¦æ›´æ–°
pcu update --include "react*,@types/react*" --target minor --interactive

# ä¿®æ­£ã‚’ç¢ºèª
pnpm install
pnpm list --depth=1 | grep react
```

</CodeGroup>

### CI/CD ç’°å¢ƒã®éšœå®³

**ã‚¨ãƒ©ãƒ¼ã‚·ãƒŠãƒªã‚ªï¼š**

```
Error: EACCES permission denied, open '/home/runner/.pcu/cache'
Exit code: 126 in GitHub Actions
```

**ç—‡çŠ¶ï¼š** CI/CD ã§ PCU ãŒå¤±æ•—ã™ã‚‹ãŒã€ãƒ­ãƒ¼ã‚«ãƒ«ã§ã¯æ­£å¸¸ã«å‹•ä½œã™ã‚‹

**è§£æ±ºç­–ï¼š**

<CodeGroup>

```yaml {{ title: 'GitHub Actions ä¿®æ­£' }}
- name: PCU æ¨©é™ã®è¨­å®š
  run: |
    # ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®æ¨©é™ãŒæ­£ã—ã„ã“ã¨ã‚’ç¢ºèª
    mkdir -p ~/.pcu/cache
    chmod 755 ~/.pcu/cache

    # CI ç’°å¢ƒå¤‰æ•°ã‚’è¨­å®š
    export PCU_NO_COLOR=true
    export PCU_CACHE_ENABLED=false  # æ¨©é™å•é¡Œã‚’å›é¿ã™ã‚‹ãŸã‚ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’ç„¡åŠ¹åŒ–

    # PCU ã‚’å®Ÿè¡Œ
    pcu check --verbose
```

```bash {{ title: 'CI ç’°å¢ƒã®è¨ºæ–­' }}
# ç’°å¢ƒæƒ…å ±ã‚’ç¢ºèª
echo "Node: $(node --version)"
echo "PNPM: $(pnpm --version)"
echo "PCU: $(pcu --version)"
echo "Workspace: $(pwd)"
echo "User: $(whoami)"
echo "Permissions: $(ls -la ~/.pcu/ 2>/dev/null || echo 'Cache dir not found')"

# åŸºæœ¬æ©Ÿèƒ½ã‚’ãƒ†ã‚¹ãƒˆ
pcu workspace --validate --verbose
```

</CodeGroup>

### å¤§è¦æ¨¡ monorepo ã®ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹å•é¡Œ

**ã‚¨ãƒ©ãƒ¼ã‚·ãƒŠãƒªã‚ªï¼š**

```
Error: JavaScript heap out of memory
FATAL ERROR: Reached heap limit Allocation failed
```

**ç—‡çŠ¶ï¼š** 100+ ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’å«ã‚€ monorepo ã§ PCU ãŒã‚¯ãƒ©ãƒƒã‚·ãƒ¥ã™ã‚‹

**æœ€é©åŒ–æ¡ˆï¼š**

<CodeGroup>

```json {{ title: 'ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹è¨­å®šæœ€é©åŒ–' }}
{
  "advanced": {
    "concurrency": 2,
    "batchSize": 5,
    "timeout": 120000,
    "retries": 1,
    "maxMemory": "4GB"
  },
  "cache": {
    "enabled": true,
    "ttl": 3600000,
    "maxSize": 104857600,
    "maxEntries": 1000
  }
}
```

```bash {{ title: 'ãƒ¡ãƒ¢ãƒªç®¡ç†æˆ¦ç•¥' }}
# Node.js ãƒ¡ãƒ¢ãƒªåˆ¶é™ã‚’å¢—åŠ 
export NODE_OPTIONS="--max-old-space-size=8192"

# å¤§è¦æ¨¡ãƒ¯ãƒ¼ã‚¯ã‚¹ãƒšãƒ¼ã‚¹ã‚’ãƒãƒƒãƒå‡¦ç†
pcu check --catalog default --include "@company/*"
pcu check --catalog default --include "@other/*"

# ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡ã‚’ç›£è¦–
while true; do
  ps aux | grep pcu | grep -v grep
  sleep 2
done &

pcu check --verbose
```

</CodeGroup>

### ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆãƒ¬ã‚¸ã‚¹ãƒˆãƒªèªè¨¼å•é¡Œ

**ã‚¨ãƒ©ãƒ¼ã‚·ãƒŠãƒªã‚ªï¼š**

```
Error: 403 Forbidden - access denied to package @company/private-lib
HTTP 403: You must be logged in to access this package
```

**ç—‡çŠ¶ï¼š** ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã«ã‚¢ã‚¯ã‚»ã‚¹ã§ããªã„ãŒã€ãƒ‘ãƒ–ãƒªãƒƒã‚¯ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã¯æ­£å¸¸ã«å‹•ä½œã™ã‚‹

**å®Œå…¨è§£æ±ºãƒ•ãƒ­ãƒ¼ï¼š**

<CodeGroup>

```bash {{ title: 'èªè¨¼çŠ¶æ…‹ã®è¨ºæ–­' }}
# ç¾åœ¨ã®èªè¨¼çŠ¶æ…‹ã‚’ç¢ºèª
npm whoami --registry https://npm.company.com

# ãƒ¬ã‚¸ã‚¹ãƒˆãƒªæ¥ç¶šã‚’ãƒ†ã‚¹ãƒˆ
curl -I https://npm.company.com/-/whoami \
  -H "Authorization: Bearer $NPM_TOKEN"

# .npmrc è¨­å®šã‚’ç¢ºèª
cat .npmrc | grep -E "(registry|authToken)"
```

```ini {{ title: 'èªè¨¼è¨­å®šã®ä¿®æ­£' }}
# .npmrc ã®æ­£ã—ã„è¨­å®šå½¢å¼
@company:registry=https://npm.company.com/
//npm.company.com/:_authToken=${NPM_TOKEN}

# ãƒ‘ãƒ–ãƒªãƒƒã‚¯ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã¯å¼•ãç¶šããƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒ¬ã‚¸ã‚¹ãƒˆãƒªã‚’ä½¿ç”¨
registry=https://registry.npmjs.org/

# ç’°å¢ƒå¤‰æ•°ãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèª
# export NPM_TOKEN=your_actual_token_here
```

```bash {{ title: 'æ¤œè¨¼ã¨ãƒ†ã‚¹ãƒˆ' }}
# ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆãƒ¬ã‚¸ã‚¹ãƒˆãƒªã«å†ãƒ­ã‚°ã‚¤ãƒ³
npm login --registry https://npm.company.com --auth-type web

# ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚¢ã‚¯ã‚»ã‚¹ã‚’ãƒ†ã‚¹ãƒˆ
npm view @company/private-lib --registry https://npm.company.com

# PCU ãŒã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹ã“ã¨ã‚’ç¢ºèª
pcu check --include "@company/*" --verbose
```

</CodeGroup>

### ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚¹ã‚­ãƒ£ãƒ³ã®èª¤æ¤œå‡ºå‡¦ç†

**ã‚¨ãƒ©ãƒ¼ã‚·ãƒŠãƒªã‚ªï¼š**

```
ğŸš¨ lodash@4.17.20 ã§é‡å¤§ãªã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è„†å¼±æ€§ãŒç™ºè¦‹ã•ã‚Œã¾ã—ãŸ
CVE-2021-23337: Command Injection
å®Ÿéš›ï¼šãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¯å½±éŸ¿ã‚’å—ã‘ã‚‹ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆæ©Ÿèƒ½ã‚’ä½¿ç”¨ã—ã¦ã„ã¾ã›ã‚“
```

**ç—‡çŠ¶ï¼š** ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚¹ã‚­ãƒ£ãƒ³ã§è„†å¼±æ€§ãŒå ±å‘Šã•ã‚Œã‚‹ãŒã€å®Ÿéš›ã«ã¯ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã«å½±éŸ¿ã—ãªã„

**å‡¦ç†æˆ¦ç•¥ï¼š**

<CodeGroup>

```json {{ title: 'ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ç›£æŸ»ä¾‹å¤–ã®è¨­å®š' }}
{
  "security": {
    "ignoredVulnerabilities": ["CVE-2021-23337"],
    "ignoredPackages": ["lodash@4.17.20"],
    "customAuditConfig": {
      "low": "ignore",
      "moderate": "warn",
      "high": "error",
      "critical": "error"
    }
  }
}
```

```bash {{ title: 'è©³ç´°è„†å¼±æ€§åˆ†æ' }}
# è©³ç´°ãªè„†å¼±æ€§æƒ…å ±ã‚’å–å¾—
pcu security --severity all --format json > security-full.json

# ç‰¹å®šã®è„†å¼±æ€§å½±éŸ¿ã‚’åˆ†æ
npm audit --audit-level=none --json | jq '.vulnerabilities'

# ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®å®Ÿéš›ã®ä½¿ç”¨çŠ¶æ³ã‚’ç¢ºèª
pnpm why lodash
find . -name "*.js" -o -name "*.ts" | xargs grep -l "lodash" | head -10
```

</CodeGroup>

### ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ç’°å¢ƒã®ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

**ã‚¨ãƒ©ãƒ¼ã‚·ãƒŠãƒªã‚ªï¼š**

```
Error: connect ETIMEDOUT 104.16.21.35:443
Error: socket hang up
Error: Request timeout after 30000ms
```

**ç—‡çŠ¶ï¼š** ä¼æ¥­ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ç’°å¢ƒã§é »ç¹ãªã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã€ãƒ—ãƒ­ã‚­ã‚·å•é¡Œ

**è§£æ±ºç­–ï¼š**

<CodeGroup>

```bash {{ title: 'ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯è¨ºæ–­' }}
# ãƒ¬ã‚¸ã‚¹ãƒˆãƒªæ¥ç¶šã‚’ãƒ†ã‚¹ãƒˆ
curl -I https://registry.npmjs.org --connect-timeout 10

# ãƒ—ãƒ­ã‚­ã‚·è¨­å®šã‚’ç¢ºèª
echo "HTTP_PROXY: $HTTP_PROXY"
echo "HTTPS_PROXY: $HTTPS_PROXY"
echo "NO_PROXY: $NO_PROXY"

# DNS è§£æ±ºã‚’ãƒ†ã‚¹ãƒˆ
nslookup registry.npmjs.org
dig registry.npmjs.org A +short
```

```ini {{ title: 'ãƒ—ãƒ­ã‚­ã‚·è¨­å®š' }}
# .npmrc ãƒ—ãƒ­ã‚­ã‚·è¨­å®š
proxy=http://proxy.company.com:8080
https-proxy=http://proxy.company.com:8080
strict-ssl=false

# ä¼æ¥­ CA è¨¼æ˜æ›¸
cafile=/etc/ssl/certs/company-ca.pem
```

```json {{ title: 'PCU ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯æœ€é©åŒ–' }}
{
  "advanced": {
    "timeout": 120000,
    "retries": 5,
    "concurrency": 1,
    "userAgent": "pcu/company-internal"
  },
  "proxy": {
    "enabled": true,
    "url": "http://proxy.company.com:8080",
    "auth": {
      "username": "${PROXY_USER}",
      "password": "${PROXY_PASS}"
    }
  }
}
```

</CodeGroup>

### ãƒãƒ¼ã‚¸ãƒ§ãƒ³åˆ¶ç´„ã®ç«¶åˆ

**ã‚¨ãƒ©ãƒ¼ã‚·ãƒŠãƒªã‚ªï¼š**

```
Cannot resolve version constraints:
- Package A requires react@^17.0.0
- Package B requires react@^18.0.0
- Catalog specifies react@^18.2.0
```

**ç—‡çŠ¶ï¼š** ãƒ¯ãƒ¼ã‚¯ã‚¹ãƒšãƒ¼ã‚¹å†…ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³è¦ä»¶ãŒç«¶åˆã™ã‚‹

**è§£æ±ºæˆ¦ç•¥ï¼š**

<CodeGroup>

```bash {{ title: 'ç«¶åˆåˆ†æ' }}
# ã™ã¹ã¦ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³åˆ¶ç´„ã‚’è¦‹ã¤ã‘ã‚‹
find . -name "package.json" -exec jq -r '.dependencies.react // empty' {} \; | sort | uniq -c

# å„ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®è¦ä»¶ã‚’åˆ†æ
for pkg in packages/*/package.json; do
  echo "=== $pkg ==="
  jq '.dependencies.react // empty' "$pkg"
done
```

```yaml {{ title: 'ãƒãƒ«ãƒã‚«ã‚¿ãƒ­ã‚°æˆ¦ç•¥' }}
# pnpm-workspace.yaml
packages:
  - 'packages/*'

catalog:
  # ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆæœ€æ–°ãƒãƒ¼ã‚¸ãƒ§ãƒ³
  react: ^18.2.0
  react-dom: ^18.2.0

catalogs:
  # æ—§ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã¨ã®äº’æ›æ€§ã®ãŸã‚ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸
  react17:
    react: ^17.0.2
    react-dom: ^17.0.2
```

```bash {{ title: 'æ®µéšçš„ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰' }}
# 1. æ—§ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’ç¶­æŒã™ã‚‹å¿…è¦ãŒã‚ã‚‹ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ç‰¹å®š
pcu analyze default react 18.2.0

# 2. ã“ã‚Œã‚‰ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’äº’æ›ã‚«ã‚¿ãƒ­ã‚°ã«ç§»å‹•
# package.json ã§ï¼š
# "react": "catalog:react17"

# 3. æ®µéšçš„ã«ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰
pcu update --catalog react17 --target minor
```

</CodeGroup>

## å¾©æ—§æ‰‹é †

### æ›´æ–°å¤±æ•—ã®ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯

æ›´æ–°ãŒå•é¡Œã‚’å¼•ãèµ·ã“ã—ãŸå ´åˆã®å®Œå…¨å¾©æ—§ãƒ•ãƒ­ãƒ¼ï¼š

<CodeGroup>

```bash {{ title: 'è‡ªå‹•ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯' }}
# ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ãŒæœ‰åŠ¹ãªå ´åˆï¼ˆæ¨å¥¨ï¼‰
if [ -f "pnpm-workspace.yaml.backup" ]; then
  echo "ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ãŒè¦‹ã¤ã‹ã‚Šã¾ã—ãŸã€ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯ã‚’é–‹å§‹ã—ã¾ã™..."

  # ãƒ¯ãƒ¼ã‚¯ã‚¹ãƒšãƒ¼ã‚¹è¨­å®šã‚’å¾©å…ƒ
  cp pnpm-workspace.yaml.backup pnpm-workspace.yaml

  # ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—ã—ã¦å†ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
  rm -rf node_modules packages/*/node_modules
  pnpm install

  # ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯ã‚’ç¢ºèª
  pcu workspace --validate
  echo "âœ… ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯å®Œäº†"
else
  echo "âŒ ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ãƒ•ã‚¡ã‚¤ãƒ«ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“"
fi
```

```bash {{ title: 'æ‰‹å‹•å¾©æ—§' }}
# Git ã‚’ä½¿ç”¨ã—ã¦å¾©æ—§ï¼ˆãƒãƒ¼ã‚¸ãƒ§ãƒ³ç®¡ç†ã•ã‚Œã¦ã„ã‚‹å ´åˆï¼‰
git status
git restore pnpm-workspace.yaml
git restore packages/*/package.json

# ãƒ­ãƒƒã‚¯ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—
rm pnpm-lock.yaml
pnpm install

# å¾©æ—§ã‚’ç¢ºèª
pnpm run test
```

</CodeGroup>

### ç ´æã‚­ãƒ£ãƒƒã‚·ãƒ¥ã®ä¿®å¾©

PCU ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãŒç ´æã—ã¦å•é¡ŒãŒç™ºç”Ÿã™ã‚‹å ´åˆï¼š

<CodeGroup>

```bash {{ title: 'å®Œå…¨ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒªã‚»ãƒƒãƒˆ' }}
# ã™ã¹ã¦ã® PCU ãƒ—ãƒ­ã‚»ã‚¹ã‚’åœæ­¢
pkill -f pcu

# ã™ã¹ã¦ã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’ã‚¯ãƒªã‚¢
rm -rf ~/.pcu/cache
rm -rf ~/.npm/_cacache
rm -rf ~/.pnpm-store

# å†åˆæœŸåŒ–
pcu workspace --validate
pcu check --verbose
```

```bash {{ title: 'é¸æŠçš„ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—' }}
# ç‰¹å®šã‚¿ã‚¤ãƒ—ã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã®ã¿ã‚’ã‚¯ãƒªã‚¢
rm -rf ~/.pcu/cache/registry  # NPM ãƒ¬ã‚¸ã‚¹ãƒˆãƒªã‚­ãƒ£ãƒƒã‚·ãƒ¥
rm -rf ~/.pcu/cache/workspace  # ãƒ¯ãƒ¼ã‚¯ã‚¹ãƒšãƒ¼ã‚¹ã‚­ãƒ£ãƒƒã‚·ãƒ¥
rm -rf ~/.pcu/cache/security   # ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚¹ã‚­ãƒ£ãƒ³ã‚­ãƒ£ãƒƒã‚·ãƒ¥

# å¼·åˆ¶å†ãƒã‚§ãƒƒã‚¯
PCU_CACHE_ENABLED=false pcu check
```

</CodeGroup>

### ãƒ¯ãƒ¼ã‚¯ã‚¹ãƒšãƒ¼ã‚¹ç ´æã®ä¿®å¾©

ãƒ¯ãƒ¼ã‚¯ã‚¹ãƒšãƒ¼ã‚¹è¨­å®šãŒç ´æã—ãŸå ´åˆï¼š

<CodeGroup>

```bash {{ title: 'è¨­å®šæ¤œè¨¼ã¨ä¿®å¾©' }}
# ç¾åœ¨ã®è¨­å®šã‚’ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—
cp pnpm-workspace.yaml pnpm-workspace.yaml.broken
cp .pcurc.json .pcurc.json.broken 2>/dev/null || true

# è¨­å®šã‚’å†ç”Ÿæˆ
pcu init --force

# å¿…è¦ãªã‚«ã‚¹ã‚¿ãƒ è¨­å®šã‚’æ‰‹å‹•ãƒãƒ¼ã‚¸
echo "ä»¥ä¸‹ã®ã‚«ã‚¹ã‚¿ãƒ è¨­å®šã‚’ç¢ºèªã—ã¦ãƒãƒ¼ã‚¸ã—ã¦ãã ã•ã„ï¼š"
echo "=== å¤ã„ãƒ¯ãƒ¼ã‚¯ã‚¹ãƒšãƒ¼ã‚¹è¨­å®š ==="
cat pnpm-workspace.yaml.broken
echo "=== æ–°ã—ã„ãƒ¯ãƒ¼ã‚¯ã‚¹ãƒšãƒ¼ã‚¹è¨­å®š ==="
cat pnpm-workspace.yaml
```

```bash {{ title: 'ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸æ§‹é€ ä¿®å¾©' }}
# ã™ã¹ã¦ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®æ§‹é€ ã‚’æ¤œè¨¼
for pkg in packages/*/; do
  if [ ! -f "$pkg/package.json" ]; then
    echo "âŒ package.json ãŒä¸è¶³: $pkg"
  else
    echo "âœ… ãƒã‚§ãƒƒã‚¯é€šé: $pkg"
    # JSON å½¢å¼ã‚’æ¤œè¨¼
    node -e "JSON.parse(require('fs').readFileSync('$pkg/package.json'))"
  fi
done

# ãƒ¯ãƒ¼ã‚¯ã‚¹ãƒšãƒ¼ã‚¹ã‚’å†ãƒªãƒ³ã‚¯
pnpm install
```

</CodeGroup>

## ãƒ­ã‚°åˆ†æã¨ç›£è¦–

### ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ å•é¡Œè¨ºæ–­

<CodeGroup>

```bash {{ title: 'ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒ­ã‚°ç›£è¦–' }}
# è©³ç´°ãƒ­ã‚°ãƒ¢ãƒ¼ãƒ‰ã‚’é–‹å§‹
DEBUG=pcu:*,pnpm:* pcu check --verbose 2>&1 | tee pcu-debug.log

# åˆ¥ã®ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã§ãƒ­ã‚°ã‚’ç›£è¦–
tail -f pcu-debug.log | grep -E "(ERROR|WARN|TIMEOUT)"

# ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’åˆ†æ
DEBUG=pcu:registry pcu check 2>&1 | grep -E "(request|response)"
```

```bash {{ title: 'ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ç›£è¦–' }}
# PCU ãƒ—ãƒ­ã‚»ã‚¹ã®ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã‚’ç›£è¦–
#!/bin/bash
echo "æ™‚é–“,CPU%,ãƒ¡ãƒ¢ãƒªMB,ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯æ¥ç¶š" > pcu-monitor.csv

while pgrep -x pcu > /dev/null; do
  PID=$(pgrep -x pcu)
  CPU=$(ps -p $PID -o pcpu --no-headers)
  MEM=$(ps -p $PID -o rss --no-headers)
  MEM_MB=$((MEM / 1024))
  CONN=$(netstat -an | grep :443 | wc -l)

  echo "$(date '+%H:%M:%S'),$CPU,$MEM_MB,$CONN" >> pcu-monitor.csv
  sleep 1
done
```

</CodeGroup>

### å•é¡Œãƒ‘ã‚¿ãƒ¼ãƒ³èªè­˜

<CodeGroup>

```bash {{ title: 'ä¸€èˆ¬çš„ãªã‚¨ãƒ©ãƒ¼ãƒ‘ã‚¿ãƒ¼ãƒ³æ¤œç´¢' }}
# ãƒ­ã‚°ã®ã‚¨ãƒ©ãƒ¼ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’åˆ†æ
grep -E "(ENOTFOUND|ETIMEDOUT|ECONNRESET)" pcu-debug.log | wc -l
grep -E "(403|404|500)" pcu-debug.log | sort | uniq -c
grep -E "memory.*exceeded" pcu-debug.log

# ã‚¨ãƒ©ãƒ¼çµ±è¨ˆãƒ¬ãƒãƒ¼ãƒˆã‚’ç”Ÿæˆ
echo "=== PCU ã‚¨ãƒ©ãƒ¼çµ±è¨ˆ ==="
echo "ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¨ãƒ©ãƒ¼: $(grep -c "ENET\|TIMEOUT" pcu-debug.log)"
echo "æ¨©é™ã‚¨ãƒ©ãƒ¼: $(grep -c "403\|401\|EACCES" pcu-debug.log)"
echo "ãƒ¡ãƒ¢ãƒªã‚¨ãƒ©ãƒ¼: $(grep -c "memory\|heap" pcu-debug.log)"
echo "è¨­å®šã‚¨ãƒ©ãƒ¼: $(grep -c "Invalid.*config" pcu-debug.log)"
```

</CodeGroup>

ã“ã‚Œã‚‰ã®é«˜åº¦ãªãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚¬ã‚¤ãƒ‰ã¯ã€PCU ä½¿ç”¨æ™‚ã«é­é‡ã™ã‚‹è¤‡é›‘ãªå•é¡Œã‚’è§£æ±ºã™ã‚‹ã®ã«å½¹ç«‹ã¡ã¾ã™ã€‚å•é¡ŒãŒç¶™ç¶šã™ã‚‹å ´åˆã¯ã€ã€Œãƒ˜ãƒ«ãƒ—ã®å–å¾—ã€ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã®ã‚¬ã‚¤ãƒ€ãƒ³ã‚¹ã«å¾“ã£ã¦è¨ºæ–­æƒ…å ±ã‚’åé›†ã—ã€ã‚µãƒãƒ¼ãƒˆã‚’æ±‚ã‚ã¦ãã ã•ã„ã€‚
