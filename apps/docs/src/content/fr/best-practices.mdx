export const metadata = {
  title: 'Meilleures Pratiques',
  description:
    "Meilleures pratiques pour utiliser PCU efficacement dans les environnements d'√©quipe et les flux de travail d'entreprise.",
};

# Meilleures Pratiques

Apprenez √† utiliser PCU efficacement dans les environnements d'√©quipe, les flux de travail d'entreprise et les syst√®mes de production. {{ className: 'lead' }}

## Collaboration d'√âquipe

### Configuration Partag√©e

Maintenez la coh√©rence de votre configuration PCU entre les membres de l'√©quipe en versionnant votre `.pcurc.json` :

```json
{
  "target": "minor",
  "concurrency": 3,
  "timeout": 60000,
  "packageRules": [
    {
      "patterns": ["@types/*"],
      "target": "latest",
      "autoUpdate": true
    },
    {
      "patterns": ["react", "react-dom"],
      "target": "minor",
      "requireConfirmation": true
    }
  ],
  "exclude": ["legacy-*", "deprecated-*"]
}
```

### Directives de R√©vision de Code

**Liste de contr√¥le pr√©-r√©vision :**

1. Ex√©cutez `pcu check --dry-run` pour pr√©visualiser les changements
2. V√©rifiez qu'il n'y a pas de changements cassants dans les mises √† jour de version majeure
3. Testez les fonctionnalit√©s critiques apr√®s les mises √† jour de d√©pendances
4. Examinez les fichiers CHANGELOG des packages mis √† jour

**Processus de r√©vision :**

1. **S√©curit√© d'abord** : Examinez toujours imm√©diatement les mises √† jour de d√©pendances li√©es √† la s√©curit√©
2. **Grouper les mises √† jour li√©es** : Regroupez les packages connexes (ex. √©cosyst√®me React) dans des PR uniques
3. **Documenter les raisons** : Incluez la justification des √©pinglages de versions ou exclusions
4. **Couverture de tests** : Assurez-vous d'une couverture de tests ad√©quate avant de fusionner les mises √† jour de d√©pendances

### Standards de Communication

Utilisez des messages de commit clairs lors de la mise √† jour des d√©pendances :

```bash
# Bons messages de commit
feat(deps): mise √† jour React vers v18.3.0 pour de meilleures performances
security(deps): correctif vuln√©rabilit√© lodash CVE-2021-23337
chore(deps): mise √† jour des d√©pendances de d√©veloppement vers les derni√®res versions

# Mauvais messages de commit
update packages
fix deps
bump versions
```

## Usage d'Entreprise

### Gouvernance et Conformit√©

**Processus d'approbation des d√©pendances :**

1. **Scan de s√©curit√©** : Toutes les mises √† jour doivent passer les audits de s√©curit√©
2. **Conformit√© des licences** : V√©rifiez la compatibilit√© des licences avec les politiques internes
3. **Exigences de stabilit√©** : Pr√©f√©rez les versions LTS dans les environnements de production
4. **Gestion des changements** : Suivez les processus d'approbation des changements √©tablis

**Configuration pour l'entreprise :**

```json
{
  "target": "minor",
  "requireConfirmation": true,
  "security": {
    "autoFix": false,
    "severityThreshold": "moderate",
    "ignoredVulnerabilities": [],
    "customAuditConfig": {
      "low": "warn",
      "moderate": "error",
      "high": "error",
      "critical": "error"
    }
  },
  "packageRules": [
    {
      "patterns": ["*"],
      "exclude": false,
      "requireApproval": true,
      "maxMajorUpdates": 0
    }
  ]
}
```

### Int√©gration de Registre Priv√©

Configurez PCU pour les environnements d'entreprise avec des registres priv√©s :

```ini
# .npmrc (racine de l'espace de travail)
@company:registry=https://npm.company.com/
//npm.company.com/:_authToken=${NPM_TOKEN}
registry=https://npm.company.com/

# Fallback pour les packages publics
@types:registry=https://registry.npmjs.org/
```

**Variables d'environnement :**

```bash
export NPM_TOKEN=your_company_token
export PCU_CACHE_ENABLED=true
export PCU_TIMEOUT=120000
export PCU_CONCURRENCY=2
```

### Piste d'Audit et Rapports

Maintenez des enregistrements complets des changements de d√©pendances :

```bash
# G√©n√©rer des rapports de d√©pendances
pcu check --format json > dependency-report.json
pcu security --format json > security-report.json

# Inclure dans le pipeline CI/CD
- name: G√©n√©rer Rapport de D√©pendances
  run: |
    pcu check --format json > artifacts/deps-$(date +%Y%m%d).json
    pcu security --format json > artifacts/security-$(date +%Y%m%d).json
```

## Flux de Travail de Release

### Int√©gration du Versioning S√©mantique

Alignez les mises √† jour de d√©pendances avec votre cycle de release :

**Phase pr√©-release :**

```bash
# V√©rifier les mises √† jour sans les appliquer
pcu check --target patch --dry-run

# Mettre √† jour seulement les versions de patch durant le gel
pcu update --target patch --exclude "major-framework-*"
```

**Pr√©paration de la release :**

```bash
# Mettre √† jour vers les derni√®res versions stables
pcu update --target minor --exclude "experimental-*"

# G√©n√©rer les notes de release avec les changements de d√©pendances
pcu analyze default react 18.3.0 >> RELEASE_NOTES.md
```

**Post-release :**

```bash
# Mettre √† jour vers les derni√®res versions incluant les versions majeures
pcu update --target latest --interactive
```

### Tests d'Environnement de Staging

**Validation pr√©-production :**

<CodeGroup>

```bash {{ title: 'Pipeline de Staging' }}
# Mettre √† jour les d√©pendances en staging
pcu update --target minor --create-backup

# Ex√©cuter des tests complets
npm run test:integration
npm run test:e2e
npm run test:performance

# Rollback si des probl√®mes sont trouv√©s
pcu restore-backup
```

```yaml {{ title: 'GitHub Actions' }}
name: Tests de D√©pendances
on:
  schedule:
    - cron: '0 2 * * 1' # Hebdomadaire Lundi 2h du matin

jobs:
  dependency-updates:
    runs-on: ubuntu-latest
    steps:
      - name: Mettre √† jour les D√©pendances
        run: pcu update --target minor --dry-run

      - name: Tester les D√©pendances Mises √† jour
        run: |
          npm ci
          npm run test:all
          npm run build
```

</CodeGroup>

## Meilleures Pratiques de S√©curit√©

### Gestion des Vuln√©rabilit√©s

**R√©ponse imm√©diate PCU :**

1. **S√©v√©rit√© critique/√©lev√©e** : Mise √† jour sous 24 heures
2. **S√©v√©rit√© mod√©r√©e** : Mise √† jour sous 1 semaine
3. **S√©v√©rit√© faible** : Inclure dans le prochain cycle de mise √† jour r√©gulier

```bash
# Prioriser les correctifs de s√©curit√©
pcu security --severity critical --auto-fix
pcu security --severity high --fix-vulns --require-confirmation

# Audits de s√©curit√© r√©guliers
pcu security --format json --output security-audit.json
```

### Validation des D√©pendances

**Configuration de s√©curit√© :**

```json
{
  "security": {
    "enableSnyk": true,
    "autoFix": false,
    "allowedLicenses": ["MIT", "Apache-2.0", "BSD-3-Clause"],
    "blockedPackages": ["colors", "faker"],
    "trustedSources": ["@company/*", "@types/*"],
    "customAuditConfig": {
      "skipLevels": [],
      "excludeDevDependencies": false
    }
  }
}
```

**R√©visions de s√©curit√© manuelles :**

- Examinez toutes les nouvelles d√©pendances avant la premi√®re utilisation
- Auditez les mainteneurs de packages et les compteurs de t√©l√©chargement
- V√©rifiez l'authenticit√© et les signatures des packages
- V√©rifiez les probl√®mes de s√©curit√© connus dans les cha√Ænes de d√©pendances

### Contr√¥le d'Acc√®s

**Gestion des tokens :**

```bash
# Utilisez des tokens scop√©s avec des permissions minimales
NPM_TOKEN=npm_[REDACTED]_readonly_access_only

# Effectuez une rotation des tokens r√©guli√®rement (trimestriellement)
# Stockez les tokens dans des syst√®mes de gestion d'identifiants s√©curis√©s
# Ne commitez jamais les tokens dans le contr√¥le de version
```

## Optimisation des Performances

### Strat√©gies de Cache

**D√©veloppement local :**

```bash
# Activer le cache persistant
export PCU_CACHE_ENABLED=true
export PCU_CACHE_TTL=3600  # 1 heure
export PCU_CACHE_MAX_SIZE=100  # 100 MB
```

**Optimisation CI/CD :**

```yaml
- name: Cache PCU Data
  uses: actions/cache@v3
  with:
    path: ~/.pcu-cache
    key: pcu-cache-${{ runner.os }}-${{ hashFiles('pnpm-workspace.yaml') }}

- name: Ex√©cution PCU Optimis√©e
  run: |
    export PCU_CACHE_ENABLED=true
    pcu check --concurrency 5 --timeout 30000
```

### Gestion des Gros Monorepos

**Configuration pour 100+ packages :**

```json
{
  "concurrency": 2,
  "timeout": 120000,
  "batchSize": 10,
  "advanced": {
    "memoryOptimization": true,
    "parallelCatalogs": false,
    "incrementalUpdates": true
  }
}
```

**Traitement s√©lectif :**

```bash
# Traiter par cat√©gories
pcu check --include "@company/ui-*" --limit 20
pcu check --include "@company/api-*" --limit 20
pcu check --include "@types/*" --target latest

# Utiliser le filtrage pour les grosses op√©rations
pcu update --include "react*" --exclude "*-experimental"
```

### Optimisation R√©seau

**Configuration de registre :**

```bash
# Utilisez des registres plus rapides g√©ographiquement proches de votre localisation
export PCU_REGISTRY=https://registry-asia.npmjs.org/
export PCU_TIMEOUT=60000
export PCU_MAX_RETRIES=3
```

## Gestion d'Erreurs et R√©cup√©ration

### R√©solution d'Erreurs Courantes

**Probl√®mes r√©seau :**

```bash
# Augmenter les timeouts pour les connexions lentes
PCU_TIMEOUT=120000 pcu check

# Utiliser des registres alternatifs
PCU_REGISTRY=https://registry.npmjs.org/ pcu check

# Activer le d√©bogage pour les probl√®mes r√©seau
DEBUG=pcu:network pcu check
```

**Probl√®mes de m√©moire :**

```bash
# Augmenter la limite m√©moire de Node.js
NODE_OPTIONS="--max-old-space-size=8192" pcu check

# R√©duire la concurrence pour les environnements √† m√©moire contrainte
pcu check --concurrency 1
```

### Sauvegarde et R√©cup√©ration

**Cr√©er des sauvegardes avant les mises √† jour majeures :**

```bash
# Cr√©ation automatique de sauvegarde
pcu update --create-backup --target minor

# Sauvegarde manuelle
cp pnpm-workspace.yaml pnpm-workspace.yaml.backup
cp -r packages/*/package.json backups/

# Restaurer depuis la sauvegarde
pcu restore-backup --timestamp 2024-01-15T10:30:00Z
```

**Strat√©gie de rollback de version :**

```bash
# Rollback de packages sp√©cifiques
pcu rollback react 18.2.0
pcu rollback @types/node 20.5.0

# Rollback du catalogue entier
git checkout HEAD~1 pnpm-workspace.yaml
pnpm install
```

### Monitoring et Alertes

**Int√©gration CI/CD :**

```yaml
- name: Contr√¥le de Sant√© des D√©pendances
  run: |
    set -e
    pcu check --format json > check-results.json

    # Parser les r√©sultats et d√©finir les alertes
    if grep -q "critical" check-results.json; then
      echo "::error::Probl√®mes de d√©pendances critiques trouv√©s"
      exit 1
    fi

- name: Monitoring de S√©curit√©
  run: |
    pcu security --format json > security-results.json

    # Alerte sur les vuln√©rabilit√©s √©lev√©es/critiques
    CRITICAL_COUNT=$(jq '.vulnerabilities.critical // 0' security-results.json)
    if [ "$CRITICAL_COUNT" -gt 0 ]; then
      # Envoyer une alerte au syst√®me de monitoring
      curl -X POST "$SLACK_WEBHOOK" -d '{"text":"üö® Vuln√©rabilit√©s de s√©curit√© critiques trouv√©es"}'
    fi
```

## Patterns d'Int√©gration

### Int√©gration IDE et √âditeur

**Configuration VS Code :**

```json
{
  "terminal.integrated.env.linux": {
    "PCU_CACHE_ENABLED": "true"
  },
  "tasks.json": {
    "version": "2.0.0",
    "tasks": [
      {
        "label": "PCU Check",
        "type": "shell",
        "command": "pcu check --interactive",
        "group": "build",
        "presentation": {
          "echo": true,
          "reveal": "always",
          "focus": false,
          "panel": "shared"
        }
      }
    ]
  }
}
```

### Scripts d'Automatisation

**Scripts Package.json :**

```json
{
  "scripts": {
    "deps:check": "pcu check",
    "deps:update:patch": "pcu update --target patch",
    "deps:update:minor": "pcu update --target minor --interactive",
    "deps:security": "pcu security --fix-vulns",
    "deps:analyze": "pcu analyze default",
    "prerelease": "npm run deps:check && npm run deps:security"
  }
}
```

**Int√©gration Git Hooks :**

```bash
#!/bin/sh
# .git/hooks/pre-commit

# V√©rifier les probl√®mes de d√©pendances avant commit
if command -v pcu &> /dev/null; then
  pcu check --format json > /dev/null || {
    echo "‚ö†Ô∏è  Probl√®mes de d√©pendances d√©tect√©s. Ex√©cutez 'pcu check' pour les d√©tails."
    exit 1
  }
fi
```

---

## Liste de Contr√¥le de R√©f√©rence Rapide

### Flux de Travail Quotidien

1. V√©rifier les mises √† jour de s√©curit√© : `pcu security`
2. Examiner les d√©pendances obsol√®tes : `pcu check --limit 10`
3. Mettre √† jour les versions de patch : `pcu update --target patch`

### Flux de Travail Hebdomadaire

1. V√©rification compl√®te des d√©pendances : `pcu check`
2. Mettre √† jour les versions mineures : `pcu update --target minor --interactive`
3. Examiner et mettre √† jour les r√®gles d'exclusion
4. G√©n√©rer des rapports de d√©pendances pour r√©vision d'√©quipe

### Flux de Travail Mensuel

1. Examiner les mises √† jour de versions majeures : `pcu check --target latest`
2. Mettre √† jour les d√©pendances de d√©veloppement : `pcu update --dev`
3. Auditer les licences de d√©pendances et la conformit√©
4. Examiner et optimiser la configuration PCU
5. Nettoyer les d√©pendances inutilis√©es

### Avant les Releases

1. Ex√©cuter un audit complet des d√©pendances : `pcu security --comprehensive`
2. Cr√©er une sauvegarde : `pcu update --create-backup`
3. Tester en environnement de staging
4. G√©n√©rer les notes de release avec les changements de d√©pendances
