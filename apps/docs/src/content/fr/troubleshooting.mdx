export const metadata = {
  title: 'D√©pannage',
  description:
    "Probl√®mes courants et solutions lors de l'utilisation de pnpm-catalog-updates. Messages d'erreur, conseils de d√©bogage et guides de d√©pannage.",
};

# D√©pannage

Probl√®mes courants et solutions pour vous aider √† r√©soudre les probl√®mes avec PCU. Trouvez des r√©ponses aux erreurs fr√©quemment rencontr√©es et des conseils de d√©bogage. {{ className: 'lead' }}

## Erreurs Courantes

### Espace de Travail Non Trouv√©

**Message d'Erreur :**

```
Error: No pnpm workspace found in the current directory
```

**Cause :** PCU n'a pas pu localiser un fichier `pnpm-workspace.yaml` ou d√©tecter une structure d'espace de travail pnpm valide.

**Solutions :**

<CodeGroup>

```bash {{ title: 'Initialiser l'Espace de Travail' }}
# Cr√©er un nouvel espace de travail pnpm
pcu init

# Ou cr√©er manuellement pnpm-workspace.yaml
echo "packages:
  - 'packages/*'" > pnpm-workspace.yaml
```

```bash {{ title: 'Sp√©cifier le Chemin de l'Espace de Travail' }}
# Ex√©cuter PCU depuis la racine de l'espace de travail
cd /path/to/workspace/root
pcu -c

# Ou sp√©cifier le r√©pertoire de l'espace de travail
pcu -c --workspace /path/to/workspace
```

</CodeGroup>

---

### Aucune D√©pendance de Catalogue

**Message d'Erreur :**

```
No catalog dependencies found in workspace
```

**Cause :** Votre espace de travail n'utilise pas les d√©pendances de catalogue pnpm.

**Solutions :**

<CodeGroup>

```yaml {{ title: 'Ajouter un Catalogue √† pnpm-workspace.yaml' }}
packages:
  - 'packages/*'

catalog:
  react: ^18.2.0
  typescript: ^5.0.0
  lodash: ^4.17.21
```

```json {{ title: 'Utiliser le Catalogue dans package.json' }}
{
  "name": "my-package",
  "dependencies": {
    "react": "catalog:",
    "typescript": "catalog:",
    "lodash": "catalog:"
  }
}
```

</CodeGroup>

---

### Probl√®mes d'Acc√®s au Registre

**Message d'Erreur :**

```
Error: getaddrinfo ENOTFOUND registry.npmjs.org
```

**Cause :** Probl√®mes de connectivit√© r√©seau ou d'acc√®s au registre.

**Solutions :**

<CodeGroup>

```bash {{ title: 'D√©pannage R√©seau' }}
# V√©rifier la connectivit√© r√©seau
ping registry.npmjs.org

# Tester avec un timeout augment√©
pcu -c --timeout 60000

# R√©duire les requ√™tes concurrentes
pcu -c --concurrency 2
```

```ini {{ title: 'Configurer le Registre (.npmrc)' }}
# Utiliser un registre diff√©rent
registry=https://registry.npmjs.org/

# Pour les r√©seaux d'entreprise
registry=https://your-corporate-registry.com/
strict-ssl=false
```

</CodeGroup>

---

### Erreurs d'Authentification

**Message d'Erreur :**

```
Error: 401 Unauthorized - authentication required
```

**Cause :** Jetons d'authentification manquants ou invalides pour les registres priv√©s.

**Solutions :**

<CodeGroup>

```ini {{ title: 'Configurer l'Auth (.npmrc)' }}
@myorg:registry=https://npm.private-registry.com/
//npm.private-registry.com/:_authToken=${NPM_TOKEN}

# Ou utiliser l'auth legacy
//npm.private-registry.com/:username=myuser
//npm.private-registry.com/:_password=base64password
//npm.private-registry.com/:email=my.email@example.com
```

```bash {{ title: 'D√©finir la Variable d'Environnement' }}
export NPM_TOKEN=your_token_here
pcu -c
```

</CodeGroup>

---

### Erreurs de Fichier de Configuration

**Message d'Erreur :**

```
Error: Invalid configuration in .pcurc.json
```

**Cause :** JSON malform√© ou options de configuration invalides.

**Solutions :**

<CodeGroup>

```bash {{ title: 'Valider la Configuration' }}
# V√©rifier la syntaxe JSON
node -e "console.log(JSON.parse(require('fs').readFileSync('.pcurc.json', 'utf8')))"

# R√©g√©n√©rer la configuration
mv .pcurc.json .pcurc.json.backup
pcu init --force
```

```json {{ title: 'Configuration Valide Minimale' }}
{
  "defaults": {
    "target": "latest"
  },
  "output": {
    "format": "table"
  }
}
```

</CodeGroup>

## D√©bogage

### Activer la Journalisation Verbose

<CodeGroup>

```bash {{ title: 'Sortie Verbose' }}
# Activer la journalisation verbose
pcu -c --verbose

# Mode d√©bogage avec variable d'environnement
DEBUG=pcu:* pcu -c

# Modules de d√©bogage sp√©cifiques
DEBUG=pcu:core,pcu:registry pcu -c
```

```bash {{ title: 'Sortie vers Fichier' }}
# Sauvegarder la sortie de d√©bogage
pcu -c --verbose > debug.log 2>&1

# V√©rifier le fichier de log
cat debug.log | grep -i error
```

</CodeGroup>

### Validation de l'Espace de Travail

<CodeGroup>

```bash {{ title: 'Valider l'Espace de Travail' }}
# V√©rifier la configuration de l'espace de travail
pcu -s --validate

# Obtenir des informations d√©taill√©es sur l'espace de travail
pcu -s --stats --verbose
```

```bash {{ title: 'Validation Manuelle' }}
# V√©rifier que pnpm-workspace.yaml existe
ls -la pnpm-workspace.yaml

# V√©rifier la syntaxe du catalogue
pnpm exec -- pnpm list --depth=0
```

</CodeGroup>

## Probl√®mes de Performance

### Requ√™tes R√©seau Lentes

**Sympt√¥mes :** PCU prend beaucoup de temps pour v√©rifier les mises √† jour

**Solutions :**

<CodeGroup>

```json {{ title: 'Optimiser la Configuration' }}
{
  "advanced": {
    "concurrency": 3,
    "timeout": 30000,
    "retries": 2,
    "cacheValidityMinutes": 120
  }
}
```

```bash {{ title: 'Gestion du Cache' }}
# Vider le cache s'il est obsol√®te
rm -rf ~/.pcu/cache

# D√©sactiver le cache pour le d√©bogage
pcu -c --no-cache
```

</CodeGroup>

### Utilisation M√©moire √âlev√©e

**Sympt√¥mes :** PCU consomme une m√©moire excessive avec de grands espaces de travail

**Solutions :**

<CodeGroup>

```json {{ title: 'Optimisation M√©moire' }}
{
  "advanced": {
    "concurrency": 2,
    "batchSize": 10
  }
}
```

```bash {{ title: 'Gestion des Processus' }}
# Surveiller l'utilisation m√©moire
top -p $(pgrep node)

# Utiliser les flags m√©moire Node.js
node --max-old-space-size=4096 $(which pcu) -c
```

</CodeGroup>

## Probl√®mes d'Environnement

### Compatibilit√© Version Node.js

**Message d'Erreur :**

```
Error: Unsupported Node.js version
```

**Solutions :**

<CodeGroup>

```bash {{ title: 'V√©rifier la Version' }}
node --version  # Devrait √™tre >= 18.0.0

# Installer une version compatible
nvm install 20
nvm use 20
```

```bash {{ title: 'Mettre √† jour Node.js' }}
# Utiliser nvm
nvm install --lts
nvm use --lts

# V√©rifier l'installation
node --version
npm --version
```

</CodeGroup>

### Probl√®mes de Version pnpm

**Message d'Erreur :**

```
Error: pnpm command not found
```

**Solutions :**

<CodeGroup>

```bash {{ title: 'Installer pnpm' }}
# Installer la derni√®re version de pnpm
npm install -g pnpm@latest

# V√©rifier l'installation
pnpm --version  # Devrait √™tre >= 8.0.0
```

```bash {{ title: 'Installation Alternative' }}
# Utiliser Corepack (recommand√©)
corepack enable
corepack prepare pnpm@latest --activate

# T√©l√©chargement direct
curl -fsSL https://get.pnpm.io/install.sh | sh -
```

</CodeGroup>

## Probl√®mes Sp√©cifiques √† Windows

### Probl√®mes de S√©parateur de Chemin

**Message d'Erreur :**

```
Error: Cannot resolve workspace path
```

**Solutions :**

<CodeGroup>

```bash {{ title: 'Utiliser des Barres Obliques' }}
# Utiliser des barres obliques dans les chemins
pcu -c --workspace ./my/workspace

# Ou utiliser PowerShell
pwsh -c "pcu -c"
```

```json {{ title: 'Configuration Windows' }}
{
  "workspace": {
    "pathSeparator": "/"
  }
}
```

</CodeGroup>

### Erreurs de Permission

**Message d'Erreur :**

```
Error: EPERM: operation not permitted
```

**Solutions :**

<CodeGroup>

```cmd {{ title: 'Ex√©cuter en tant qu'Administrateur' }}
# Ex√©cuter l'Invite de commandes en tant qu'Administrateur
runas /user:Administrator cmd

# Ou utiliser PowerShell en tant qu'Administrateur
Start-Process powershell -Verb RunAs
```

```bash {{ title: 'Corriger les Permissions' }}
# Corriger les permissions npm
npm config set cache ~/.npm-cache
npm config set prefix ~/npm-global
```

</CodeGroup>

## Obtenir de l'Aide

### Informations de Diagnostic

Lors du signalement de probl√®mes, incluez ces informations de diagnostic :

<CodeGroup>

```bash {{ title: 'Informations Syst√®me' }}
# Version PCU
pcu --version

# Versions Node.js et pnpm
node --version
pnpm --version

# Syst√®me d'exploitation
uname -a  # Linux/macOS
systeminfo  # Windows
```

```bash {{ title: 'Informations de Configuration' }}
# Afficher la configuration actuelle
cat .pcurc.json

# Validation de l'espace de travail
pcu -s --validate --verbose

# Sortie de d√©bogage
DEBUG=pcu:* pcu -c --verbose
```

</CodeGroup>

### Canaux de Support

- üêõ **Rapports de Bugs** : [GitHub Issues](https://github.com/houko/pnpm-catalog-updates/issues)
- üí¨ **Questions** : [GitHub Discussions](https://github.com/houko/pnpm-catalog-updates/discussions)
- üìñ **Documentation** : Consultez cette documentation pour des guides d√©taill√©s
- üîß **Demandes de Fonctionnalit√©s** : Utilisez GitHub Issues avec le label enhancement

### Mod√®le de Rapport de Bug

Lors du signalement de bugs, veuillez inclure :

1. **Version PCU** et **commande utilis√©e**
2. **Message d'erreur** (sortie compl√®te avec `--verbose`)
3. **Environnement** (OS, versions Node.js, pnpm)
4. **Structure de l'espace de travail** (pnpm-workspace.yaml, package.json)
5. **Configuration** (.pcurc.json, .npmrc si pertinent)
6. **√âtapes pour reproduire** le probl√®me
7. **Comportement attendu vs r√©el**

## Probl√®mes de Commande de S√©curit√©

### Probl√®mes d'Int√©gration Snyk

**Message d'Erreur :**

```
Error: Snyk CLI not found
```

**Cause :** Snyk CLI n'est pas install√© mais le flag `--snyk` est utilis√©.

**Solutions :**

<CodeGroup>

```bash {{ title: 'Installer Snyk CLI' }}
# Installer Snyk globalement
npm install -g snyk

# S'authentifier avec Snyk
snyk auth

# Tester l'installation Snyk
snyk --version
```

```bash {{ title: 'Ex√©cuter sans Snyk' }}
# Utiliser seulement npm audit (par d√©faut)
pcu security

# D√©sactiver explicitement Snyk
pcu security --no-snyk
```

</CodeGroup>

### √âchecs de Correction de S√©curit√©

**Message d'Erreur :**

```
Error: Unable to automatically fix vulnerabilities
```

**Cause :** Certaines vuln√©rabilit√©s n√©cessitent une intervention manuelle ou des mises √† jour de version majeure.

**Solutions :**

<CodeGroup>

```bash {{ title: 'Corrections de S√©curit√© Manuelles' }}
# R√©viser d'abord les vuln√©rabilit√©s
pcu security --format json > security.json

# Essayer la correction automatis√©e
pcu security --fix-vulns

# Mises √† jour manuelles de packages si n√©cessaire
pcu -u --include "vulnerable-package"
```

```bash {{ title: 'Forcer les Mises √† jour Majeures pour la S√©curit√©' }}
# Autoriser les mises √† jour majeures pour les corrections de s√©curit√©
pcu security --fix-vulns --allow-major-security

# V√©rifier l'impact avant d'appliquer
pcu -a default vulnerable-package
```

</CodeGroup>

---

### Probl√®mes de Commande de Th√®me

**Message d'Erreur :**

```
Error: Theme 'custom-theme' not found
```

**Cause :** Tentative de d√©finir un th√®me qui n'existe pas.

**Solutions :**

<CodeGroup>

```bash {{ title: 'Lister les Th√®mes Disponibles' }}
# Voir tous les th√®mes disponibles
pcu theme --list

# Utiliser la s√©lection interactive de th√®me
pcu theme --interactive
```

```bash {{ title: 'R√©initialiser au Th√®me par D√©faut' }}
# R√©initialiser au th√®me par d√©faut
pcu theme --set default

# Ou supprimer la configuration de th√®me
rm ~/.pcu/theme.json
```

</CodeGroup>

---

### Probl√®mes de Mode Interactif

**Message d'Erreur :**

```
Error: Interactive mode not supported in this environment
```

**Cause :** Ex√©cution de PCU dans un environnement non interactif (CI, pipe, etc.).

**Solutions :**

<CodeGroup>

```bash {{ title: 'Alternatives Non Interactives' }}
# Utiliser dry-run pour pr√©visualiser les changements
pcu -u --dry-run

# Utiliser des cibles sp√©cifiques au lieu d'interactif
pcu -u --target minor

# Utiliser un fichier de configuration pour l'automatisation
pcu -u --config .pcurc.json
```

```bash {{ title: 'Forcer le Mode Interactif' }}
# Forcer TTY pour le mode interactif
script -c "pcu -i" /dev/null

# Utiliser un terminal sp√©cifique
TERM=xterm pcu -i
```

</CodeGroup>

## Probl√®mes Sp√©cifiques aux Commandes

### Probl√®mes de Commande d'Analyse

**Message d'Erreur :**

```
Error: Package 'react' not found in catalog 'nonexistent'
```

**Cause :** Analyse d'un package qui n'existe pas dans le catalogue sp√©cifi√©.

**Solutions :**

<CodeGroup>

```bash {{ title: 'V√©rifier les Catalogues Disponibles' }}
# Lister les catalogues de l'espace de travail
pcu workspace --stats

# V√©rifier si le package existe dans le catalogue par d√©faut
pcu -a default react

# Lister tous les packages dans le catalogue
pcu -c --catalog specific-catalog
```

```bash {{ title: 'V√©rifier les Noms de Package' }}
# Rechercher des noms de packages similaires
pcu -c --include "*react*"

# V√©rifier que le package existe dans le registre
npm view react versions --json
```

</CodeGroup>

### √âchecs de Commande de Mise √† jour

**Message d'Erreur :**

```
Error: Failed to update package.json files
```

**Cause :** Probl√®mes de permissions de fichier ou de structure d'espace de travail.

**Solutions :**

<CodeGroup>

```bash {{ title: 'V√©rifier les Permissions' }}
# V√©rifier les permissions de fichier
ls -la pnpm-workspace.yaml
find packages -name "package.json" -exec ls -la {} \;

# Corriger les permissions si n√©cessaire
chmod u+w pnpm-workspace.yaml
chmod u+w packages/*/package.json
```

```bash {{ title: 'Validation de l'Espace de Travail' }}
# Valider d'abord l'espace de travail
pcu workspace --validate

# Utiliser le flag de sauvegarde pour la s√©curit√©
pcu -u --create-backup

# Tester avec dry-run
pcu -u --dry-run
```

</CodeGroup>

## D√©bogage Avanc√©

### Investigation de Fuite M√©moire

**Sympt√¥mes :** La m√©moire du processus PCU continue de cro√Ætre pendant l'op√©ration

**√âtapes de D√©bogage :**

<CodeGroup>

```bash {{ title: 'Surveillance M√©moire' }}
# Surveiller l'utilisation m√©moire
watch -n 1 'ps aux | grep pcu'

# Utiliser le profilage m√©moire Node.js
node --inspect $(which pcu) -c

# Activer la journalisation du garbage collection
node --trace-gc $(which pcu) -c
```

```bash {{ title: 'D√©bogage Grand Espace de Travail' }}
# Traiter par plus petits lots
pcu -c --batch-size 10

# R√©duire la concurrence
pcu -c --concurrency 1

# Activer l'optimisation m√©moire
node --optimize-for-size $(which pcu) -c
```

</CodeGroup>

### Probl√®mes de R√©ponse du Registre

**Sympt√¥mes :** R√©sultats incoh√©rents ou erreurs de timeout

**√âtapes de D√©bogage :**

<CodeGroup>

```bash {{ title: 'D√©bogage du Registre' }}
# Tester la connectivit√© du registre
curl -I https://registry.npmjs.org/

# V√©rifier le temps de r√©ponse du registre
time npm view react versions

# Utiliser des registres alternatifs
npm config set registry https://registry.npmmirror.com/
```

```bash {{ title: 'Diagnostics R√©seau' }}
# Tracer les requ√™tes r√©seau
DEBUG=pcu:registry pcu -c

# Surveiller l'activit√© r√©seau
netstat -an | grep :443

# Tester avec diff√©rents timeouts
pcu -c --timeout 5000
pcu -c --timeout 30000
```

</CodeGroup>

### Probl√®mes d'H√©ritage de Configuration

**Sympt√¥mes :** Configuration non appliqu√©e comme attendu

**√âtapes de D√©bogage :**

<CodeGroup>

```bash {{ title: 'R√©solution de Configuration' }}
# V√©rifier les emplacements des fichiers de config
ls -la .pcurc.json
ls -la ~/.pcurc.json
ls -la ~/.config/pcu/config.json

# D√©boguer le chargement de config
DEBUG=pcu:config pcu -c --verbose

# Afficher la configuration effective
pcu config --show-effective
```

```bash {{ title: 'Validation de Configuration' }}
# Valider la syntaxe de config
node -pe "JSON.parse(require('fs').readFileSync('.pcurc.json'))"

# Tester avec une config minimale
echo '{"defaults":{"target":"latest"}}' > test.pcurc.json
pcu -c --config test.pcurc.json
```

</CodeGroup>
