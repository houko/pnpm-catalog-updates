export const metadata = {
  title: '예시',
  description:
    'pnpm-catalog-updates의 실제 예시와 사용 사례입니다. 실용적인 시나리오와 일반적인 워크플로우에서 배워보세요.',
};

# 예시

PCU를 최대한 활용하는 데 도움이 되는 실제 예시와 사용 사례입니다. 간단한 업데이트부터 복잡한 모노레포 관리까지. {{ className: 'lead' }}

## 기본 워크플로우

### 일일 종속성 확인

일일 개발 루틴의 일부로 업데이트를 확인하세요:

<CodeGroup>

```bash {{ title: '빠른 확인' }}
# 간단한 출력으로 업데이트 확인
pcu -c --format minimal

# 예시 출력:
# react           ^18.2.0  →  ^18.3.0
# typescript      ^5.0.0   →  ^5.2.0
# @types/node     ^18.0.0  →  ^20.0.0
```

```bash {{ title: '상세 확인' }}
# 전체 테이블 형식으로 확인
pcu -c

# 다음을 포함한 색상 테이블을 보여줌:
# - 패키지 이름
# - 현재 버전
# - 사용 가능한 버전
# - 업데이트 유형 (major/minor/patch)
# - 보안 표시기
```

</CodeGroup>

### 백업과 함께 안전한 업데이트

자동 백업과 함께 종속성을 안전하게 업데이트하세요:

```bash
# 백업과 함께 대화형 업데이트
pcu -i -b

# 또는 백업과 함께 자동화된 마이너 업데이트
pcu -u --target minor --create-backup
```

### 타겟별 업데이트

특정 유형의 변경 사항만 업데이트하세요:

<CodeGroup>

```bash {{ title: '보수적 업데이트' }}
# 패치 업데이트만 (버그 수정)
pcu -u --target patch

# 마이너 업데이트만 (새 기능, 호환성 변경 없음)
pcu -u --target minor
```

```bash {{ title: '최신 모든 것' }}
# 최신 버전으로 업데이트 (메이저 포함)
pcu -u --target latest

# 프리릴리스 버전 포함
pcu -u --prerelease
```

</CodeGroup>

## 멀티 카탈로그 워크스페이스

### 레거시 지원 시나리오

하나의 워크스페이스에서 여러 React 버전 관리:

<CodeGroup>

```yaml {{ title: 'pnpm-workspace.yaml' }}
packages:
  - "apps/*"
  - "packages/*"

catalog:
  # 기본 카탈로그 - 최신 버전
  react: ^18.2.0
  react-dom: ^18.2.0
  @types/react: ^18.2.0

catalogs:
  # 레거시 지원
  react17:
    react: ^17.0.2
    react-dom: ^17.0.2
    @types/react: ^17.0.62

  # 베타 테스트
  react-next:
    react: ^19.0.0-beta
    react-dom: ^19.0.0-beta
```

```bash {{ title: '카탈로그별 업데이트' }}
# 기본 카탈로그만 업데이트
pcu -u --catalog default

# 레거시 React 버전 업데이트
pcu -u --catalog react17 --target minor

# 베타 버전 확인
pcu -c --catalog react-next --prerelease
```

</CodeGroup>

### 패키지 사용법

```json {{ title: 'package.json' }}
{
  "name": "@myorg/modern-app",
  "dependencies": {
    "react": "catalog:",
    "react-dom": "catalog:"
  }
}
```

```json {{ title: '레거시 package.json' }}
{
  "name": "@myorg/legacy-app",
  "dependencies": {
    "react": "catalog:react17",
    "react-dom": "catalog:react17"
  }
}
```

## 구성 예시

### React 생태계 관리

React 및 관련 패키지의 조정된 업데이트:

```json {{ title: '.pcurc.json' }}
{
  "packageRules": [
    {
      "patterns": ["react", "react-dom"],
      "target": "minor",
      "requireConfirmation": true,
      "relatedPackages": [
        "@types/react",
        "@types/react-dom",
        "react-router-dom",
        "@testing-library/react"
      ]
    }
  ],
  "security": {
    "autoFixVulnerabilities": true,
    "allowMajorForSecurity": true
  }
}
```

### TypeScript 프로젝트 구성

자동 타입 정의가 포함된 보수적인 TypeScript 업데이트:

```json {{ title: '.pcurc.json' }}
{
  "packageRules": [
    {
      "patterns": ["typescript"],
      "target": "minor",
      "requireConfirmation": true
    },
    {
      "patterns": ["@types/*"],
      "target": "latest",
      "autoUpdate": true
    },
    {
      "patterns": ["eslint*", "@typescript-eslint/*"],
      "target": "minor",
      "groupUpdate": true
    }
  ]
}
```

### 기업용 구성

엄격한 제어가 포함된 기업용 구성:

```json {{ title: '.pcurc.json' }}
{
  "defaults": {
    "target": "minor",
    "createBackup": true
  },
  "exclude": ["typescript", "@types/node", "react", "react-dom"],
  "security": {
    "autoFixVulnerabilities": true,
    "allowMajorForSecurity": true,
    "notifyOnSecurityUpdate": true
  },
  "advanced": {
    "concurrency": 3,
    "timeout": 60000,
    "retries": 5
  },
  "ui": {
    "theme": "minimal",
    "animations": false
  }
}
```

## CI/CD 통합

### GitHub Actions

CI 파이프라인에서 종속성 확인 자동화:

<CodeGroup>

```yaml {{ title: '.github/workflows/dependencies.yml' }}
name: Check Dependencies

on:
  schedule:
    - cron: '0 9 * * MON'  # 매주 월요일 오전 9시
  workflow_dispatch:

jobs:
  check-deps:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-node@v4
        with:
          node-version: '20'

      - name: PCU 설치
        run: npm install -g pcu

      - name: 업데이트 확인
        run: pcu -c --format json > updates.json

      - name: 업데이트가 있을 경우 이슈 생성
        if: success()
        uses: actions/github-script@v7
        with:
          script: |
            const fs = require('fs');
            const updates = JSON.parse(fs.readFileSync('updates.json', 'utf8'));
            if (updates.length > 0) {
              github.rest.issues.create({
                owner: context.repo.owner,
                repo: context.repo.repo,
                title: 'Dependencies Update Available',
                body: `Found ${updates.length} packages that can be updated:

` +
                      updates.map(u => `- ${u.package}: ${u.current} → ${u.available}`).join('
')
              });
            }
```

```bash {{ title: 'Package.json 스크립트' }}
# package.json에 추가
{
  "scripts": {
    "deps:check": "pcu -c",
    "deps:update": "pcu -i -b",
    "deps:update-minor": "pcu -u --target minor --create-backup",
    "deps:analyze": "pcu -a default"
  }
}
```

</CodeGroup>

## 오류 처리 및 문제 해결

### 네트워크 문제

네트워크 문제 및 레지스트리 접근 처리:

```bash
# 느린 연결을 위한 타임아웃 증가
pcu -c --timeout 60000

# 불안정한 네트워크를 위한 동시성 감소
pcu -u --concurrency 2
```

### 워크스페이스 유효성 검사

워크스페이스 설정 유효성 검사:

```bash
# 워크스페이스 구성 확인
pcu -s --validate

# 상세한 워크스페이스 정보 얻기
pcu -s --stats --verbose
```

### 프라이빗 레지스트리

PCU는 자동으로 `.npmrc` 및 `.pnpmrc` 구성을 읽습니다:

<CodeGroup>

```ini {{ title: '.npmrc' }}
@myorg:registry=https://npm.private-registry.com/
//npm.private-registry.com/:_authToken=${NPM_TOKEN}

registry=https://registry.npmjs.org/
```

```bash {{ title: '사용법' }}
# PCU는 자동으로 레지스트리 설정을 사용합니다
pcu -c

# 프라이빗 레지스트리의 패키지 확인
pcu -c --include "@myorg/*"
```

</CodeGroup>

## 고급 사용 사례

### 영향 분석

특정 패키지 업데이트의 영향 분석:

```bash
# React 업데이트 영향 분석
pcu -a default react

# 특정 버전으로 분석
pcu -a default react 18.3.0

# 모든 카탈로그에 걸친 영향 확인
pcu -a react17 react 17.0.3
```

### 선택적 업데이트

특정 패키지나 패턴만 업데이트:

```bash
# React 관련 패키지만 업데이트
pcu -u --include "react*"

# 핵심 프레임워크를 제외한 모든 것 업데이트
pcu -u --exclude "react*,vue*,angular*"

# 타입 정의만 업데이트
pcu -u --include "@types/*" --target latest
```

### 드라이 런 분석

적용하기 전에 변경 사항 미리보기:

```bash
# 업데이트될 내용 확인
pcu -u --dry-run --verbose

# 특정 타겟으로 미리보기
pcu -u --dry-run --target minor --include "@types/*"
```

## 모범 사례

### 일일 워크플로우

1. **아침 확인**: `pcu -c`로 사용 가능한 업데이트 확인
2. **영향 검토**: 중요한 업데이트에 대해 `pcu -a` 사용
3. **안전한 업데이트**: 백업과 함께 대화형 업데이트 `pcu -i -b`
4. **테스트**: 업데이트 후 테스트 스위트 실행
5. **커밋**: 종속성 업데이트를 별도로 커밋

### 팀 워크플로우

1. **공유 구성**: `.pcurc.json`을 버전 관리에 커밋
2. **정기 검토**: 주간 종속성 검토 회의 일정
3. **보안 우선순위**: 항상 보안 업데이트 우선 처리
4. **문서화**: 주요 종속성 결정 문서화
5. **롤백 계획**: 쉬운 롤백을 위한 백업 유지

### 릴리스 워크플로우

1. **프리 릴리스 확인**: 릴리스 전 `pcu -c --target patch`
2. **보안 스캔**: CI에서 `autoFixVulnerabilities` 활성화
3. **버전 고정**: 프로덕션 릴리스에 정확한 버전 사용
4. **업데이트 일정**: 릴리스 간 종속성 업데이트 계획

## 보안 모니터링

### 지속적 보안 스캔

개발 워크플로우에 보안 스캔 통합:

<CodeGroup>

```bash {{ title: '일일 보안 확인' }}
# 빠른 보안 스캔
pcu security

# 취약점 자동 수정
pcu security --fix-vulns

# 높음 및 치명적 문제에만 집중
pcu security --severity high --fix-vulns
```

```bash {{ title: '종합 보안 감사' }}
# Snyk 통합을 통한 전체 보안 스캔
pcu security --snyk --include-dev --verbose

# 검토를 위한 보안 보고서 내보내기
pcu security --format json --snyk > security-report.json
```

</CodeGroup>

### 보안 중심 CI/CD

```yaml {{ title: '.github/workflows/security.yml' }}
name: Security Audit

on:
  schedule:
    - cron: '0 2 * * *' # 매일 오전 2시
  pull_request:
    branches: [main]

jobs:
  security:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-node@v4
        with:
          node-version: '20'

      - name: PCU 설치
        run: npm install -g pcu

      - name: 보안 스캔
        run: pcu security --fix-vulns --format json > security-results.json

      - name: 보안 보고서 업로드
        uses: actions/upload-artifact@v4
        with:
          name: security-report
          path: security-results.json
```

## 테마 사용자 정의

### 대화형 테마 설정

팀을 위한 PCU 모양 구성:

```bash
# 대화형 테마 마법사 시작
pcu theme --interactive

# 특정 테마 설정
pcu theme --set modern

# 미리보기와 함께 모든 사용 가능한 테마 나열
pcu theme --list
```

### 팀 테마 구성

```json {{ title: '.pcurc.json' }}
{
  "ui": {
    "theme": "modern",
    "progressBars": true,
    "animations": true,
    "colorScheme": "auto"
  },
  "output": {
    "format": "table",
    "color": true,
    "verbose": false
  }
}
```

## 성능 최적화

### 대형 모노레포 구성

수백 개의 패키지가 있는 대형 워크스페이스에 대한 PCU 최적화:

```json {{ title: '.pcurc.json' }}
{
  "advanced": {
    "concurrency": 10,
    "timeout": 120000,
    "retries": 3,
    "cacheResults": true,
    "batchSize": 50
  },
  "performance": {
    "skipUnchanged": true,
    "useCache": true,
    "parallelAnalysis": true
  }
}
```

### 선택적 처리

```bash
# 마지막 커밋 이후 변경된 패키지만 처리
pcu -c --changed-only

# 30일 동안 수정되지 않은 패키지 건너뛰기
pcu -c --skip-stale --stale-days 30

# 더 빠른 결과를 위한 병렬 처리
pcu -c --concurrency 15
```

## 마이그레이션 예시

### npm-check-updates에서

`ncu`에서 PCU로 마이그레이션:

<CodeGroup>

```bash {{ title: 'npm-check-updates 동등물' }}
# 기존 ncu 명령 → 새로운 PCU 동등물

# ncu
pcu -c

# ncu -u
pcu -u

# ncu --target minor
pcu -u --target minor

# ncu --interactive
pcu -i

# ncu --packageFile package.json
pcu -w ./path/to/workspace
```

```json {{ title: '마이그레이션 구성' }}
{
  "migration": {
    "from": "npm-check-updates",
    "preserveRanges": true,
    "convertToCatalog": true
  },
  "defaults": {
    "target": "minor",
    "interactive": false
  }
}
```

</CodeGroup>

### pnpm 카탈로그로 변환

기존 워크스페이스를 pnpm 카탈로그 사용으로 변환:

```bash
# 현재 종속성 분석
pcu workspace --stats

# 카탈로그 구조 초기화
pcu init --create-workspace

# 종속성을 카탈로그 참조로 변환
pcu convert --to-catalog --dry-run
pcu convert --to-catalog --backup
```

---

## 마이그레이션 가이드

### npm-check-updates에서 마이그레이션

`npm-check-updates`에서 pnpm 카탈로그 관리를 위한 PCU로 원활하게 전환:

<CodeGroup>

```bash {{ title: '이전: npm-check-updates' }}
# ncu를 사용한 기존 워크플로우
ncu --upgrade --packageFile package.json
ncu --upgrade --packageFile packages/*/package.json
npm install
```

```bash {{ title: '이후: PCU' }}
# PCU를 사용한 새로운 워크플로우
pcu -c                    # 카탈로그 업데이트 확인
pcu -i                    # 대화형 카탈로그 업데이트
# pnpm이 카탈로그를 사용하는 모든 패키지를 자동으로 업데이트
```

</CodeGroup>

#### 마이그레이션 단계

1. **비교를 위해 ncu와 함께 PCU를 임시로 설치**
2. **PCU 구성 초기화**:
   ```bash
   pcu init --template standard
   ```
3. **동등한 기능을 보장하기 위해 출력 비교**:
   ```bash
   ncu --format minimal > ncu-output.txt
   pcu -c --format minimal > pcu-output.txt
   diff ncu-output.txt pcu-output.txt
   ```
4. **ncu 구성에서 패키지 규칙 마이그레이션**
5. **PCU에 익숙해지면 ncu 제거**

### Dependabot에서 마이그레이션

더 세밀한 제어를 위해 Dependabot을 PCU로 교체:

<CodeGroup>

```yaml {{ title: '이전: .github/dependabot.yml' }}
version: 2
updates:
  - package-ecosystem: 'npm'
    directory: '/'
    schedule:
      interval: 'weekly'
    open-pull-requests-limit: 5
```

```yaml {{ title: '이후: .github/workflows/pcu-updates.yml' }}
name: PCU Dependency Updates
on:
  schedule:
    - cron: '0 9 * * MON' # 매주 월요일 오전 9시
  workflow_dispatch:

jobs:
  update-dependencies:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: pnpm/action-setup@v2
        with:
          version: latest
      - uses: actions/setup-node@v4
        with:
          node-version: '18'
          cache: 'pnpm'

      - run: pnpm install
      - run: pnpm add -g pnpm-catalog-updates

      # 업데이트 확인
      - name: 업데이트 확인
        run: pcu -c --format json > updates.json

      # 업데이트가 있으면 PR 생성
      - name: PR 생성
        run: |
          if [ -s updates.json ]; then
            pcu -u --target minor --create-backup
            git add .
            git commit -m "chore: update dependencies via PCU"
            # GitHub CLI를 사용하여 PR 생성
            gh pr create --title "🔄 주간 종속성 업데이트" --body "PCU를 통한 자동화된 업데이트"
          fi
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
```

</CodeGroup>

### Renovate에서 마이그레이션

고급 구성으로 Renovate에서 PCU로 전환:

#### 주요 차이점

| 기능         | Renovate      | PCU                    |
| ------------ | ------------- | ---------------------- |
| **범위**     | 개별 패키지   | 카탈로그 수준 업데이트 |
| **구성**     | renovate.json | .pcurc.json            |
| **UI**       | 웹 대시보드   | 터미널 + CI 통합       |
| **모노레포** | 복잡한 구성   | 내장 워크스페이스 지원 |

#### 마이그레이션 구성

<CodeGroup>

```json {{ title: '이전: renovate.json' }}
{
  "extends": ["config:base"],
  "schedule": ["before 5am on monday"],
  "packageRules": [
    {
      "matchPackageNames": ["react", "react-dom"],
      "groupName": "React"
    }
  ]
}
```

```json {{ title: '이후: .pcurc.json' }}
{
  "packageRules": [
    {
      "name": "React 생태계",
      "patterns": ["react", "react-dom", "@types/react*"],
      "target": "minor",
      "groupUpdate": true,
      "requireConfirmation": true
    }
  ],
  "monorepo": {
    "syncVersions": {
      "enabled": true,
      "groups": [
        {
          "name": "react-ecosystem",
          "packages": ["react", "react-dom", "@types/react"],
          "strategy": "exact"
        }
      ]
    }
  }
}
```

</CodeGroup>

---

## CI/CD 워크플로우 통합

### GitHub Actions 통합

자동화된 종속성 관리를 위한 완전한 GitHub Actions 설정:

<CodeGroup>

```yaml {{ title: '기본 종속성 확인' }}
name: Dependency Check

on:
  push:
    branches: [main]
  pull_request:
    branches: [main]

jobs:
  dependency-check:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v4
      - uses: pnpm/action-setup@v2
        with:
          version: latest
      - uses: actions/setup-node@v4
        with:
          node-version: '18'
          cache: 'pnpm'

      - name: 종속성 설치
        run: pnpm install

      - name: PCU 설치
        run: pnpm add -g pnpm-catalog-updates

      - name: 업데이트 확인
        run: pcu -c --format table

      - name: 보안 스캔
        run: pcu security --severity high
```

```yaml {{ title: '고급 업데이트 워크플로우' }}
name: Advanced PCU Workflow

on:
  schedule:
    - cron: '0 8 * * MON' # 월요일 오전 8시
  workflow_dispatch:
    inputs:
      update_target:
        description: '업데이트 대상'
        required: false
        default: 'minor'
        type: choice
        options:
          - patch
          - minor
          - latest

jobs:
  update-dependencies:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v4
        with:
          token: ${{ secrets.GITHUB_TOKEN }}

      - uses: pnpm/action-setup@v2
        with:
          version: latest

      - uses: actions/setup-node@v4
        with:
          node-version: '18'
          cache: 'pnpm'

      - name: 종속성 설치
        run: pnpm install

      - name: PCU 설치
        run: pnpm add -g pnpm-catalog-updates

      - name: Git 구성
        run: |
          git config user.name "PCU Bot"
          git config user.email "pcu-bot@github-actions.com"

      - name: 업데이트 확인
        id: check-updates
        run: |
          pcu -c --format json > updates.json
          if [ -s updates.json ]; then
            echo "updates-available=true" >> $GITHUB_OUTPUT
          else
            echo "updates-available=false" >> $GITHUB_OUTPUT
          fi

      - name: 보안 스캔
        if: steps.check-updates.outputs.updates-available == 'true'
        run: |
          pcu security --format json --severity critical > security.json
          if [ -s security.json ] && [ "$(cat security.json | jq length)" -gt 0 ]; then
            echo "❌ 치명적인 보안 취약점 발견"
            exit 1
          fi

      - name: 종속성 업데이트
        if: steps.check-updates.outputs.updates-available == 'true'
        run: |
          pcu -u --target ${{ github.event.inputs.update_target || 'minor' }} --create-backup

      - name: 테스트 실행
        if: steps.check-updates.outputs.updates-available == 'true'
        run: pnpm test

      - name: Pull Request 생성
        if: steps.check-updates.outputs.updates-available == 'true'
        uses: peter-evans/create-pull-request@v5
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          commit-message: 'chore: 카탈로그 종속성 업데이트'
          title: "🔄 주간 종속성 업데이트 (${{ github.event.inputs.update_target || 'minor' }})"
          body: |
            ## 📦 종속성 업데이트

            이 PR은 PCU에서 생성된 카탈로그 종속성 업데이트를 포함합니다.

            ### 변경 사항
            - 대상: `${{ github.event.inputs.update_target || 'minor' }}`
            - 보안 스캔: ✅ 통과
            - 테스트: ✅ 통과

            ### 검토 체크리스트
            - [ ] Breaking Changes 검토
            - [ ] 중요한 사용자 경로 테스트
            - [ ] 필요시 문서 업데이트

            ---
            *PCU Bot에서 생성됨 🤖*
          branch: pcu/weekly-updates
          labels: |
            dependencies
            automated
```

</CodeGroup>

### GitLab CI 통합

PCU 종속성 관리를 위한 GitLab CI 파이프라인:

<CodeGroup>

```yaml {{ title: '.gitlab-ci.yml' }}
stages:
  - check
  - security
  - update

variables:
  PNPM_CACHE_FOLDER: .pnpm-store

cache:
  key: ${CI_COMMIT_REF_SLUG}
  paths:
    - .pnpm-store

before_script:
  - corepack enable
  - pnpm config set store-dir $PNPM_CACHE_FOLDER
  - pnpm install
  - pnpm add -g pnpm-catalog-updates

dependency-check:
  stage: check
  script:
    - pcu -c --format table
    - pcu workspace --validate
  artifacts:
    reports:
      junit: dependency-report.xml
  only:
    - merge_requests
    - main

security-scan:
  stage: security
  script:
    - pcu security --format json --severity moderate > security.json
    - |
      if [ -s security.json ] && [ "$(cat security.json | jq length)" -gt 0 ]; then
        echo "보안 취약점이 발견되었습니다:"
        cat security.json | jq '.'
        exit 1
      fi
  artifacts:
    reports:
      security: security.json
  only:
    - merge_requests
    - main

weekly-update:
  stage: update
  script:
    - git config user.name "PCU Bot"
    - git config user.email "pcu@gitlab.com"
    - pcu -c --format json > updates.json
    - |
      if [ -s updates.json ]; then
        pcu -u --target minor --create-backup
        git add .
        git commit -m "chore: 주간 종속성 업데이트"
        git push origin HEAD:pcu/weekly-updates
      fi
  only:
    - schedules
  variables:
    GIT_STRATEGY: clone
```

</CodeGroup>

### Jenkins 파이프라인 통합

기업 종속성 관리를 위한 Jenkins 파이프라인:

<CodeGroup>

```groovy {{ title: 'Jenkinsfile' }}
pipeline {
    agent any

    tools {
        nodejs '18'
    }

    environment {
        PNPM_HOME = "${env.WORKSPACE}/.pnpm"
        PATH = "${env.PNPM_HOME}:${env.PATH}"
    }

    stages {
        stage('설정') {
            steps {
                sh 'corepack enable'
                sh 'pnpm install'
                sh 'pnpm add -g pnpm-catalog-updates'
            }
        }

        stage('종속성 확인') {
            steps {
                sh 'pcu -c --format json > dependency-check.json'

                script {
                    def updates = readJSON file: 'dependency-check.json'
                    if (updates.size() > 0) {
                        env.HAS_UPDATES = 'true'
                        echo "업데이트할 패키지 ${updates.size()}개 발견"
                    } else {
                        env.HAS_UPDATES = 'false'
                        echo "사용 가능한 업데이트 없음"
                    }
                }
            }
            post {
                always {
                    archiveArtifacts artifacts: 'dependency-check.json'
                }
            }
        }

        stage('보안 스캔') {
            when {
                environment name: 'HAS_UPDATES', value: 'true'
            }
            steps {
                sh 'pcu security --format json --severity high > security-report.json'

                script {
                    def securityReport = readJSON file: 'security-report.json'
                    if (securityReport.vulnerabilities && securityReport.vulnerabilities.size() > 0) {
                        error "치명적인 보안 취약점 발견: ${securityReport.vulnerabilities.size()}개"
                    }
                }
            }
            post {
                always {
                    publishHTML([
                        allowMissing: false,
                        alwaysLinkToLastBuild: true,
                        keepAll: true,
                        reportDir: '.',
                        reportFiles: 'security-report.json',
                        reportName: 'Security Report'
                    ])
                }
            }
        }

        stage('종속성 업데이트') {
            when {
                allOf {
                    environment name: 'HAS_UPDATES', value: 'true'
                    branch 'main'
                }
            }
            steps {
                sh 'pcu -u --target minor --create-backup'
                sh 'pnpm test'

                script {
                    sh '''
                        git config user.name "Jenkins PCU"
                        git config user.email "jenkins@company.com"
                        git add .
                        git commit -m "chore: 자동화된 종속성 업데이트 [skip ci]"
                    '''

                    // 병합 요청(GitLab) 또는 풀 리퀘스트(GitHub) 생성
                    sh '''
                        git push origin HEAD:pcu/automated-updates-${BUILD_NUMBER}
                    '''
                }
            }
        }
    }

    post {
        always {
            cleanWs()
        }

        success {
            echo 'PCU 종속성 확인이 성공적으로 완료되었습니다'
        }

        failure {
            emailext (
                subject: "PCU 종속성 확인 실패 - ${env.JOB_NAME} - ${env.BUILD_NUMBER}",
                body: "종속성 확인이 실패했습니다. 콘솔 출력을 검토해 주세요.",
                to: "${env.CHANGE_AUTHOR_EMAIL}"
            )
        }
    }
}
```

</CodeGroup>

### Azure DevOps 파이프라인

PCU 통합을 위한 Azure DevOps 파이프라인:

<CodeGroup>

```yaml {{ title: 'azure-pipelines.yml' }}
trigger:
  branches:
    include:
      - main
      - develop

schedules:
  - cron: '0 8 * * 1'
    displayName: 주간 종속성 확인
    branches:
      include:
        - main
    always: true

pool:
  vmImage: 'ubuntu-latest'

variables:
  PNPM_CACHE_FOLDER: $(Pipeline.Workspace)/.pnpm-store

stages:
  - stage: DependencyCheck
    displayName: '종속성 확인'
    jobs:
      - job: CheckUpdates
        displayName: '업데이트 확인'
        steps:
          - task: Cache@2
            inputs:
              key: 'pnpm | "$(Agent.OS)" | pnpm-lock.yaml'
              restoreKeys: |
                pnpm | "$(Agent.OS)"
              path: $(PNPM_CACHE_FOLDER)
            displayName: pnpm 캐시

          - script: |
              corepack enable
              pnpm config set store-dir $(PNPM_CACHE_FOLDER)
              pnpm install
              pnpm add -g pnpm-catalog-updates
            displayName: 'PNPM과 PCU 설정'

          - script: |
              pcu -c --format json > $(Agent.TempDirectory)/updates.json
              pcu workspace --validate
            displayName: '종속성 확인'

          - script: |
              pcu security --format json --severity moderate > $(Agent.TempDirectory)/security.json
            displayName: '보안 스캔'

          - task: PublishTestResults@2
            condition: always()
            inputs:
              testResultsFormat: 'JUnit'
              testResultsFiles: '**/*-results.xml'
              failTaskOnFailedTests: true
            displayName: '보안 결과 게시'

          - task: PublishBuildArtifacts@1
            inputs:
              pathToPublish: '$(Agent.TempDirectory)'
              artifactName: 'dependency-reports'
            displayName: '아티팩트 게시'

  - stage: UpdateDependencies
    displayName: '종속성 업데이트'
    condition: and(succeeded(), or(eq(variables['Build.Reason'], 'Schedule'), eq(variables['Build.Reason'], 'Manual')))
    jobs:
      - job: UpdateCatalog
        displayName: '카탈로그 종속성 업데이트'
        steps:
          - checkout: self
            persistCredentials: true

          - script: |
              corepack enable
              pnpm install
              pnpm add -g pnpm-catalog-updates
            displayName: '환경 설정'

          - script: |
              git config user.name "Azure DevOps PCU"
              git config user.email "devops@company.com"

              pcu -u --target minor --create-backup

              if [ -n "$(git status --porcelain)" ]; then
                git add .
                git commit -m "chore: 카탈로그 종속성 업데이트 [skip ci]"
                git push origin HEAD:refs/heads/pcu/automated-updates-$(Build.BuildNumber)
              fi
            displayName: '종속성 업데이트'

          - script: pnpm test
            displayName: '테스트 실행'
```

</CodeGroup>

### Docker 통합

일관된 CI/CD 환경을 위한 컨테이너화된 PCU:

<CodeGroup>

```dockerfile {{ title: 'Dockerfile.pcu' }}
FROM node:18-alpine

# pnpm과 PCU 설치
RUN corepack enable
RUN pnpm add -g pnpm-catalog-updates

# 작업 디렉토리 설정
WORKDIR /workspace

# 패키지 파일 복사
COPY package.json pnpm-lock.yaml pnpm-workspace.yaml .pcurc.json ./

# 종속성 설치
RUN pnpm install --frozen-lockfile

# 엔트리포인트 설정
ENTRYPOINT ["pcu"]
CMD ["--help"]
```

```yaml {{ title: 'docker-compose.yml' }}
version: '3.8'

services:
  pcu-check:
    build:
      context: .
      dockerfile: Dockerfile.pcu
    volumes:
      - .:/workspace
      - pnpm-store:/workspace/.pnpm-store
    command: ['-c', '--format', 'table']

  pcu-security:
    build:
      context: .
      dockerfile: Dockerfile.pcu
    volumes:
      - .:/workspace
      - pnpm-store:/workspace/.pnpm-store
    command: ['security', '--format', 'json']

  pcu-update:
    build:
      context: .
      dockerfile: Dockerfile.pcu
    volumes:
      - .:/workspace
      - pnpm-store:/workspace/.pnpm-store
    command: ['-u', '--target', 'minor', '--dry-run']

volumes:
  pnpm-store:
```

```bash {{ title: '사용 예시' }}
# PCU 컨테이너 빌드
docker build -t pcu:latest -f Dockerfile.pcu .

# 업데이트 확인
docker run --rm -v $(pwd):/workspace pcu:latest -c

# 대화형 업데이트
docker run --rm -it -v $(pwd):/workspace pcu:latest -i

# CI에서 보안 스캔
docker-compose run --rm pcu-security > security-report.json
```

</CodeGroup>

---

## 기업 워크플로우

### 다중 환경 관리

개발, 스테이징, 프로덕션 환경에 걸친 종속성 관리:

<CodeGroup>

```json {{ title: '.pcurc.development.json' }}
{
  "defaults": {
    "target": "latest",
    "createBackup": true,
    "interactive": true
  },
  "ui": {
    "theme": "modern",
    "progressBarStyle": "fancy"
  },
  "packageRules": [
    {
      "patterns": ["*"],
      "target": "latest",
      "requireConfirmation": false
    }
  ]
}
```

```json {{ title: '.pcurc.production.json' }}
{
  "defaults": {
    "target": "patch",
    "createBackup": true,
    "interactive": false
  },
  "ui": {
    "theme": "minimal",
    "progressBarStyle": "minimal"
  },
  "packageRules": [
    {
      "patterns": ["*"],
      "target": "patch",
      "requireConfirmation": true
    }
  ],
  "security": {
    "autoFixVulnerabilities": true,
    "severityThreshold": "high"
  }
}
```

</CodeGroup>

### 승인 워크플로우

중요한 업데이트에 대한 승인 워크플로우 구현:

```bash
# 프로덕션 업데이트 워크플로우
pcu -c --config .pcurc.production.json > updates-pending.json

# 승인 요청 생성
pcu analyze default typescript --format json > impact-analysis.json

# 승인 후 업데이트 적용
pcu -u --config .pcurc.production.json --create-backup

# 문제가 발견되면 롤백
git checkout HEAD~1 -- package.json pnpm-lock.yaml
pnpm install
```
