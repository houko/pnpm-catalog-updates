export const metadata = {
  title: 'Soluci贸n de Problemas',
  description:
    'Problemas comunes y soluciones al usar pnpm-catalog-updates. Mensajes de error, consejos de depuraci贸n y gu铆as de soluci贸n de problemas.',
};

# Soluci贸n de Problemas

Problemas comunes y soluciones para ayudarte a resolver problemas con PCU. Encuentra respuestas a errores frecuentemente encontrados y consejos de depuraci贸n. {{ className: 'lead' }}

## Errores Comunes

### Workspace No Encontrado

**Mensaje de Error:**

```
Error: No pnpm workspace found in the current directory
```

**Causa:** PCU no pudo localizar un archivo `pnpm-workspace.yaml` o detectar una estructura v谩lida de workspace de pnpm.

**Soluciones:**

<CodeGroup>

```bash {{ title: 'Inicializar Workspace' }}
# Crear un nuevo workspace de pnpm
pcu init

# O crear manualmente pnpm-workspace.yaml
echo "packages:
  - 'packages/*'" > pnpm-workspace.yaml
```

```bash {{ title: 'Especificar Ruta de Workspace' }}
# Ejecutar PCU desde la ra铆z del workspace
cd /ruta/a/workspace/raiz
pcu -c

# O especificar directorio del workspace
pcu -c --workspace /ruta/a/workspace
```

</CodeGroup>

---

### Sin Dependencias de Cat谩logo

**Mensaje de Error:**

```
No catalog dependencies found in workspace
```

**Causa:** Tu workspace no usa dependencias de cat谩logo de pnpm.

**Soluciones:**

<CodeGroup>

```yaml {{ title: 'Agregar Cat谩logo a pnpm-workspace.yaml' }}
packages:
  - 'packages/*'

catalog:
  react: ^18.2.0
  typescript: ^5.0.0
  lodash: ^4.17.21
```

```json {{ title: 'Usar Cat谩logo en package.json' }}
{
  "name": "my-package",
  "dependencies": {
    "react": "catalog:",
    "typescript": "catalog:",
    "lodash": "catalog:"
  }
}
```

</CodeGroup>

---

### Problemas de Acceso al Registro

**Mensaje de Error:**

```
Error: getaddrinfo ENOTFOUND registry.npmjs.org
```

**Causa:** Problemas de conectividad de red o problemas de acceso al registro.

**Soluciones:**

<CodeGroup>

```bash {{ title: 'Soluci贸n de Problemas de Red' }}
# Verificar conectividad de red
ping registry.npmjs.org

# Probar con timeout aumentado
pcu -c --timeout 60000

# Reducir solicitudes concurrentes
pcu -c --concurrency 2
```

```ini {{ title: 'Configurar Registro (.npmrc)' }}
# Usar diferente registro
registry=https://registry.npmjs.org/

# Para redes corporativas
registry=https://your-corporate-registry.com/
strict-ssl=false
```

</CodeGroup>

---

### Errores de Autenticaci贸n

**Mensaje de Error:**

```
Error: 401 Unauthorized - authentication required
```

**Causa:** Tokens de autenticaci贸n faltantes o inv谩lidos para registros privados.

**Soluciones:**

<CodeGroup>

```ini {{ title: 'Configurar Autenticaci贸n (.npmrc)' }}
@myorg:registry=https://npm.private-registry.com/
//npm.private-registry.com/:_authToken=${NPM_TOKEN}

# O usar autenticaci贸n legacy
//npm.private-registry.com/:username=myuser
//npm.private-registry.com/:_password=base64password
//npm.private-registry.com/:email=my.email@example.com
```

```bash {{ title: 'Establecer Variable de Entorno' }}
export NPM_TOKEN=your_token_here
pcu -c
```

</CodeGroup>

---

### Errores del Archivo de Configuraci贸n

**Mensaje de Error:**

```
Error: Invalid configuration in .pcurc.json
```

**Causa:** JSON mal formado u opciones de configuraci贸n inv谩lidas.

**Soluciones:**

<CodeGroup>

```bash {{ title: 'Validar Configuraci贸n' }}
# Verificar sintaxis JSON
node -e "console.log(JSON.parse(require('fs').readFileSync('.pcurc.json', 'utf8')))"

# Regenerar configuraci贸n
mv .pcurc.json .pcurc.json.backup
pcu init --force
```

```json {{ title: 'Configuraci贸n V谩lida M铆nima' }}
{
  "defaults": {
    "target": "latest"
  },
  "output": {
    "format": "table"
  }
}
```

</CodeGroup>

## Depuraci贸n

### Habilitar Logging Detallado

<CodeGroup>

```bash {{ title: 'Salida Detallada' }}
# Habilitar logging detallado
pcu -c --verbose

# Modo debug con variable de entorno
DEBUG=pcu:* pcu -c

# M贸dulos de debug espec铆ficos
DEBUG=pcu:core,pcu:registry pcu -c
```

```bash {{ title: 'Salida a Archivo' }}
# Guardar salida de debug
pcu -c --verbose > debug.log 2>&1

# Verificar el archivo de log
cat debug.log | grep -i error
```

</CodeGroup>

### Validaci贸n de Workspace

<CodeGroup>

```bash {{ title: 'Validar Workspace' }}
# Verificar configuraci贸n del workspace
pcu -s --validate

# Obtener informaci贸n detallada del workspace
pcu -s --stats --verbose
```

```bash {{ title: 'Validaci贸n Manual' }}
# Verificar que pnpm-workspace.yaml existe
ls -la pnpm-workspace.yaml

# Verificar sintaxis del cat谩logo
pnpm exec -- pnpm list --depth=0
```

</CodeGroup>

## Problemas de Rendimiento

### Solicitudes de Red Lentas

**S铆ntomas:** PCU toma mucho tiempo en verificar actualizaciones

**Soluciones:**

<CodeGroup>

```json {{ title: 'Optimizar Configuraci贸n' }}
{
  "advanced": {
    "concurrency": 3,
    "timeout": 30000,
    "retries": 2,
    "cacheValidityMinutes": 120
  }
}
```

```bash {{ title: 'Gesti贸n de Cach茅' }}
# Limpiar cach茅 si est谩 obsoleto
rm -rf ~/.pcu/cache

# Deshabilitar cach茅 para depuraci贸n
pcu -c --no-cache
```

</CodeGroup>

### Alto Uso de Memoria

**S铆ntomas:** PCU consume memoria excesiva con workspaces grandes

**Soluciones:**

<CodeGroup>

```json {{ title: 'Optimizaci贸n de Memoria' }}
{
  "advanced": {
    "concurrency": 2,
    "batchSize": 10
  }
}
```

```bash {{ title: 'Gesti贸n de Procesos' }}
# Monitorear uso de memoria
top -p $(pgrep node)

# Usar flags de memoria de Node.js
node --max-old-space-size=4096 $(which pcu) -c
```

</CodeGroup>

## Problemas de Entorno

### Compatibilidad de Versi贸n de Node.js

**Mensaje de Error:**

```
Error: Unsupported Node.js version
```

**Soluciones:**

<CodeGroup>

```bash {{ title: 'Verificar Versi贸n' }}
node --version  # Debe ser >= 18.0.0

# Instalar versi贸n compatible
nvm install 20
nvm use 20
```

```bash {{ title: 'Actualizar Node.js' }}
# Usando nvm
nvm install --lts
nvm use --lts

# Verificar instalaci贸n
node --version
npm --version
```

</CodeGroup>

### Problemas de Versi贸n de pnpm

**Mensaje de Error:**

```
Error: pnpm command not found
```

**Soluciones:**

<CodeGroup>

```bash {{ title: 'Instalar pnpm' }}
# Instalar 煤ltima versi贸n de pnpm
npm install -g pnpm@latest

# Verificar instalaci贸n
pnpm --version  # Debe ser >= 8.0.0
```

```bash {{ title: 'Instalaci贸n Alternativa' }}
# Usando Corepack (recomendado)
corepack enable
corepack prepare pnpm@latest --activate

# Descarga directa
curl -fsSL https://get.pnpm.io/install.sh | sh -
```

</CodeGroup>

## Problemas Espec铆ficos de Windows

### Problemas de Separador de Rutas

**Mensaje de Error:**

```
Error: Cannot resolve workspace path
```

**Soluciones:**

<CodeGroup>

```bash {{ title: 'Usar Barras Inclinadas' }}
# Usar barras inclinadas en rutas
pcu -c --workspace ./my/workspace

# O usar PowerShell
pwsh -c "pcu -c"
```

```json {{ title: 'Configuraci贸n de Windows' }}
{
  "workspace": {
    "pathSeparator": "/"
  }
}
```

</CodeGroup>

### Errores de Permisos

**Mensaje de Error:**

```
Error: EPERM: operation not permitted
```

**Soluciones:**

<CodeGroup>

```cmd {{ title: 'Ejecutar como Administrador' }}
# Ejecutar Command Prompt como Administrador
runas /user:Administrator cmd

# O usar PowerShell como Administrador
Start-Process powershell -Verb RunAs
```

```bash {{ title: 'Corregir Permisos' }}
# Corregir permisos de npm
npm config set cache ~/.npm-cache
npm config set prefix ~/npm-global
```

</CodeGroup>

## Obtener Ayuda

### Informaci贸n de Diagn贸stico

Al reportar problemas, incluye esta informaci贸n de diagn贸stico:

<CodeGroup>

```bash {{ title: 'Informaci贸n del Sistema' }}
# Versi贸n de PCU
pcu --version

# Versiones de Node.js y pnpm
node --version
pnpm --version

# Sistema operativo
uname -a  # Linux/macOS
systeminfo  # Windows
```

```bash {{ title: 'Informaci贸n de Configuraci贸n' }}
# Mostrar configuraci贸n actual
cat .pcurc.json

# Validaci贸n del workspace
pcu -s --validate --verbose

# Salida de debug
DEBUG=pcu:* pcu -c --verbose
```

</CodeGroup>

### Canales de Soporte

-  **Reportes de Bugs**: [GitHub Issues](https://github.com/houko/pnpm-catalog-updates/issues)
-  **Preguntas**: [GitHub Discussions](https://github.com/houko/pnpm-catalog-updates/discussions)
-  **Documentaci贸n**: Consulta esta documentaci贸n para gu铆as detalladas
-  **Solicitudes de Caracter铆sticas**: Usa GitHub Issues con la etiqueta enhancement

### Plantilla de Issues

Al reportar bugs, por favor incluye:

1. **Versi贸n de PCU** y **comando usado**
2. **Mensaje de error** (salida completa con `--verbose`)
3. **Entorno** (SO, versiones de Node.js, pnpm)
4. **Estructura del workspace** (pnpm-workspace.yaml, package.json)
5. **Configuraci贸n** (.pcurc.json, .npmrc si es relevante)
6. **Pasos para reproducir** el problema
7. **Comportamiento esperado vs actual**

## Problemas de Comando de Seguridad

### Problemas de Integraci贸n con Snyk

**Mensaje de Error:**

```
Error: Snyk CLI not found
```

**Causa:** Snyk CLI no est谩 instalado pero se usa el flag `--snyk`.

**Soluciones:**

<CodeGroup>

```bash {{ title: 'Instalar Snyk CLI' }}
# Instalar Snyk globalmente
npm install -g snyk

# Autenticar con Snyk
snyk auth

# Probar instalaci贸n de Snyk
snyk --version
```

```bash {{ title: 'Ejecutar sin Snyk' }}
# Usar solo npm audit (por defecto)
pcu security

# Deshabilitar Snyk expl铆citamente
pcu security --no-snyk
```

</CodeGroup>

### Fallos de Correcci贸n de Seguridad

**Mensaje de Error:**

```
Error: Unable to automatically fix vulnerabilities
```

**Causa:** Algunas vulnerabilidades requieren intervenci贸n manual o actualizaciones de versi贸n mayor.

**Soluciones:**

<CodeGroup>

```bash {{ title: 'Correcciones Manuales de Seguridad' }}
# Revisar vulnerabilidades primero
pcu security --format json > security.json

# Intentar correcci贸n automatizada
pcu security --fix-vulns

# Actualizaciones manuales de paquetes si es necesario
pcu -u --include "vulnerable-package"
```

```bash {{ title: 'Forzar Actualizaciones Mayores para Seguridad' }}
# Permitir actualizaciones mayores para correcciones de seguridad
pcu security --fix-vulns --allow-major-security

# Verificar impacto antes de aplicar
pcu -a default vulnerable-package
```

</CodeGroup>

---

### Problemas de Comando de Tema

**Mensaje de Error:**

```
Error: Theme 'custom-theme' not found
```

**Causa:** Intentando establecer un tema que no existe.

**Soluciones:**

<CodeGroup>

```bash {{ title: 'Listar Temas Disponibles' }}
# Ver todos los temas disponibles
pcu theme --list

# Usar selecci贸n interactiva de tema
pcu theme --interactive
```

```bash {{ title: 'Resetear al Tema Por Defecto' }}
# Resetear al tema por defecto
pcu theme --set default

# O eliminar configuraci贸n de tema
rm ~/.pcu/theme.json
```

</CodeGroup>

---

### Problemas de Modo Interactivo

**Mensaje de Error:**

```
Error: Interactive mode not supported in this environment
```

**Causa:** Ejecutando PCU en un entorno no interactivo (CI, pipe, etc.).

**Soluciones:**

<CodeGroup>

```bash {{ title: 'Alternativas No Interactivas' }}
# Usar dry-run para previsualizar cambios
pcu -u --dry-run

# Usar targets espec铆ficos en lugar de interactivo
pcu -u --target minor

# Usar archivo de configuraci贸n para automatizaci贸n
pcu -u --config .pcurc.json
```

```bash {{ title: 'Forzar Modo Interactivo' }}
# Forzar TTY para modo interactivo
script -c "pcu -i" /dev/null

# Usar terminal espec铆fica
TERM=xterm pcu -i
```

</CodeGroup>

## Problemas Espec铆ficos de Comandos

### Problemas del Comando Analyze

**Mensaje de Error:**

```
Error: Package 'react' not found in catalog 'nonexistent'
```

**Causa:** Analizando un paquete que no existe en el cat谩logo especificado.

**Soluciones:**

<CodeGroup>

```bash {{ title: 'Verificar Cat谩logos Disponibles' }}
# Listar cat谩logos del workspace
pcu workspace --stats

# Verificar si el paquete existe en el cat谩logo por defecto
pcu -a default react

# Listar todos los paquetes en el cat谩logo
pcu -c --catalog specific-catalog
```

```bash {{ title: 'Verificar Nombres de Paquetes' }}
# Buscar nombres de paquetes similares
pcu -c --include "*react*"

# Verificar que el paquete existe en el registro
npm view react versions --json
```

</CodeGroup>

### Fallos del Comando Update

**Mensaje de Error:**

```
Error: Failed to update package.json files
```

**Causa:** Problemas de permisos de archivos o problemas de estructura del workspace.

**Soluciones:**

<CodeGroup>

```bash {{ title: 'Verificar Permisos' }}
# Verificar permisos de archivos
ls -la pnpm-workspace.yaml
find packages -name "package.json" -exec ls -la {} \;

# Corregir permisos si es necesario
chmod u+w pnpm-workspace.yaml
chmod u+w packages/*/package.json
```

```bash {{ title: 'Validaci贸n de Workspace' }}
# Validar workspace primero
pcu workspace --validate

# Usar flag de backup para seguridad
pcu -u --create-backup

# Probar con dry-run
pcu -u --dry-run
```

</CodeGroup>

## Depuraci贸n Avanzada

### Investigaci贸n de Memory Leaks

**S铆ntomas:** La memoria del proceso PCU sigue creciendo durante la operaci贸n

**Pasos de Debug:**

<CodeGroup>

```bash {{ title: 'Monitoreo de Memoria' }}
# Monitorear uso de memoria
watch -n 1 'ps aux | grep pcu'

# Usar perfilado de memoria de Node.js
node --inspect $(which pcu) -c

# Habilitar logging de garbage collection
node --trace-gc $(which pcu) -c
```

```bash {{ title: 'Depuraci贸n de Workspace Grande' }}
# Procesar en lotes m谩s peque帽os
pcu -c --batch-size 10

# Reducir concurrencia
pcu -c --concurrency 1

# Habilitar optimizaci贸n de memoria
node --optimize-for-size $(which pcu) -c
```

</CodeGroup>

### Problemas de Respuesta del Registro

**S铆ntomas:** Resultados inconsistentes o errores de timeout

**Pasos de Debug:**

<CodeGroup>

```bash {{ title: 'Depuraci贸n del Registro' }}
# Probar conectividad del registro
curl -I https://registry.npmjs.org/

# Verificar tiempo de respuesta del registro
time npm view react versions

# Usar registros alternativos
npm config set registry https://registry.npmmirror.com/
```

```bash {{ title: 'Diagn贸sticos de Red' }}
# Rastrear solicitudes de red
DEBUG=pcu:registry pcu -c

# Monitorear actividad de red
netstat -an | grep :443

# Probar con diferentes timeouts
pcu -c --timeout 5000
pcu -c --timeout 30000
```

</CodeGroup>

### Problemas de Herencia de Configuraci贸n

**S铆ntomas:** La configuraci贸n no se aplica como se espera

**Pasos de Debug:**

<CodeGroup>

```bash {{ title: 'Resoluci贸n de Configuraci贸n' }}
# Verificar ubicaciones de archivos de configuraci贸n
ls -la .pcurc.json
ls -la ~/.pcurc.json
ls -la ~/.config/pcu/config.json

# Debug de carga de configuraci贸n
DEBUG=pcu:config pcu -c --verbose

# Mostrar configuraci贸n efectiva
pcu config --show-effective
```

```bash {{ title: 'Validaci贸n de Configuraci贸n' }}
# Validar sintaxis de configuraci贸n
node -pe "JSON.parse(require('fs').readFileSync('.pcurc.json'))"

# Probar con configuraci贸n m铆nima
echo '{"defaults":{"target":"latest"}}' > test.pcurc.json
pcu -c --config test.pcurc.json
```

</CodeGroup>
