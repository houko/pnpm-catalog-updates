export const metadata = {
  title: 'Troubleshooting',
  description:
    'Common issues and solutions when using pnpm-catalog-updates. Error messages, debugging tips, and troubleshooting guides.',
};

# Troubleshooting

Common issues and solutions to help you resolve problems with PCU. Find answers to frequently encountered errors and debugging tips. {{ className: 'lead' }}

## Common Errors

### Workspace Not Found

**Error Message:**

```
Error: No pnpm workspace found in the current directory
```

**Cause:** PCU couldn't locate a `pnpm-workspace.yaml` file or detect a valid pnpm workspace structure.

**Solutions:**

<CodeGroup>

```bash {{ title: 'Initialize Workspace' }}
# Create a new pnpm workspace
pcu init

# Or manually create pnpm-workspace.yaml
echo "packages:
  - 'packages/*'" > pnpm-workspace.yaml
```

```bash {{ title: 'Specify Workspace Path' }}
# Run PCU from workspace root
cd /path/to/workspace/root
pcu -c

# Or specify workspace directory
pcu -c --workspace /path/to/workspace
```

</CodeGroup>

---

### No Catalog Dependencies

**Error Message:**

```
No catalog dependencies found in workspace
```

**Cause:** Your workspace doesn't use pnpm catalog dependencies.

**Solutions:**

<CodeGroup>

```yaml {{ title: 'Add Catalog to pnpm-workspace.yaml' }}
packages:
  - 'packages/*'

catalog:
  react: ^18.2.0
  typescript: ^5.0.0
  lodash: ^4.17.21
```

```json {{ title: 'Use Catalog in package.json' }}
{
  "name": "my-package",
  "dependencies": {
    "react": "catalog:",
    "typescript": "catalog:",
    "lodash": "catalog:"
  }
}
```

</CodeGroup>

---

### Registry Access Issues

**Error Message:**

```
Error: getaddrinfo ENOTFOUND registry.npmjs.org
```

**Cause:** Network connectivity issues or registry access problems.

**Solutions:**

<CodeGroup>

```bash {{ title: 'Network Troubleshooting' }}
# Check network connectivity
ping registry.npmjs.org

# Test with increased timeout
pcu -c --timeout 60000

# Reduce concurrent requests
pcu -c --concurrency 2
```

```ini {{ title: 'Configure Registry (.npmrc)' }}
# Use different registry
registry=https://registry.npmjs.org/

# For corporate networks
registry=https://your-corporate-registry.com/
strict-ssl=false
```

</CodeGroup>

---

### Authentication Errors

**Error Message:**

```
Error: 401 Unauthorized - authentication required
```

**Cause:** Missing or invalid authentication tokens for private registries.

**Solutions:**

<CodeGroup>

```ini {{ title: 'Configure Auth (.npmrc)' }}
@myorg:registry=https://npm.private-registry.com/
//npm.private-registry.com/:_authToken=${NPM_TOKEN}

# Or use legacy auth
//npm.private-registry.com/:username=myuser
//npm.private-registry.com/:_password=base64password
//npm.private-registry.com/:email=my.email@example.com
```

```bash {{ title: 'Set Environment Variable' }}
export NPM_TOKEN=your_token_here
pcu -c
```

</CodeGroup>

---

### Configuration File Errors

**Error Message:**

```
Error: Invalid configuration in .pcurc.json
```

**Cause:** Malformed JSON or invalid configuration options.

**Solutions:**

<CodeGroup>

```bash {{ title: 'Validate Configuration' }}
# Check JSON syntax
node -e "console.log(JSON.parse(require('fs').readFileSync('.pcurc.json', 'utf8')))"

# Regenerate configuration
mv .pcurc.json .pcurc.json.backup
pcu init --force
```

```json {{ title: 'Minimal Valid Config' }}
{
  "defaults": {
    "target": "latest"
  },
  "output": {
    "format": "table"
  }
}
```

</CodeGroup>

## Debugging

### Enable Verbose Logging

<CodeGroup>

```bash {{ title: 'Verbose Output' }}
# Enable verbose logging
pcu -c --verbose

# Debug mode with environment variable
DEBUG=pcu:* pcu -c

# Specific debug modules
DEBUG=pcu:core,pcu:registry pcu -c
```

```bash {{ title: 'Output to File' }}
# Save debug output
pcu -c --verbose > debug.log 2>&1

# Check the log file
cat debug.log | grep -i error
```

</CodeGroup>

### Workspace Validation

<CodeGroup>

```bash {{ title: 'Validate Workspace' }}
# Check workspace configuration
pcu -s --validate

# Get detailed workspace info
pcu -s --stats --verbose
```

```bash {{ title: 'Manual Validation' }}
# Check pnpm-workspace.yaml exists
ls -la pnpm-workspace.yaml

# Verify catalog syntax
pnpm exec -- pnpm list --depth=0
```

</CodeGroup>

## Performance Issues

### Slow Network Requests

**Symptoms:** PCU takes a long time to check for updates

**Solutions:**

<CodeGroup>

```json {{ title: 'Optimize Configuration' }}
{
  "advanced": {
    "concurrency": 3,
    "timeout": 30000,
    "retries": 2,
    "cacheValidityMinutes": 120
  }
}
```

```bash {{ title: 'Cache Management' }}
# Clear cache if stale
rm -rf ~/.pcu/cache

# Disable cache for debugging
pcu -c --no-cache
```

</CodeGroup>

### High Memory Usage

**Symptoms:** PCU consumes excessive memory with large workspaces

**Solutions:**

<CodeGroup>

```json {{ title: 'Memory Optimization' }}
{
  "advanced": {
    "concurrency": 2,
    "batchSize": 10
  }
}
```

```bash {{ title: 'Process Management' }}
# Monitor memory usage
top -p $(pgrep node)

# Use Node.js memory flags
node --max-old-space-size=4096 $(which pcu) -c
```

</CodeGroup>

## Environment Issues

### Node.js Version Compatibility

**Error Message:**

```
Error: Unsupported Node.js version
```

**Solutions:**

<CodeGroup>

```bash {{ title: 'Check Version' }}
node --version  # Should be >= 18.0.0

# Install compatible version
nvm install 20
nvm use 20
```

```bash {{ title: 'Update Node.js' }}
# Using nvm
nvm install --lts
nvm use --lts

# Verify installation
node --version
npm --version
```

</CodeGroup>

### pnpm Version Issues

**Error Message:**

```
Error: pnpm command not found
```

**Solutions:**

<CodeGroup>

```bash {{ title: 'Install pnpm' }}
# Install latest pnpm
npm install -g pnpm@latest

# Verify installation
pnpm --version  # Should be >= 8.0.0
```

```bash {{ title: 'Alternative Installation' }}
# Using Corepack (recommended)
corepack enable
corepack prepare pnpm@latest --activate

# Direct download
curl -fsSL https://get.pnpm.io/install.sh | sh -
```

</CodeGroup>

## Windows-Specific Issues

### Path Separator Issues

**Error Message:**

```
Error: Cannot resolve workspace path
```

**Solutions:**

<CodeGroup>

```bash {{ title: 'Use Forward Slashes' }}
# Use forward slashes in paths
pcu -c --workspace ./my/workspace

# Or use PowerShell
pwsh -c "pcu -c"
```

```json {{ title: 'Windows Configuration' }}
{
  "workspace": {
    "pathSeparator": "/"
  }
}
```

</CodeGroup>

### Permission Errors

**Error Message:**

```
Error: EPERM: operation not permitted
```

**Solutions:**

<CodeGroup>

```cmd {{ title: 'Run as Administrator' }}
# Run Command Prompt as Administrator
runas /user:Administrator cmd

# Or use PowerShell as Administrator
Start-Process powershell -Verb RunAs
```

```bash {{ title: 'Fix Permissions' }}
# Fix npm permissions
npm config set cache ~/.npm-cache
npm config set prefix ~/npm-global
```

</CodeGroup>

## Getting Help

### Diagnostic Information

When reporting issues, include this diagnostic information:

<CodeGroup>

```bash {{ title: 'System Info' }}
# PCU version
pcu --version

# Node.js and pnpm versions
node --version
pnpm --version

# Operating system
uname -a  # Linux/macOS
systeminfo  # Windows
```

```bash {{ title: 'Configuration Info' }}
# Show current configuration
cat .pcurc.json

# Workspace validation
pcu -s --validate --verbose

# Debug output
DEBUG=pcu:* pcu -c --verbose
```

</CodeGroup>

### Support Channels

- üêõ **Bug Reports**: [GitHub Issues](https://github.com/houko/pnpm-catalog-updates/issues)
- üí¨ **Questions**: [GitHub Discussions](https://github.com/houko/pnpm-catalog-updates/discussions)
- üìñ **Documentation**: Check this documentation for detailed guides
- üîß **Feature Requests**: Use GitHub Issues with the enhancement label

### Issue Template

When reporting bugs, please include:

1. **PCU version** and **command used**
2. **Error message** (full output with `--verbose`)
3. **Environment** (OS, Node.js, pnpm versions)
4. **Workspace structure** (pnpm-workspace.yaml, package.json)
5. **Configuration** (.pcurc.json, .npmrc if relevant)
6. **Steps to reproduce** the issue
7. **Expected vs actual behavior**export const metadata = {
   title: 'Troubleshooting',
   description:
   'Common issues and solutions when using pnpm-catalog-updates. Error messages, debugging tips, and troubleshooting guides.',
   };

# Troubleshooting

Common issues and solutions to help you resolve problems with PCU. Find answers to frequently encountered errors and debugging tips. {{ className: 'lead' }}

## Common Errors

### Workspace Not Found

**Error Message:**

```
Error: No pnpm workspace found in the current directory
```

**Cause:** PCU couldn't locate a `pnpm-workspace.yaml` file or detect a valid pnpm workspace structure.

**Solutions:**

<CodeGroup>

```bash {{ title: 'Initialize Workspace' }}
# Create a new pnpm workspace
pcu init

# Or manually create pnpm-workspace.yaml
echo "packages:
  - 'packages/*'" > pnpm-workspace.yaml
```

```bash {{ title: 'Specify Workspace Path' }}
# Run PCU from workspace root
cd /path/to/workspace/root
pcu -c

# Or specify workspace directory
pcu -c --workspace /path/to/workspace
```

</CodeGroup>

---

### No Catalog Dependencies

**Error Message:**

```
No catalog dependencies found in workspace
```

**Cause:** Your workspace doesn't use pnpm catalog dependencies.

**Solutions:**

<CodeGroup>

```yaml {{ title: 'Add Catalog to pnpm-workspace.yaml' }}
packages:
  - 'packages/*'

catalog:
  react: ^18.2.0
  typescript: ^5.0.0
  lodash: ^4.17.21
```

```json {{ title: 'Use Catalog in package.json' }}
{
  "name": "my-package",
  "dependencies": {
    "react": "catalog:",
    "typescript": "catalog:",
    "lodash": "catalog:"
  }
}
```

</CodeGroup>

---

### Registry Access Issues

**Error Message:**

```
Error: getaddrinfo ENOTFOUND registry.npmjs.org
```

**Cause:** Network connectivity issues or registry access problems.

**Solutions:**

<CodeGroup>

```bash {{ title: 'Network Troubleshooting' }}
# Check network connectivity
ping registry.npmjs.org

# Test with increased timeout
pcu -c --timeout 60000

# Reduce concurrent requests
pcu -c --concurrency 2
```

```ini {{ title: 'Configure Registry (.npmrc)' }}
# Use different registry
registry=https://registry.npmjs.org/

# For corporate networks
registry=https://your-corporate-registry.com/
strict-ssl=false
```

</CodeGroup>

---

### Authentication Errors

**Error Message:**

```
Error: 401 Unauthorized - authentication required
```

**Cause:** Missing or invalid authentication tokens for private registries.

**Solutions:**

<CodeGroup>

```ini {{ title: 'Configure Auth (.npmrc)' }}
@myorg:registry=https://npm.private-registry.com/
//npm.private-registry.com/:_authToken=${NPM_TOKEN}

# Or use legacy auth
//npm.private-registry.com/:username=myuser
//npm.private-registry.com/:_password=base64password
//npm.private-registry.com/:email=my.email@example.com
```

```bash {{ title: 'Set Environment Variable' }}
export NPM_TOKEN=your_token_here
pcu -c
```

</CodeGroup>

---

### Configuration File Errors

**Error Message:**

```
Error: Invalid configuration in .pcurc.json
```

**Cause:** Malformed JSON or invalid configuration options.

**Solutions:**

<CodeGroup>

```bash {{ title: 'Validate Configuration' }}
# Check JSON syntax
node -e "console.log(JSON.parse(require('fs').readFileSync('.pcurc.json', 'utf8')))"

# Regenerate configuration
mv .pcurc.json .pcurc.json.backup
pcu init --force
```

```json {{ title: 'Minimal Valid Config' }}
{
  "defaults": {
    "target": "latest"
  },
  "output": {
    "format": "table"
  }
}
```

</CodeGroup>

## Debugging

### Enable Verbose Logging

<CodeGroup>

```bash {{ title: 'Verbose Output' }}
# Enable verbose logging
pcu -c --verbose

# Debug mode with environment variable
DEBUG=pcu:* pcu -c

# Specific debug modules
DEBUG=pcu:core,pcu:registry pcu -c
```

```bash {{ title: 'Output to File' }}
# Save debug output
pcu -c --verbose > debug.log 2>&1

# Check the log file
cat debug.log | grep -i error
```

</CodeGroup>

### Workspace Validation

<CodeGroup>

```bash {{ title: 'Validate Workspace' }}
# Check workspace configuration
pcu -s --validate

# Get detailed workspace info
pcu -s --stats --verbose
```

```bash {{ title: 'Manual Validation' }}
# Check pnpm-workspace.yaml exists
ls -la pnpm-workspace.yaml

# Verify catalog syntax
pnpm exec -- pnpm list --depth=0
```

</CodeGroup>

## Performance Issues

### Slow Network Requests

**Symptoms:** PCU takes a long time to check for updates

**Solutions:**

<CodeGroup>

```json {{ title: 'Optimize Configuration' }}
{
  "advanced": {
    "concurrency": 3,
    "timeout": 30000,
    "retries": 2,
    "cacheValidityMinutes": 120
  }
}
```

```bash {{ title: 'Cache Management' }}
# Clear cache if stale
rm -rf ~/.pcu/cache

# Disable cache for debugging
pcu -c --no-cache
```

</CodeGroup>

### High Memory Usage

**Symptoms:** PCU consumes excessive memory with large workspaces

**Solutions:**

<CodeGroup>

```json {{ title: 'Memory Optimization' }}
{
  "advanced": {
    "concurrency": 2,
    "batchSize": 10
  }
}
```

```bash {{ title: 'Process Management' }}
# Monitor memory usage
top -p $(pgrep node)

# Use Node.js memory flags
node --max-old-space-size=4096 $(which pcu) -c
```

</CodeGroup>

## Environment Issues

### Node.js Version Compatibility

**Error Message:**

```
Error: Unsupported Node.js version
```

**Solutions:**

<CodeGroup>

```bash {{ title: 'Check Version' }}
node --version  # Should be >= 18.0.0

# Install compatible version
nvm install 20
nvm use 20
```

```bash {{ title: 'Update Node.js' }}
# Using nvm
nvm install --lts
nvm use --lts

# Verify installation
node --version
npm --version
```

</CodeGroup>

### pnpm Version Issues

**Error Message:**

```
Error: pnpm command not found
```

**Solutions:**

<CodeGroup>

```bash {{ title: 'Install pnpm' }}
# Install latest pnpm
npm install -g pnpm@latest

# Verify installation
pnpm --version  # Should be >= 8.0.0
```

```bash {{ title: 'Alternative Installation' }}
# Using Corepack (recommended)
corepack enable
corepack prepare pnpm@latest --activate

# Direct download
curl -fsSL https://get.pnpm.io/install.sh | sh -
```

</CodeGroup>

## Windows-Specific Issues

### Path Separator Issues

**Error Message:**

```
Error: Cannot resolve workspace path
```

**Solutions:**

<CodeGroup>

```bash {{ title: 'Use Forward Slashes' }}
# Use forward slashes in paths
pcu -c --workspace ./my/workspace

# Or use PowerShell
pwsh -c "pcu -c"
```

```json {{ title: 'Windows Configuration' }}
{
  "workspace": {
    "pathSeparator": "/"
  }
}
```

</CodeGroup>

### Permission Errors

**Error Message:**

```
Error: EPERM: operation not permitted
```

**Solutions:**

<CodeGroup>

```cmd {{ title: 'Run as Administrator' }}
# Run Command Prompt as Administrator
runas /user:Administrator cmd

# Or use PowerShell as Administrator
Start-Process powershell -Verb RunAs
```

```bash {{ title: 'Fix Permissions' }}
# Fix npm permissions
npm config set cache ~/.npm-cache
npm config set prefix ~/npm-global
```

</CodeGroup>

## Getting Help

### Diagnostic Information

When reporting issues, include this diagnostic information:

<CodeGroup>

```bash {{ title: 'System Info' }}
# PCU version
pcu --version

# Node.js and pnpm versions
node --version
pnpm --version

# Operating system
uname -a  # Linux/macOS
systeminfo  # Windows
```

```bash {{ title: 'Configuration Info' }}
# Show current configuration
cat .pcurc.json

# Workspace validation
pcu -s --validate --verbose

# Debug output
DEBUG=pcu:* pcu -c --verbose
```

</CodeGroup>

### Support Channels

- üêõ **Bug Reports**: [GitHub Issues](https://github.com/houko/pnpm-catalog-updates/issues)
- üí¨ **Questions**: [GitHub Discussions](https://github.com/houko/pnpm-catalog-updates/discussions)
- üìñ **Documentation**: Check this documentation for detailed guides
- üîß **Feature Requests**: Use GitHub Issues with the enhancement label

### Issue Template

When reporting bugs, please include:

1. **PCU version** and **command used**
2. **Error message** (full output with `--verbose`)
3. **Environment** (OS, Node.js, pnpm versions)
4. **Workspace structure** (pnpm-workspace.yaml, package.json)
5. **Configuration** (.pcurc.json, .npmrc if relevant)
6. **Steps to reproduce** the issue
7. **Expected vs actual behavior**
